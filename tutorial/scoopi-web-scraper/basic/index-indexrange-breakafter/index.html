<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=description content="Scoopi web scraper can extract set of data without using multiple queries with the features such as index, indexRange and BreakAfter."><meta name=author content="Maithilish"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-42139846-3"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-42139846-3")</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://google.com/article"},"articleSection":"tutorial","name":"Index BreakAfter - Scoopi Web Scraper - why just scrape when you can scoop","headline":"Index BreakAfter - Scoopi Web Scraper - why just scrape when you can scoop","url":"https://www.codetab.org/tutorial/scoopi-web-scraper/basic/index-indexrange-breakafter/","description":"Scoopi web scraper can extract set of data without using multiple queries with the features such as index, indexRange and BreakAfter.","inLanguage":"en","image":"https://www.codetab.org/logo.jpg","author":"Maithilish","creator":"Maithilish","publisher":{"@type":"Organization","name":"Maithilish","url":"https://www.codetab.org/","logo":{"@type":"ImageObject","url":"https://www.codetab.org/logo.png","width":"200","height":"200"}},"copyrightHolder":"Maithilish","copyrightYear":"2020","datePublished":"2020-11-05T23:34:00+0530","dateModified":"2020-11-05T23:34:00+0530","wordCount":"1005","keywords":["indexRange","Blog"]}</script><link rel=icon href=/favicon.ico><link rel=stylesheet href=/css/vendor.min.36dba173dca94f4b9fca7c6a1c3d15560f7a96c6ab0c0042dcd000f8469a9dc1.css integrity="sha256-Ntuhc9ypT0ufynxqHD0VVg96lsarDABC3NAA+EaancE="><title>Index BreakAfter - Scoopi Web Scraper - why just scrape when you can scoop</title><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1281079745125126" crossorigin=anonymous></script></head><body id=top><header><nav id=navbar-main class="navbar fixed-top navbar-light navbar-expand-lg bg-white border-bottom shadow-sm"><div class=container-fluid><a class=navbar-brand href=/>Codetab</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbar aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbar><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/#tutorials><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#projects><span>Projects</span></a></li><li class=nav-item><a class=nav-link href=/post><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#about><span>About</span></a></li></ul></div></div></nav></header><div class=container-fluid><div class=row>&nbsp;</div><div class=row><aside id=sidebar class=col-md-3><div class=row><nav id=navbar-side class="bg-light text-secondary"><h4 class="text-muted bg-white pl-2">Scoopi Web Scraper</h4><nav class="navbar navbar-light bg-white navbar-expand-md"><button class="navbar-toggler ml-auto" type=button data-toggle=collapse data-target=#bookmenu aria-controls=bookmenu aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=bookmenu><div><div id="Scoopi Web Scraper"><div><a href=https://www.codetab.org/tutorial/scoopi-web-scraper/introduction/ class="toc-page text-wrap text-muted">Introduction</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-scoopi-web-scraper-basic id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Basics</a><div id=tutorial-scoopi-web-scraper-basic><a href=https://www.codetab.org/tutorial/scoopi-web-scraper/basic/installation-quick-start/ class="toc-page dropdown-item text-wrap text-muted">Installation and Quick Start</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/basic/definition-file/ class="toc-page dropdown-item text-wrap text-muted">Definition File</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/basic/datadef/ class="toc-page dropdown-item text-wrap text-muted">DataDef</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/basic/dimensions/ class="toc-page dropdown-item text-wrap text-muted">Dimensions</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/basic/data-items-dynamic-query/ class="toc-page dropdown-item text-wrap text-muted">Data Items and Dynamic Query</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/basic/index-indexrange-breakafter/ class="toc-page dropdown-item text-wrap text-danger">Index, IndexRange and BreakAfter</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/basic/filters/ class="toc-page dropdown-item text-wrap text-muted">Filters</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/basic/selector-query-analyzer/ class="toc-page dropdown-item text-wrap text-muted">Selector</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-scoopi-web-scraper-advanced id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Advanced</a><div id=tutorial-scoopi-web-scraper-advanced class=collapse><a href=https://www.codetab.org/tutorial/scoopi-web-scraper/advanced/multi-dimensions/ class="toc-page dropdown-item text-wrap text-muted">Multi Dimensions</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/advanced/multi-tasks/ class="toc-page dropdown-item text-wrap text-muted">Multi Tasks</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/advanced/workflow-steps-plugins/ class="toc-page dropdown-item text-wrap text-muted">WorkFlow, Steps and Plugins</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/advanced/converters/ class="toc-page dropdown-item text-wrap text-muted">Converters</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/advanced/scripter/ class="toc-page dropdown-item text-wrap text-muted">Scripter</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/advanced/create-locators-links/ class="toc-page dropdown-item text-wrap text-muted">Create Locators from Links</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/advanced/pagination/ class="toc-page dropdown-item text-wrap text-muted">Pagination</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/advanced/appender-encoder/ class="toc-page dropdown-item text-wrap text-muted">Appender and Encoder</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/advanced/dom-loader-selenium-webdriver/ class="toc-page dropdown-item text-wrap text-muted">Dom Loader</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/advanced/ajax-selenium-webdriver/ class="toc-page dropdown-item text-wrap text-muted">Ajax</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-scoopi-web-scraper-manage id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Manage</a><div id=tutorial-scoopi-web-scraper-manage class=collapse><a href=https://www.codetab.org/tutorial/scoopi-web-scraper/manage/persistence/ class="toc-page dropdown-item text-wrap text-muted">Persistence</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/manage/split-definitions/ class="toc-page dropdown-item text-wrap text-muted">Split Definitions</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/manage/logs/ class="toc-page dropdown-item text-wrap text-muted">Logs</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/manage/dashboard/ class="toc-page dropdown-item text-wrap text-muted">Dashboard</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-scoopi-web-scraper-cluster id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Cluster</a><div id=tutorial-scoopi-web-scraper-cluster class=collapse><a href=https://www.codetab.org/tutorial/scoopi-web-scraper/cluster/scoopi-cluster-quick-start/ class="toc-page dropdown-item text-wrap text-muted">Quick Start</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/cluster/scoopi-cluster-docker/ class="toc-page dropdown-item text-wrap text-muted">Docker</a>
<a href=https://www.codetab.org/tutorial/scoopi-web-scraper/cluster/scoopi-cluster-kubernetes/ class="toc-page dropdown-item text-wrap text-muted">kubernetes</a></div></div></div></div></nav></nav></div></aside><div id=contentbar class=col-md-8><div id=share class="row justify-content-end"><div title=twitter><a href="https://twitter.com/intent/tweet?url=https://www.codetab.org/tutorial/scoopi-web-scraper/basic/index-indexrange-breakafter/&amp;text=Index%20BreakAfter%20-%20Scoopi%20Web%20Scraper%20-%20why%20just%20scrape%20when%20you%20can%20scoop" target=_blank rel=noopener><i class="icon-twitter-squared text-secondary"></i></a></div><div title=facebook><a href="https://www.facebook.com/sharer.php?u=https://www.codetab.org/tutorial/scoopi-web-scraper/basic/index-indexrange-breakafter/&amp;t=Index%20BreakAfter%20-%20Scoopi%20Web%20Scraper%20-%20why%20just%20scrape%20when%20you%20can%20scoop" target=_blank rel=noopener><i class="icon-facebook-squared text-secondary"></i></a></div><div title=linkedin><a href="https://www.linkedin.com/shareArticle?url=https://www.codetab.org/tutorial/scoopi-web-scraper/basic/index-indexrange-breakafter/&amp;title=Index%20BreakAfter%20-%20Scoopi%20Web%20Scraper%20-%20why%20just%20scrape%20when%20you%20can%20scoop" target=_blank rel=noopener><i class="icon-linkedin-squared text-secondary"></i></a></div><div title=email><a href="mailto:?subject=Index%20BreakAfter%20-%20Scoopi%20Web%20Scraper%20-%20why%20just%20scrape%20when%20you%20can%20scoop&amp;body=https://www.codetab.org/tutorial/scoopi-web-scraper/basic/index-indexrange-breakafter/" target=_blank rel=noopener><i class="icon-mail-squared text-secondary"></i></a></div><div title=whatsapp><a href="https://web.whatsapp.com/send?text=Index%20BreakAfter%20-%20Scoopi%20Web%20Scraper%20-%20why%20just%20scrape%20when%20you%20can%20scoop%20https://www.codetab.org/tutorial/scoopi-web-scraper/basic/index-indexrange-breakafter/" target=_blank rel=noopener><i class="icon-whatsapp text-secondary"></i></a></div><div title=reddit><a href="https://reddit.com/submit?url=https://www.codetab.org/tutorial/scoopi-web-scraper/basic/index-indexrange-breakafter/&amp;title=Index%20BreakAfter%20-%20Scoopi%20Web%20Scraper%20-%20why%20just%20scrape%20when%20you%20can%20scoop" target=_blank rel=noopener><i class="icon-reddit-alien text-secondary"></i></a></div><i class="icon-blank ctab-transparent"></i></div><div class=row><main id=content class="col-md-11 post-basic"><h1 id=index-indexrange-and-breakafter>Index, IndexRange and BreakAfter</h1><p>This chapter explains the use of index, indexRange and breakAfter to
extract large set of data.</p><p>The
<a href=https://github.com/maithilish/scoopi-scraper/blob/master/engine/src/main/resources/defs/examples/fin/jsoup/ex-3/job.yml target=_blank>Example 3</a>
extracts multiple data from
<a href=https://github.com/maithilish/scoopi-scraper/blob/master/engine/src/main/resources/defs/examples/fin/page/acme-bs.html target=_blank>defs/examples/fin/page/acme-bs.html</a>
page, which contains Balance Sheet data of company for past five years
in a HTML table with 27 rows and 5 columns. The partial contents of the
table is shown
below.</p><table><thead><tr><th>Item</th><th>Dec &lsquo;16</th><th>Dec &lsquo;15</th><th>Dec &lsquo;14</th><th>Dec &lsquo;13</th><th>Dec &lsquo;12</th></tr></thead><tbody><tr><td>Total Share Capital</td><td>804.72</td><td>801.55</td><td>795.32</td><td>790.18</td><td>781.84</td></tr><tr><td>Reserves</td><td>32,071.87</td><td>29,881.73</td><td>25,414.29</td><td>21,444.92</td><td>17,957.00</td></tr><tr><td>&mldr;. 25 more rows &mldr;.</td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><p>The datadef to extract data from the table is specified in
<code>defs/examples/fin/jsoup/ex-3/job.xml</code> which extracts three rows of data
for the first column (Dec 2016). DataDef is as below</p><pre tabindex=0><code class=language-raw data-lang=raw>dataDefs:
  bs:
    query:
      block: &#34;table:contains(Sources Of Funds)&#34;
      selector: &#34;tr:nth-child(%{item.index}) &gt; td:nth-child(%{dim.year.index})&#34;
    items:
      - item:
          name: item
          selector: &#34;tr:nth-child(%{index}) &gt; td:nth-child(1)&#34;
          indexRange: 7-9
    dims:
      - item:
          name: year
          selector: &#34;tr:nth-child(1) &gt; td:nth-child(%{index})&#34;
          index: 2
</code></pre><p>Index can be specified in two ways - <em>index</em> or <em>indexRange</em>. The above
dataDef uses index in dim axis and indexRange in item axis.</p><p>This conspicuous looking datadef can scrape lots of data with just few
lines of definition. Let&rsquo;s go through it thoroughly to understand the
underlining concepts.</p><h2 id=datadef-breakdown>DataDef Breakdown</h2><p>This datadef defines three selectors - query/selector, item/selector and
dim/selector and, also one query/block selector. The query/selector is
used to get the value of fact axis while item/selector and dim/selector
are used get value respective axis. The query/block is common to all
three selectors and it is used to select a block of nodes from HTML page
and cached for performance. The HTML page is represented as tree of DOM
nodes and cached block nodes is sub tree of nodes and to speed up parse,
selector are fired against the sub tree and not the entire tree.</p><p>The effective selectors for above datadef is as shown in below
table.</p><table><thead><tr><th>Axis Name</th><th>Item Name</th><th>Effective selector</th></tr></thead><tbody><tr><td>dim</td><td>year</td><td>table:contains(Sources Of Funds) tr:nth-child(1) > td:nth-child(%{index})</td></tr><tr><td>item</td><td>item</td><td>table:contains(Sources Of Funds) tr:nth-child(%{index}) > td:nth-child(1)</td></tr><tr><td>fact</td><td>fact</td><td>table:contains(Sources Of Funds) tr:nth-child(%{item.index}) > td:nth-child(%{dim.year.index})</td></tr></tbody></table><p>As we can see, the query/block <em>table:contains(Sources Of Funds)</em> is
common to all selectors. Hereafter,for brevity the block is not shown
along with selector.</p><p>Once we know which selector is used for which axis, lets see how index
or indexRange is handled. At the start of parse, Scoopi creates an item
object with three
axis.</p><table><thead><tr><th>Axis Name</th><th>Item Name</th><th>Axis selector (common query/block is omitted)</th><th>index</th></tr></thead><tbody><tr><td>dim</td><td>year</td><td>tr:nth-child(1) > td:nth-child(%{index})</td><td>2</td></tr><tr><td>item</td><td>item</td><td>tr:nth-child(%{index}) > td:nth-child(1)</td><td>7</td></tr><tr><td>fact</td><td>fact</td><td>tr:nth-child(%{item.index}) > td:nth-child(%{dim.year.index})</td><td></td></tr></tbody></table><p>For dim (year) the index is set 2 which is as defined but for item
(item) the index is set to 7 which is start of defined indexRange 7-9.
As it processes axis one by one it replaces the variables. For axis dim
and item the %{index} is replaced with their own index values and fact
axis %{item.index} the item index 2 is used and for %{dim.year.index}
the dim (year) index which is 7 is used. The replaced selector becomes</p><table><thead><tr><th>Axis Name</th><th>Item Name</th><th>Axis Selector</th><th>index</th></tr></thead><tbody><tr><td>dim</td><td>year</td><td>tr:nth-child(1) > td:nth-child(2)</td><td>2</td></tr><tr><td>item</td><td>item</td><td>tr:nth-child(7) > td:nth-child(1)</td><td>7</td></tr><tr><td>fact</td><td>fact</td><td>tr:nth-child(2) > td:nth-child(7)</td><td></td></tr></tbody></table><p>That explains how the first data item is processed by Scoopi, but as
indexRange is 7-9 it has to handle all indexes of the range. To do that,
after processing first data item it creates second data item where axis
item index is set to 8 and process it.</p><p>data item 2</p><pre><code>dim [2] : tr:nth-child(1) &gt; td:nth-child(2)
item [8] : tr:nth-child(8) &gt; td:nth-child(1)
fact []:  tr:nth-child(2) &gt; td:nth-child(8)
</code></pre><p>Next it creates third data item with axis item index set to 9 and
process it</p><p>data item 3</p><pre><code>dim [2] : tr:nth-child(1) &gt; td:nth-child(2)
item [9] : tr:nth-child(9) &gt; td:nth-child(1)
fact []:  tr:nth-child(2) &gt; td:nth-child(9)
</code></pre><p>For all the three data items, the index of axis dim (year) is constant
i.e. 2 as plain index is defined for that axis.</p><h3 id=get-all-data-from-the-table>Get all data from the table</h3><p>To get all data for one year, change the indexRange of axis item (item)
from 7-9 to 7-39 and run Scoopi. The output data should have 33 rows of
data for the one year i.e. Dec 2016.</p><p>Next, in axis dim (year), change index property to indexRange: 2-6. Now,
run Scoopi and you should have about 198 rows of data in output which
entire data from year Dec 2012 to Dec 2016. We leave these as exercise.</p><h2 id=breakafter>BreakAfter</h2><p>In the previous example, finding indexRange for axis dim (year) was easy
because of limited number of columns in the table, but for axis item
(item) it was tedious as we have to count table rows.</p><p>The <em>breakAfter</em> feature comes handy when rows or columns are more or
when in-between data grows or contracts.</p><p>The job.xml file of next example, <a href=https://github.com/maithilish/scoopi-scraper/blob/master/engine/src/main/resources/defs/examples/fin/jsoup/ex-4/job.yml target=_blank>Example 4</a> is same as the previous example, but in items/item, it uses breakAfter along with index instead of IndexRange.</p><pre tabindex=0><code class=language-raw data-lang=raw>dataDefs:
  bs:
    query:
      block: &#34;table:contains(Sources Of Funds)&#34;
      selector: &#34;tr:nth-child(%{item.index}) &gt; td:nth-child(%{dim.year.index})&#34;
    items:
      - item:
          name: item
          selector: &#34;tr:nth-child(%{index}) &gt; td:nth-child(1)&#34;
          index: 5
          breakAfter:
            - &#34;Book Value (Rs)&#34;
    dims:
      - item:
          name: year
          selector: &#34;tr:nth-child(1) &gt; td:nth-child(%{index})&#34;
          indexRange: 2-6
</code></pre><p>Now the first data item begins with index 5 and additional data item are
created until selector returns &ldquo;Book Value&rdquo;. Once selector returns <em>Book
Value (Rs)</em> parser terminates. In case, index property is not defined
then index is set to 1 as default.</p><p>The breakAfter is also useful when first and last item is constant and
in-between rows or cols shrinks or expands. Using breakAfter, we can
scrape all data between them without bothering about the range. Note
that breakAfter is array and we can define multiple items and iteration
breaks when any one is matched.</p><p>If we go through the output of Example-4, we see a lot of unwanted data
such as sub-headings, texts such as &ldquo;12 months&rdquo;, nulls and blanks etc.,
and this is a common problem when dealing with unstructured sources. To
handle this, we can define filters and the next chapter covers it.</p></main></div></div><aside id=sidebar-right class=col-md-1><div class="row my-5 justify-content-center"></div></aside></div></div><footer class="container-fluid mt-5"><div class=row><div class="col ml-auto"><div class="row mb-1 ml-2"><a class=text-muted href=/privacy-policy>Privacy</a></div><div class="row text-muted mb-2 ml-2"><span>&copy; 2019 &#183;Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span></div></div><div class="col mr-auto"><span class=float-right><a href=# id=back_to_top><i class="icon-up-open h1 text-secondary"></i></a></span></div></div></footer><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<script src=/js/vendor.min.e0afe83ba5579b9676fc5f849c1becff1395739520a7c0bc45535f04acd819c3.js></script></body></html>