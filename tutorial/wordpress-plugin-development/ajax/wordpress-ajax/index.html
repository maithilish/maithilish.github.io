<!DOCTYPE html>
<html lang="en-us">

<head><meta charset="utf-8">
<meta name="description" content="In this tutorial, we use WordPress Ajax to send share details from client to server and save it. It also show how to pull data with Ajax to display charts.">
<meta name="author" content="Maithilish">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">



<script async src="https://www.googletagmanager.com/gtag/js?id=UA-42139846-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-42139846-3');
</script>

<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://www.codetab.org/"
        },
        "articleSection" : "tutorial",
        "name" : "Ajax - WordPress Plugin Development - CodeTab",
        "headline" : "Ajax - WordPress Plugin Development - CodeTab",
        "description" : "In this tutorial, we use WordPress Ajax to send share details from client to server and save it. It also show how to pull data with Ajax to display charts.",
        "inLanguage" : "en",
        "author" : "Maithilish",
        "creator" : "Maithilish",
        "publisher": "Maithilish",
        "copyrightHolder" : "Maithilish",
        "copyrightYear" : "2019",
        "datePublished": "2019-01-11 11:01:00 +0530 IST",
        "dateModified" : "2019-01-11 11:01:00 +0530 IST",
        "url" : "/tutorial/wordpress-plugin-development/ajax/wordpress-ajax/",
        "wordCount" : "952",
        "keywords" : [ "wordpress ajax","Blog" ]
    }
</script>
<link rel="icon" href="/favicon.ico">






<link rel="stylesheet" href="/css/vendor.min.06af1451a3c5b3b70a0c0bd7be26092e20e9c31251c08d44dbe1486a9a2a414c.css" integrity="sha256-Bq8UUaPFs7cKDAvXviYJLiDpwxJRwI1E2&#43;FIapoqQUw=">

<title>Ajax - WordPress Plugin Development - CodeTab</title></head>

<body id="top"><header><nav id="navbar-main" class="navbar fixed-top navbar-light navbar-expand-lg bg-white border-bottom shadow-sm">

    <div class="container-fluid">

        
        <a class="navbar-brand" href="/">Codetab</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbar">

            
            
            <ul class="navbar-nav ml-auto">
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#tutorials"  >
                        
                        <span>Home</span>
                        
                    </a>
                </li>

                
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#projects"  >
                        
                        <span>Projects</span>
                        
                    </a>
                </li>

                
                

                

                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/post"  >
                        
                        <span>Posts</span>
                        
                    </a>
                </li>

                
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#about"  >
                        
                        <span>About</span>
                        
                    </a>
                </li>

                
                

            </ul>

        </div>
    </div>
</nav></header>

<div class="container-fluid">
  <div class="row">&nbsp;</div>
  <div class="row">
    <aside id="sidebar" class="col-md-4">
      <div class="row"><nav id="navbar-side" class="bg-light text-secondary">
        
    
    

    

    
    

    

    <h4 class="text-muted bg-white pl-2">WP Plugin Development</h4>

    <nav class="navbar navbar-light bg-white navbar-expand-md">

        <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#bookmenu"
            aria-controls="bookmenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bookmenu">
            <div>
                
                









<div id="WordPress Plugin Development - CodeTab">
    
    <div>
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/introduction/" class="toc-page text-muted ">
            Introduction
        </a>
    </div>
    
    <div>
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/install-locally/" class="toc-page text-muted ">
            Install Locally
        </a>
    </div>
    
    <div>
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/simple-plugin/" class="toc-page text-muted ">
            Simple Plugin
        </a>
    </div>
    
    <div>
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/shortcode/" class="toc-page text-muted ">
            Shortcode
        </a>
    </div>
    
    <div>
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/plugin-structure/" class="toc-page text-muted ">
            Plugin Structure
        </a>
    </div>
    
    <div>
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/plugin-main-file/" class="toc-page text-muted ">
            Main File
        </a>
    </div>
    
    <div>
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/hooks-actions-filters/" class="toc-page text-muted ">
            Hooks, Actions, Filters
        </a>
    </div>
    
</div>







<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-admin-module-settings" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Admin Module - Settings
    </a>
    
    <div id="tutorial-wordpress-plugin-development-admin-module-settings" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-settings/add-menu/" class="toc-page dropdown-item text-muted">
            Add Menu
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-settings/settings-api/" class="toc-page dropdown-item text-muted">
            Settings API
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-settings/options-page/" class="toc-page dropdown-item text-muted">
            Options Page
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-admin-module-custom-posts" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Admin Module - Posts
    </a>
    
    <div id="tutorial-wordpress-plugin-development-admin-module-custom-posts" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/post-type/" class="toc-page dropdown-item text-muted">
            Custom Post Type
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/meta-box/" class="toc-page dropdown-item text-muted">
            Meta Box
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/save-post/" class="toc-page dropdown-item text-muted">
            Save Post
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-frontend" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Frontend
    </a>
    
    <div id="tutorial-wordpress-plugin-development-frontend" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/frontend/enqueue-scripts/" class="toc-page dropdown-item text-muted">
            Plugin Enqueue Scripts
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/frontend/pass-data-to-javascript/" class="toc-page dropdown-item text-muted">
            Pass Data to JavaScript
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/frontend/debug-info/" class="toc-page dropdown-item text-muted">
            Debug Info
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-ajax" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Ajax
    </a>
    
    <div id="tutorial-wordpress-plugin-development-ajax" class="">
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/wordpress-ajax/" class="toc-page dropdown-item text-danger">
            Ajax
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/chart-page/" class="toc-page dropdown-item text-muted">
            Chart Page
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/google-charts/" class="toc-page dropdown-item text-muted">
            Google Charts
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-internationalization" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Internationalization
    </a>
    
    <div id="tutorial-wordpress-plugin-development-internationalization" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/internationalization/internationalize/" class="toc-page dropdown-item text-muted">
            Internationalization
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/internationalization/localization/" class="toc-page dropdown-item text-muted">
            Localization
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-activation" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Activation
    </a>
    
    <div id="tutorial-wordpress-plugin-development-activation" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/activation/plugin-activation/" class="toc-page dropdown-item text-muted">
            Activation
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/activation/enable-multisite/" class="toc-page dropdown-item text-muted">
            Multi site
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/activation/multisite-activation/" class="toc-page dropdown-item text-muted">
            Multi site Activation
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/activation/plugin-deactivation/" class="toc-page dropdown-item text-muted">
            Deactivation
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/activation/plugin-uninstall/" class="toc-page dropdown-item text-muted">
            Uninstall
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-unit-test" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Testing
    </a>
    
    <div id="tutorial-wordpress-plugin-development-unit-test" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/plugin-unit-testing/" class="toc-page dropdown-item text-muted">
            Unit Test
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/setup/" class="toc-page dropdown-item text-muted">
            Test Setup
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/simple-unit-tests/" class="toc-page dropdown-item text-muted">
            Simple Unit Tests
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/scripts-actions-filters/" class="toc-page dropdown-item text-muted">
            Unit Test Scripts, Actions, Filters
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/advanced-unit-tests/" class="toc-page dropdown-item text-muted">
            Advanced Unit Tests
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/internationalization-functions/" class="toc-page dropdown-item text-muted">
            Test Internationalization Functions
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/ajax/" class="toc-page dropdown-item text-muted">
            Ajax Unit Tests
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/multisite-plugin-unit-tests/" class="toc-page dropdown-item text-muted">
            Multi site Plugin Unit Tests
        </a>
        
        
        
        
    </div>
</div>



                
            </div>
        </div>
    </nav>

</nav>

</div>
      <div class="row my-5 justify-content-center">
<div>&nbsp;</div>


<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-1281079745125126"
     data-ad-slot="8963022093"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<div>&nbsp;</div>
</div>
    </aside>
    <div id="contentbar" class="col-md-8">
      <div id="share" class="row justify-content-end">





<div title=twitter>
    <a href="https://twitter.com/intent/tweet?url=https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/wordpress-ajax/&amp;text=Ajax%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target="_blank" rel="noopener">
        <i class="icon-twitter-squared text-secondary"></i>
    </a>
</div>




<div title=facebook>
    <a href="https://www.facebook.com/sharer.php?u=https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/wordpress-ajax/&amp;t=Ajax%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target="_blank" rel="noopener">
        <i class="icon-facebook-squared text-secondary"></i>
    </a>
</div>




<div title=linkedin>
    <a href="https://www.linkedin.com/shareArticle?url=https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/wordpress-ajax/&amp;title=Ajax%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target="_blank" rel="noopener">
        <i class="icon-linkedin-squared text-secondary"></i>
    </a>
</div>




<div title=email>
    <a href="mailto:?subject=Ajax%20-%20WordPress%20Plugin%20Development%20-%20CodeTab&amp;body=https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/wordpress-ajax/" target="_blank" rel="noopener">
        <i class="icon-mail-squared text-secondary"></i>
    </a>
</div>




<div title=whatsapp>
    <a href="https://web.whatsapp.com/send?text=Ajax%20-%20WordPress%20Plugin%20Development%20-%20CodeTab%20https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/wordpress-ajax/" target="_blank" rel="noopener">
        <i class="icon-whatsapp text-secondary"></i>
    </a>
</div>




<div title=reddit>
    <a href="https://reddit.com/submit?url=https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/wordpress-ajax/&amp;title=Ajax%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target="_blank" rel="noopener">
        <i class="icon-reddit-alien text-secondary"></i>
    </a>
</div>




<div title=weibo>
    <a href="https://service.weibo.com/share/share.php?url=https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/wordpress-ajax/&amp;title=Ajax%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target="_blank" rel="noopener">
        <i class="icon-weibo text-secondary"></i>
    </a>
</div>




<i class="icon-blank ctab-transparent"></i></div>
      <div class="row">
        <main id="content" class="col-md-11 post-basic">
          

<p>In Share on Social Plugin, we use WordPress Ajax to save and view the
share statistics. In this chapter, we use WordPress Ajax to send share
details from client to server and save it as WordPress options and then
add a menu page to display the statistics in Google Charts.</p>

<h2 id="9-1-wordpress-ajax">9.1. WordPress Ajax</h2>

<p>When user shares a blog, functions in js/share.js use Social Network API
to share and on success, send the share details to the server.</p>

<p>WordPress centralizes and routes Ajax calls to its file
<code>wp-admin/admin-ajax.php</code>. To initiate Ajax, JavaScript require URL of
this file and we use <code>wp_localize_script()</code> function, explained in <a href="/tutorial/wordpress-plugin-development/frontend/pass-data-to-javascript/">Pass Data to JavaScript</a> to pass URL and other data from the server to client.</p>

<p><code>share-on-social/frontend/class-frontend.php</code></p>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php">    function add_sos_scripts () {
        ....          
        wp_localize_script( &#39;sos_script&#39;, &#39;sos_data&#39;, 
                array(
                        &#39;ajax_url&#39; =&gt; admin_url( &#39;admin-ajax.php&#39; ),
                        &#39;nonce&#39; =&gt; wp_create_nonce( &#39;sos-save-stat&#39; ),
                        &#39;gplus_client_id&#39; =&gt; $gplus_client_id ) );
    }</code></pre></div>
<p>WordPress function <a href="http://codex.wordpress.org/Function_Reference/admin_url" target="_blank">admin_url()</a> returns the URL of admin-ajax.php. WordPress function <a href="http://codex.wordpress.org/Function_Reference/wp_create_nonce" target="_blank">wp_create_nonce()</a> creates one time security token called nonce that can be only used for <strong>sos-save-stat</strong> request. The screenshot shows passed data in the browsers&rsquo; <strong>View Source</strong> screen.</p>

<figure class="text-center" >
  <img class="lazy" data-src="/tutorial/wordpress-plugin-development/media/wp-pd-sos-localizedata1.png" alt="WordPress Ajax - ajax URL." />
</figure>


<p>When a share is completed, JavaScript calls handleResponse() with the
response received from the Social Network and in the function, we use
JQuery Ajax to communicate with the server.</p>

<p><code>share-on-social/js/share.js</code></p>
<div class="highlight"><pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kd">function</span> <span class="nx">handleResponse</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">shareName</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">jQuery</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="nx">type</span> <span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
        <span class="nx">url</span> <span class="o">:</span> <span class="nx">sos_data</span><span class="p">.</span><span class="nx">ajax_url</span><span class="p">,</span>
        <span class="nx">data</span> <span class="o">:</span> <span class="p">{</span>
            <span class="nx">action</span> <span class="o">:</span> <span class="s1">&#39;save-stats&#39;</span><span class="p">,</span>
            <span class="nx">type</span> <span class="o">:</span> <span class="nx">type</span><span class="p">,</span>
            <span class="nx">share_name</span> <span class="o">:</span> <span class="nx">shareName</span><span class="p">,</span>
            <span class="nx">share_stats</span> <span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">response</span><span class="p">),</span>
            <span class="nx">_ajax_nonce</span> <span class="o">:</span> <span class="nx">sos_data</span><span class="p">.</span><span class="nx">nonce</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="nx">success</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">XMLHttpRequest</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
            <span class="nx">openLocker</span><span class="p">(</span><span class="nx">shareName</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">error</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">MLHttpRequest</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">errorThrown</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">errorThrown</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<p>In jQuery.ajax(), we use POST method to pass the data. The Ajax URL
passed by the WordPress is retrieved with <code>sos_data.ajax_url</code> and
assigned to <code>url</code> parameter. The <code>data</code> parameter passes the share
details, nonce, share name, share type and the JSON string of the
response received from the social network.</p>

<p><strong>WordPress jQuery</strong></p>

<p>jQuery library included with WordPress is set to <strong>noConflict</strong> mode and
in that mode, we are allowed to use jQuery(#somefunction) and not the
shorthand $(#somefunction). For more information refer <a href="http://codex.wordpress.org/Function_Reference/wp_enqueue_script#jQuery_noConflict_Wrappers" target="_blank">jQuery
noConflict
Wrappers</a></p>

<p>JQuery.ajax() call with type: POST and url :
<a href="http://example.org/wp-admin/admin-ajax.php">http://example.org/wp-admin/admin-ajax.php</a> invokes the WordPress Ajax
script wp-admin/admin-ajax.php.</p>

<p>But, how admin-ajax.php is able to determine the actual Ajax handler
method for a specific request. In <code>data</code> parameter we also provide
another bit of information to the server in <code>action: 'save-stats'</code>,
which tells admin-ajax.php that it has to invoke method or function
attached to the action hooks <strong>wp_ajax_save-stats</strong> or
<strong>wp_ajax_nopriv_save-stats</strong>.</p>



<div>&nbsp;</div>

<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-1281079745125126"
     data-ad-slot="6135368983"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<div>&nbsp;</div>



<p>So, we have to add action method to these two hooks and that is done in
plugins&rsquo; Ajax file<code>- admin/class-ajax.php</code>.</p>

<p><code>share-on-social/admin/class-ajax.php</code></p>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php">class Sos_Ajax {

    public function setup () {

        add_action( &#39;wp_ajax_nopriv_save-stats&#39;, array( $this,&#39;save_stats&#39; ) );
        add_action( &#39;wp_ajax_save-stats&#39;, array( $this,&#39;save_stats&#39; ) );

    }</code></pre></div>
<p>In <code>Sos_Ajax::setup()</code> method. we add <code>Sos_Ajax::save_stats()</code> as
action method to hooks <strong>wp_ajax_save-stats</strong> and
<strong>wp_ajax_nopriv_save-stats.</strong></p>

<p>When client <code>js/share.js</code> makes the Ajax call, WordPress receives the
request and passes it on to <code>wp-admin/admin-ajax.php</code>, which do the
action wp_ajax_save-stats and invokes the Sos_Ajax::save_stats().
The Ajax handler method processes the request and returns the response
back to client.</p>

<p><strong>Ajax - Admin and Regular Users</strong></p>

<p>The only difference between action hooks <strong>wp_ajax_</strong> and
<strong>wp_ajax_nopriv_</strong> is that wp_ajax triggers when user is logged in
as admin and wp_ajax_nopriv triggers for regular user. In other words,
wp_ajax_save-stats invokes save_stats() method only admins but not
for regular users. The second one, wp_ajax_nopriv_save-stats invokes
the method when regular user shares.</p>

<p>Let&rsquo;s see what goes on in the Ajax method <code>Sos_Ajax::save_stats()</code>.</p>

<p><code>share-on-social/admin/class-ajax.php</code></p>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php">    public function save_stats () {
        $valid_req = check_ajax_referer( &#39;sos-save-stat&#39;, false, false );
        if ( false == $valid_req ) {
            wp_die( &#39;-1&#39; );
        }
        
        if ( ! isset( $_POST<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;http://codex.wordpress.org/Function_Reference/check_ajax_referer&#34;</span> <span class="na">target</span><span class="o">=</span><span class="s">&#34;_blank&#34;</span><span class="p">&gt;</span> &#39;type&#39; ] ) || ! isset( $_POST[ &#39;share_name&#39; ] ) ) {
            wp_die( &#39;-1&#39; );
        }
        $share_on = $_POST[ &#39;type&#39; ];
        $share_name = $_POST[ &#39;share_name&#39; ];
        
        $this-&gt;update_sos_stats( $share_on, $share_name );
        $this-&gt;update_sos_stats_summary( $share_on, $share_name );
        
        wp_die( &#39;1&#39; );
    }</code></pre></div>
<p>The method, first do a security check and ascertains whether it is a
valid Ajax request originated from indented page with the help of
WordPress function
[check_ajax_referer()</a>
which uses _ajax_nonce sent by jQuery.ajax() call. If security check
fails, then
<a href="http://codex.wordpress.org/Function_Reference/wp_die" target="_blank">wp_die()</a>
function gracefully terminate the Ajax call and return -1 to client.</p>

<p>Next, verify whether required data - type and share_name are set in
$_POST and if not, terminate the Ajax call with wp_die().</p>

<p>After those checks, call <code>Sos_Ajax::update_sos_stats()</code> and
<code>Sos_Ajax::update_sos_stats_summary()</code> methods to save the stats in the
database.</p>

<p>Finally, terminate the Ajax call again with wp_die(), but return 1
which indicates successful call.</p>

<p><strong>Ajax Termination</strong></p>

<p>In both cases, success or failure, we use wp_die() to terminate the
Ajax call and based on the return value, 1 or -1, client determines the
status - success or failure.</p>

<p>We will explain the importance of wp_die() in a later chapter on Ajax
Unit Testing.</p>

<p>Let&rsquo;s see how data is saved to WordPress database by the
Sos_Ajax::update_sos_stats() method.</p>

<p><code>share-on-social/admin/class-ajax.php</code></p>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php">    public function update_sos_stats ( $share_on, $share_name ) {

        $stats = get_option( &#39;sos_stats&#39; );
        if ( null == $stats ) {
            $stats = array();
        }

        $stat = array(
                &#39;date&#39; =&gt; strtotime( &#39;now UTC&#39; ), // UTC timestamp
                &#39;type&#39; =&gt; $share_on,
                &#39;share_name&#39; =&gt; $share_name
        );
        
        $stats[] = $stat;
        update_option( &#39;sos_stats&#39;, $stats );
    }</code></pre></div>
<p>It uses <code>get_option()</code> function to check whether option <strong>sos_stats</strong>
exists in the database else creates a new one. Next, it creates an array
from the data sent by the client and update it as WordPress Option
<strong>sos_stats</strong> using <code>update_option()</code> function.</p>



<div>&nbsp;</div>

<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-1281079745125126"
     data-ad-slot="6135368983"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<div>&nbsp;</div>




<p>In the next two sections, we revisit some the topics covered so far in
the tutorial such as WordPress Menu, Enqueue Scripts and WordPress Ajax
to create a new sub menu and display the Share Statistics in Google
Charts.</p>

        </main>
        <aside id="sidebar-right" class="col-md-1">
        </aside>
      </div>
    </div>
  </div>
</div>

<footer class="container-fluid mt-5">

    <div class="row">
        <div class="col ml-auto">
            <div class="row mb-1 ml-2">
                <a class="text-muted" href="/privacy-policy">Privacy</a>
            </div>
            <div class="row text-muted mb-2 ml-2">
                <span>&copy; 2019 &middot;Powered by <a href="https://gohugo.io" target="_blank"
                        rel="noopener">Hugo</a></span>
            </div>
        </div>
        <div class="col mr-auto">
            <span class="float-right">
                <a href="#" id="back_to_top">
                    <i class="icon-up-open h1 text-secondary"></i>
                </a>
            </span>
        </div>
    </div>

</footer>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>








<script src="/js/vendor.min.d5750c855207aebcf4fdb7568961a27500008ef4a4f40b63a7b028f80a9221d3.js"></script>
</body>

</html>