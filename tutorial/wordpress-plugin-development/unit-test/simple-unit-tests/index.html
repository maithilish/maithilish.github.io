<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=description content="WordPress Plugin Simple Unit Tests tutorial shows how to write unit test for basic types of plugin methods such as those return values and those echo output"><meta name=author content="Maithilish"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-42139846-3"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-42139846-3")</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://google.com/article"},"articleSection":"tutorial","name":"Simple Unit Test - WordPress Plugin Development - CodeTab","headline":"Simple Unit Test - WordPress Plugin Development - CodeTab","url":"https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/simple-unit-tests/","description":"WordPress Plugin Simple Unit Tests tutorial shows how to write unit test for basic types of plugin methods such as those return values and those echo output","inLanguage":"en","image":"https://www.codetab.org/logo.jpg","author":"Maithilish","creator":"Maithilish","publisher":{"@type":"Organization","name":"Maithilish","url":"https://www.codetab.org/","logo":{"@type":"ImageObject","url":"https://www.codetab.org/logo.png","width":"200","height":"200"}},"copyrightHolder":"Maithilish","copyrightYear":"2019","datePublished":"2019-01-11T13:07:00+0530","dateModified":"2019-01-11T13:07:00+0530","wordCount":"1048","keywords":["wordpress plugin simple unit tests","Blog"]}</script><link rel=icon href=/favicon.ico><link rel=stylesheet href=/css/vendor.min.36dba173dca94f4b9fca7c6a1c3d15560f7a96c6ab0c0042dcd000f8469a9dc1.css integrity="sha256-Ntuhc9ypT0ufynxqHD0VVg96lsarDABC3NAA+EaancE="><title>Simple Unit Test - WordPress Plugin Development - CodeTab</title></head><body id=top><header><nav id=navbar-main class="navbar fixed-top navbar-light navbar-expand-lg bg-white border-bottom shadow-sm"><div class=container-fluid><a class=navbar-brand href=/>Codetab</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbar aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbar><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/#tutorials><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#projects><span>Projects</span></a></li><li class=nav-item><a class=nav-link href=/post><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#about><span>About</span></a></li></ul></div></div></nav></header><div class=container-fluid><div class=row>&nbsp;</div><div class=row><aside id=sidebar class=col-md-3><div class=row><nav id=navbar-side class="bg-light text-secondary"><h4 class="text-muted bg-white pl-2">WP Plugin Development</h4><nav class="navbar navbar-light bg-white navbar-expand-md"><button class="navbar-toggler ml-auto" type=button data-toggle=collapse data-target=#bookmenu aria-controls=bookmenu aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=bookmenu><div><div id="WordPress Plugin Development - CodeTab"><div><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/introduction/ class="toc-page text-wrap text-muted">Introduction</a></div><div><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/install-locally/ class="toc-page text-wrap text-muted">Install WP on Docker</a></div><div><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/simple-plugin/ class="toc-page text-wrap text-muted">Simple Plugin</a></div><div><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/shortcode/ class="toc-page text-wrap text-muted">Shortcode</a></div><div><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/plugin-structure/ class="toc-page text-wrap text-muted">Plugin Structure</a></div><div><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/plugin-main-file/ class="toc-page text-wrap text-muted">Main File</a></div><div><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/hooks-actions-filters/ class="toc-page text-wrap text-muted">Hooks, Actions, Filters</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-wordpress-plugin-development-admin-module-settings id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Admin - Settings</a><div id=tutorial-wordpress-plugin-development-admin-module-settings class=collapse><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-settings/add-menu/ class="toc-page dropdown-item text-wrap text-muted">Add Menu</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-settings/settings-api/ class="toc-page dropdown-item text-wrap text-muted">Settings API</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-settings/options-page/ class="toc-page dropdown-item text-wrap text-muted">Options Page</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-wordpress-plugin-development-admin-module-custom-posts id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Admin - Posts</a><div id=tutorial-wordpress-plugin-development-admin-module-custom-posts class=collapse><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/post-type/ class="toc-page dropdown-item text-wrap text-muted">Custom Post Type</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/meta-box/ class="toc-page dropdown-item text-wrap text-muted">Meta Box</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/save-post/ class="toc-page dropdown-item text-wrap text-muted">Save Post</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-wordpress-plugin-development-frontend id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Frontend</a><div id=tutorial-wordpress-plugin-development-frontend class=collapse><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/frontend/enqueue-scripts/ class="toc-page dropdown-item text-wrap text-muted">Plugin Enqueue Scripts</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/frontend/pass-data-to-javascript/ class="toc-page dropdown-item text-wrap text-muted">Pass Data to JavaScript</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/frontend/debug-info/ class="toc-page dropdown-item text-wrap text-muted">Debug Info</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-wordpress-plugin-development-ajax id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Ajax</a><div id=tutorial-wordpress-plugin-development-ajax class=collapse><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/wordpress-ajax/ class="toc-page dropdown-item text-wrap text-muted">Ajax</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/chart-page/ class="toc-page dropdown-item text-wrap text-muted">Chart Page</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/google-charts/ class="toc-page dropdown-item text-wrap text-muted">Google Charts</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-wordpress-plugin-development-internationalization id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Internationalization</a><div id=tutorial-wordpress-plugin-development-internationalization class=collapse><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/internationalization/internationalize/ class="toc-page dropdown-item text-wrap text-muted">Internationalization</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/internationalization/localization/ class="toc-page dropdown-item text-wrap text-muted">Localization</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-wordpress-plugin-development-activation id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Activation</a><div id=tutorial-wordpress-plugin-development-activation class=collapse><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/activation/plugin-activation/ class="toc-page dropdown-item text-wrap text-muted">Activation</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/activation/enable-multisite/ class="toc-page dropdown-item text-wrap text-muted">Multi site</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/activation/multisite-activation/ class="toc-page dropdown-item text-wrap text-muted">Multi site Activation</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/activation/plugin-deactivation/ class="toc-page dropdown-item text-wrap text-muted">Deactivation</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/activation/plugin-uninstall/ class="toc-page dropdown-item text-wrap text-muted">Uninstall</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-wordpress-plugin-development-unit-test id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Testing</a><div id=tutorial-wordpress-plugin-development-unit-test><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/plugin-unit-testing/ class="toc-page dropdown-item text-wrap text-muted">Unit Test</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/setup/ class="toc-page dropdown-item text-wrap text-muted">Test Setup</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/simple-unit-tests/ class="toc-page dropdown-item text-wrap text-danger">Simple Unit Tests</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/scripts-actions-filters/ class="toc-page dropdown-item text-wrap text-muted">Unit Test Scripts, Actions, Filters</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/advanced-unit-tests/ class="toc-page dropdown-item text-wrap text-muted">Advanced Unit Tests</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/internationalization-functions/ class="toc-page dropdown-item text-wrap text-muted">Test Internationalization Functions</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/ajax/ class="toc-page dropdown-item text-wrap text-muted">Ajax Unit Tests</a>
<a href=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/multisite-plugin-unit-tests/ class="toc-page dropdown-item text-wrap text-muted">Multi site Plugin Unit Tests</a></div></div></div></div></nav></nav></div></aside><div id=contentbar class=col-md-7><div id=share class="row justify-content-end"><div title=twitter><a href="https://twitter.com/intent/tweet?url=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/simple-unit-tests/&amp;text=Simple%20Unit%20Test%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target=_blank rel=noopener><i class="icon-twitter-squared text-secondary"></i></a></div><div title=facebook><a href="https://www.facebook.com/sharer.php?u=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/simple-unit-tests/&amp;t=Simple%20Unit%20Test%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target=_blank rel=noopener><i class="icon-facebook-squared text-secondary"></i></a></div><div title=linkedin><a href="https://www.linkedin.com/shareArticle?url=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/simple-unit-tests/&amp;title=Simple%20Unit%20Test%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target=_blank rel=noopener><i class="icon-linkedin-squared text-secondary"></i></a></div><div title=email><a href="mailto:?subject=Simple%20Unit%20Test%20-%20WordPress%20Plugin%20Development%20-%20CodeTab&amp;body=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/simple-unit-tests/" target=_blank rel=noopener><i class="icon-mail-squared text-secondary"></i></a></div><div title=whatsapp><a href="https://web.whatsapp.com/send?text=Simple%20Unit%20Test%20-%20WordPress%20Plugin%20Development%20-%20CodeTab%20https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/simple-unit-tests/" target=_blank rel=noopener><i class="icon-whatsapp text-secondary"></i></a></div><div title=reddit><a href="https://reddit.com/submit?url=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/simple-unit-tests/&amp;title=Simple%20Unit%20Test%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target=_blank rel=noopener><i class="icon-reddit-alien text-secondary"></i></a></div><i class="icon-blank ctab-transparent"></i></div><div class=row><main id=content class="col-md-11 post-basic"><h2 id=123wordpress-plugin-simple-unit-tests>12.3. WordPress Plugin Simple Unit Tests</h2><p>In the previous blog, we setup PHPUnit for WordPress Plugin and verified
the setup with a Simple Plugin. The rest of the blog explains various
types of unit tests we used to test the Share on Social Plugin.</p><p>The real hurdle in testing a plugin is to understand the WordPress
architecture and write the appropriate tests for it. For better
understanding, we selected various types of methods that are typical to
a plugin and explain how to test them. The complete set of tests of
Share on Social Plugin is available for download from <a href=https://github.com/maithilish/codefs/tree/master/share-on-social target=_blank>GitHub</a>.</p><p>In this blog, we start with PHPUnit Test Case, Setup, Tear down and then
explain a couple of basic types of plugin tests.</p><h3 id=test-case-setup-tear-down>Test Case, Setup, Tear Down</h3><figure class=text-center><img class="lazy img-fluid" data-src=/tutorial/wordpress-plugin-development/media/wp-pd-sos-ut-test-files.png alt="WordPress Plugin Simple Unit Tests - test files"></figure><p>In Share on Social Plugin, for each class file there is corresponding
test class file in <code>tests/phpunit/tests</code> directory. The test file is a
regular PHP class which extends WordPress Tests Librarys'
<code>WP_UnitTestCase</code> which itself extends <code>PHPUnit_Framework_TestCase</code>.</p><p>The test method names are prefixed with <strong>test_</strong> as PHPUnit requires
that to distinguish the test methods from others in the test case.</p><p>In all test classes, we define a variable with class scope that holds
the instance of class under test. In the next snippet, the var <code>$sos</code>
will hold an instance of class <code>Sos</code> which is the class under test.</p><p>The instance of the class under test is normally created in <code>setup()</code>
method.</p><p><code>share-on-social/tests/phpunit/tests/test-sos.php</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>Test_Sos</span> <span class=k>extends</span> <span class=nx>WP_UnitTestCase</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=nv>$sos</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>setup</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>parent</span><span class=o>::</span><span class=na>setup</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>require_once</span> <span class=s1>&#39;admin/class-sos.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>sos</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Sos</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=o>....</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In the <code>setup()</code> method, we need to call <code>parent::setup()</code> before doing
any other thing. Next, we include the class file of class under test
with require_once(). In the above test case, we include
<code>admin/class-sos.php</code> which defines the class <code>Sos</code>. Finally, we create
an instance of Sos and assign it to the variable $sos. PHPUnit calls
setup() before running each test and so, for each test we get a fresh
instance of class Sos.</p><p>After completion of each test, PHPUnit calls <code>teardown()</code>, where we call
<code>parent::teardown()</code> and then any clean up required to run subsequent
tests.</p><p><code>share-on-social/tests/phpunit/tests/test-sos.php</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>Test_Sos</span> <span class=k>extends</span> <span class=nx>WP_UnitTestCase</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=nv>$sos</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>....</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>teardown</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>parent</span><span class=o>::</span><span class=na>teardown</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>unload_textdomain</span><span class=p>(</span> <span class=s1>&#39;sos-domain&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>Util</span><span class=o>::</span><span class=na>set_activate_plugins_cap</span><span class=p>(</span> <span class=k>false</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=o>....</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In majority of test cases, in <code>teardown()</code> method, we unload the text
domain which we explain in a later blog when we cover the WordPress
Internationalization testing. In the above test case, we also remove a
user capability which is enabled by some test in this particular test
case.</p><p>The things we do in setup() and teardown() methods varies for each test
case, but they are easy to understand once you go through test class.</p><div>&nbsp;</div><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-1281079745125126 data-ad-slot=6135368983></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><div>&nbsp;</div><h3 id=methods-with-return-value>Methods with Return Value</h3><p>The simplest type of plugin tests are of the methods that return some
value. For example, the <code>Sos_Options::sanitize_options()</code> method takes
an array as input which hold key, value pairs and the method sanitize
the values using WP function <a href=http://codex.wordpress.org/Function_Reference/wp_filter_nohtml_kses target=_blank>wp_filter_nohtml_kses()</a> and add the sanitized value to an output array. The method returns the output array which holds the sanitized values.</p><p><code>share-on-social/admin/class-options.php</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl>    <span class=k>function</span> <span class=nf>sanitize_options</span> <span class=p>(</span> <span class=nv>$input</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$output</span> <span class=o>=</span> <span class=k>array</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span> <span class=p>(</span> <span class=nv>$input</span> <span class=k>as</span> <span class=nv>$key</span> <span class=o>=&gt;</span> <span class=nv>$val</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span> <span class=nx>isset</span><span class=p>(</span> <span class=nv>$input</span><span class=o>&lt;</span><span class=nx>a</span> <span class=nx>href</span><span class=o>=</span><span class=s2>&#34;https://phpunit.de/manual/current/en/appendixes.assertions.html&#34;</span> <span class=nx>target</span><span class=o>=</span><span class=s2>&#34;_blank&#34;</span><span class=o>&gt;</span> <span class=nv>$key</span> <span class=p>]</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// $output[$key] = strip_tags(stripslashes($input[$key]));
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=nv>$output</span><span class=p>[</span> <span class=nv>$key</span> <span class=p>]</span> <span class=o>=</span> <span class=nx>wp_filter_nohtml_kses</span><span class=p>(</span> <span class=nv>$input</span><span class=p>[</span> <span class=nv>$key</span> <span class=p>]</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>apply_filters</span><span class=p>(</span> <span class=s1>&#39;sanitize_options&#39;</span><span class=p>,</span> <span class=nv>$output</span><span class=p>,</span> <span class=nv>$input</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>We test this type of methods by asserting whether the returned object
contains the expected values.</p><p><code>share-on-social/tests/phpunit/tests/test-options.php</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>test_sanitize_options_scripts</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$input</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;id&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;test id&lt;h1&gt;&lt;?php evil ?&gt;&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$output</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>sos_options</span><span class=o>-&gt;</span><span class=na>sanitize_options</span><span class=p>(</span> <span class=nv>$input</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>assertCount</span><span class=p>(</span> <span class=mi>1</span><span class=p>,</span> <span class=nv>$output</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>assertSame</span><span class=p>(</span> <span class=s1>&#39;test id&#39;</span><span class=p>,</span> <span class=nv>$output</span><span class=p>[</span> <span class=s1>&#39;id&#39;</span> <span class=p>]</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>In the test method, first we construct an input array and add an option
value which contains some PHP script tags. Next, we call method under
test <code>Sos_Options::sanitize_options()</code> by passing input array as
parameter. Then, we test whether the returned output has only one
element and whether the method has sanitized the value by removing the
PHP tags from the input value. The instance of class <code>Sos_Options</code> is
instantiated in test case setup() method and assigned to the variable
$this->sos_options.</p><p><strong>Always Count</strong></p><p>When testing an array, always assert the size of the array with
<a href=https://phpunit.de/manual/current/en/appendixes.assertions.html target=_blank>assertCount()</a>. It ensures that test fails whenever you make changes to the code that affects the size of the array, and failure alerts you to write additional assertions to test the changes.</p><div>&nbsp;</div><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-1281079745125126 data-ad-slot=6135368983></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><div>&nbsp;</div><h3 id=methods-that-echo-output>Methods that Echo Output</h3><p>One more type of frequently used methods are those which echo output
without return value. Plugin uses such methods as callbacks to render
pages, menu etc.,</p><p>One such example is <code>Sos_Stats::render_stats_page()</code> method from
<code>admin/class-stats.php</code>.</p><p><code>share-on-social/admin/class-stats.php</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>render_stats_page</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$heading</span> <span class=o>=</span> <span class=nx>__</span><span class=p>(</span> <span class=s1>&#39;Share Stats&#39;</span><span class=p>,</span> <span class=s1>&#39;sos-domain&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s>&lt;&lt;&lt;</span><span class=dl>EOD</span><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>        &lt;h3&gt;{$heading}&lt;/h3&gt;
</span></span></span><span class=line><span class=cl><span class=s>        &lt;div&gt;&amp;nbsp;&lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=s>        &lt;div id=&#34;summary_chart&#34;&gt;&lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=s>        &lt;div&gt;&amp;nbsp;&lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=s>        &lt;div id=&#34;stats_chart&#34;&gt;&lt;/div&gt;        
</span></span></span><span class=line><span class=cl><span class=s></span><span class=dl>EOD</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>In Share on Social, we test such methods by capturing the echoed output
with PHP output buffer functions.</p><p><code>share-on-social/tests/phpunit/tests/test-stats.php</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>test_render_stats_page</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ob_start</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>sos_stats</span><span class=o>-&gt;</span><span class=na>render_stats_page</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nv>$result</span> <span class=o>=</span> <span class=nx>ob_get_contents</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>ob_end_clean</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nv>$expected</span> <span class=o>=</span> <span class=o>&lt;&lt;&lt;</span> <span class=nx>EOD</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>h3</span><span class=o>&gt;</span><span class=nx>Share</span> <span class=nx>Stats</span><span class=o>&lt;/</span><span class=nx>h3</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;&amp;</span><span class=nx>nbsp</span><span class=p>;</span><span class=o>&lt;/</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>id</span><span class=o>=</span><span class=s2>&#34;summary_chart&#34;</span><span class=o>&gt;&lt;/</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;&amp;</span><span class=nx>nbsp</span><span class=p>;</span><span class=o>&lt;/</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>id</span><span class=o>=</span><span class=s2>&#34;stats_chart&#34;</span><span class=o>&gt;&lt;/</span><span class=nx>div</span><span class=o>&gt;</span>    
</span></span><span class=line><span class=cl><span class=nx>EOD</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>assertSame</span><span class=p>(</span> <span class=nx>trim</span><span class=p>(</span> <span class=nv>$expected</span> <span class=p>),</span> <span class=nx>trim</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>)</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>PHP output buffer functions are used to capture the output. After
turning on the output buffer with PHP function
<a href=http://php.net/manual/en/function.ob-start.php target=_blank>ob_start()</a>, we call
the method under test. The echoed output is obtained with
<a href=http://php.net/manual/en/function.ob-get-contents.php target=_blank>ob_get_contents()</a>
and after that, buffer is turned off with
<a href=http://php.net/manual/en/function.ob-end-clean.php target=_blank>ob_end_clean()</a>.
The result is asserted for desired value.</p><p><strong>Multiple Assertions</strong></p><p>Unit Test best practice recommends to have single assertion per test
which ensures that tests are concise and readable. When test fails,
developers can easily pinpoint the error and refactor the code.</p><p>But in Share on Social Plugin test cases we have not followed this
recommendation. Single assert per test rule results in too many tests
and it is bit difficult to browse the test code and comprehend. Instead,
we use single test to test single condition by making multiple
assertions to test that condition.</p><p>If you don&rsquo;t mind too many test methods and have knack to meaningfully
name them, then it is better to stick with the single assertion per test
rule.</p><p>In the next blog, we explain some of the advanced types of tests that
are unique to WordPress Plugin.</p></main></div></div><aside id=sidebar-right class=col-md-2><div class="row my-5 justify-content-center border"><div>&nbsp;</div><div>&nbsp;</div></div></aside></div></div><footer class="container-fluid mt-5"><div class=row><div class="col ml-auto"><div class="row mb-1 ml-2"><a class=text-muted href=/privacy-policy>Privacy</a></div><div class="row text-muted mb-2 ml-2"><span>&copy; 2019 &#183;Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span></div></div><div class="col mr-auto"><span class=float-right><a href=# id=back_to_top><i class="icon-up-open h1 text-secondary"></i></a></span></div></div></footer><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<script src=/js/vendor.min.e0afe83ba5579b9676fc5f849c1becff1395739520a7c0bc45535f04acd819c3.js></script></body></html>