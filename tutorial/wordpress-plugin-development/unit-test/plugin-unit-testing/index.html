<!DOCTYPE html>
<html lang="en-us">

<head><meta charset="utf-8">
<meta name="description" content="WordPress Plugin Unit Testing is step by step tutorial about testing production ready plugin. It assists developers to setup unit test for their projects.">
<meta name="author" content="Maithilish">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">



<script async src="https://www.googletagmanager.com/gtag/js?id=UA-42139846-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-42139846-3');
</script>

<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "http://www.codetab.org/"
        },
        "articleSection" : "tutorial",
        "name" : "Unit Test - WordPress Plugin Development - CodeTab",
        "headline" : "Unit Test - WordPress Plugin Development - CodeTab",
        "description" : "WordPress Plugin Unit Testing is step by step tutorial about testing production ready plugin. It assists developers to setup unit test for their projects.",
        "inLanguage" : "en",
        "author" : "Maithilish",
        "creator" : "Maithilish",
        "publisher": "Maithilish",
        "copyrightHolder" : "Maithilish",
        "copyrightYear" : "2019",
        "datePublished": "2019-01-11 12:56:00 +0530 IST",
        "dateModified" : "2019-01-11 12:56:00 +0530 IST",
        "url" : "/tutorial/wordpress-plugin-development/unit-test/plugin-unit-testing/",
        "wordCount" : "1750",
        "keywords" : [ "WordPress Plugin Unit Testing","Blog" ]
    }
</script>
<link rel="icon" href="/favicon.ico">





<link rel="stylesheet" href="/css/vendor.min.fda72737edeb853fff288025d5ea04d671489f0f524e38c245ccf83306a19ab3.css" integrity="sha256-/acnN&#43;3rhT//KIAl1eoE1nFInw9STjjCRcz4MwahmrM=">

<title>Unit Test - WordPress Plugin Development - CodeTab</title></head>

<body id="top"><header><nav id="navbar-main" class="navbar fixed-top navbar-light navbar-expand-lg bg-white border-bottom shadow-sm">

    <div class="container-fluid">

        
        <a class="navbar-brand" href="/">Codetab</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbar">

            
            
            <ul class="navbar-nav ml-auto">
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#tutorials"  >
                        
                        <span>Home</span>
                        
                    </a>
                </li>

                
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#projects"  >
                        
                        <span>Projects</span>
                        
                    </a>
                </li>

                
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#about"  >
                        
                        <span>About</span>
                        
                    </a>
                </li>

                
                

            </ul>

        </div>
    </div>
</nav></header>

<div class="container-fluid">
  <div class="row">&nbsp;</div>
  <div class="row">
    <aside id="sidebar" class="col-md-4">
      <div class="row"><nav id="navbar-side" class="bg-light text-secondary">
        
    
    

    

    
    

    

    <h4 class="text-muted bg-white pl-2">WP Plugin Development</h4>

    <nav class="navbar navbar-light bg-white navbar-expand-md">

        <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#bookmenu"
            aria-controls="bookmenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bookmenu">
            <div>
                
                









<div id="WordPress Plugin Development - CodeTab">
    
    <div>
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/introduction/" class="toc-page text-muted ">
            Introduction
        </a>
    </div>
    
    <div>
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/install-locally/" class="toc-page text-muted ">
            Install Locally
        </a>
    </div>
    
    <div>
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/simple-plugin/" class="toc-page text-muted ">
            Simple Plugin
        </a>
    </div>
    
    <div>
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/shortcode/" class="toc-page text-muted ">
            Shortcode
        </a>
    </div>
    
    <div>
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/plugin-structure/" class="toc-page text-muted ">
            Plugin Structure
        </a>
    </div>
    
    <div>
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/plugin-main-file/" class="toc-page text-muted ">
            Main File
        </a>
    </div>
    
    <div>
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/hooks-actions-filters/" class="toc-page text-muted ">
            Hooks, Actions, Filters
        </a>
    </div>
    
</div>







<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-admin-module-settings" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Admin Module - Settings
    </a>
    
    <div id="tutorial-wordpress-plugin-development-admin-module-settings" class="collapse">
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-settings/add-menu/" class="toc-page dropdown-item text-muted">
            Add Menu
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-settings/settings-api/" class="toc-page dropdown-item text-muted">
            Settings API
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-settings/options-page/" class="toc-page dropdown-item text-muted">
            Options Page
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-admin-module-custom-posts" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Admin Module - Posts
    </a>
    
    <div id="tutorial-wordpress-plugin-development-admin-module-custom-posts" class="collapse">
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/post-type/" class="toc-page dropdown-item text-muted">
            Custom Post Type
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/meta-box/" class="toc-page dropdown-item text-muted">
            Meta Box
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/save-post/" class="toc-page dropdown-item text-muted">
            Save Post
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-frontend" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Frontend
    </a>
    
    <div id="tutorial-wordpress-plugin-development-frontend" class="collapse">
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/frontend/enqueue-scripts/" class="toc-page dropdown-item text-muted">
            Plugin Enqueue Scripts
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/frontend/pass-data-to-javascript/" class="toc-page dropdown-item text-muted">
            Pass Data to JavaScript
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/frontend/debug-info/" class="toc-page dropdown-item text-muted">
            Debug Info
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-ajax" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Ajax
    </a>
    
    <div id="tutorial-wordpress-plugin-development-ajax" class="collapse">
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/ajax/wordpress-ajax/" class="toc-page dropdown-item text-muted">
            Ajax
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/ajax/chart-page/" class="toc-page dropdown-item text-muted">
            Chart Page
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/ajax/google-charts/" class="toc-page dropdown-item text-muted">
            Google Charts
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-internationalization" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Internationalization
    </a>
    
    <div id="tutorial-wordpress-plugin-development-internationalization" class="collapse">
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/internationalization/internationalize/" class="toc-page dropdown-item text-muted">
            Internationalization
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/internationalization/localization/" class="toc-page dropdown-item text-muted">
            Localization
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-activation" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Activation
    </a>
    
    <div id="tutorial-wordpress-plugin-development-activation" class="collapse">
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/activation/plugin-activation/" class="toc-page dropdown-item text-muted">
            Activation
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/activation/enable-multisite/" class="toc-page dropdown-item text-muted">
            Multi site
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/activation/multisite-activation/" class="toc-page dropdown-item text-muted">
            Multi site Activation
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/activation/plugin-deactivation/" class="toc-page dropdown-item text-muted">
            Deactivation
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/activation/plugin-uninstall/" class="toc-page dropdown-item text-muted">
            Uninstall
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-unit-test" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Testing
    </a>
    
    <div id="tutorial-wordpress-plugin-development-unit-test" class="">
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/plugin-unit-testing/" class="toc-page dropdown-item text-danger">
            Unit Test
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/setup/" class="toc-page dropdown-item text-muted">
            Test Setup
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/simple-unit-tests/" class="toc-page dropdown-item text-muted">
            Simple Unit Tests
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/scripts-actions-filters/" class="toc-page dropdown-item text-muted">
            Unit Test Scripts, Actions, Filters
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/advanced-unit-tests/" class="toc-page dropdown-item text-muted">
            Advanced Unit Tests
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/internationalization-functions/" class="toc-page dropdown-item text-muted">
            Test Internationalization Functions
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/ajax/" class="toc-page dropdown-item text-muted">
            Ajax Unit Tests
        </a>
        
        
        <a href="http://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/multisite-plugin-unit-tests/" class="toc-page dropdown-item text-muted">
            Multi site Plugin Unit Tests
        </a>
        
        
        
        
    </div>
</div>



                
            </div>
        </div>
    </nav>

</nav>

</div>
      <div class="row my-5 justify-content-center">
<div>&nbsp;</div>


<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-1281079745125126"
     data-ad-slot="8963022093"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<div>&nbsp;</div>
</div>
    </aside>
    <main id="content" class="col-md-8 post-basic">
      

<h1 id="plugin-unit-test">Plugin Unit Test</h1>

<p>One of the challenges that we faced while developing the Share on Social
Plugin was to setup unit tests. Many tutorials and blogs on the subject
and even the official WordPress documentation couldn&rsquo;t help us much to
overcome the initial hurdles. Knowing well the difficulties faced by the
beginners, some developers have packaged and hosted the testing
frameworks for WordPress on GitHub to ease the setup but they are unable
to reduce the overall confusion.</p>

<p>For us, it took some time to figure out how WordPress itself tests its
core. Once we understood the WordPress testing setup and methodology,
plugin tests became quite smooth. This tutorial series - WordPress
Plugin Unit Testing - is based on our experience in testing a production
ready plugin, and it explains testing in a step by step fashion so that
beginners can easily setup unit test for their projects. The blogs in
this cookbook covers important aspects of plugin unit test; setup and
configure WordPress Testing Library, plugin basic and advanced tests
such as tests for action and filter, i18n, Ajax and Multisite.</p>

<p>We will try to make the tutorial as easy as possible considering the
size of test suit.. While there are about 2000 plus lines of code in our
plugin, the code to test them crosses 5000 lines. It would be quite
boring to explain all the tests, file by file, as some test patterns
repeats throughout the test suit. Instead, we group the test cases into
categories and take a couple of typical test cases from each category
and explain their pattern so that you can easily adapt them for your
project.</p>

<p>However, we will not dwell too much on unit test per se - it&rsquo;s
importance and the best practices - as there are enough blogs on the
subject and so, we avoid repeating those things all over again.</p>

<h2 id="12-1-wordpress-phpunit-setup">12.1.Â WordPress PHPUnit Setup</h2>

<p>In this tutorial, we install the modules and then do the configurations
required to run Plugin unit tests. Most confusing part of WordPress
testing is its configuration and keeping this in mind, tutorial provides
step by step instructions with an example of Simple WordPress Plugin.
Once you understand the configuration and able to run tests against
Simple Plugin, it is easy to map it for any plugin you plan to develop.</p>

<h3 id="install-phpunit">Install PHPUnit</h3>

<p>WordPress uses <a href="https://phpunit.de/" target="_blank">PHPUnit</a> unit test framework for
PHP. The latest release of PHPUnit is bundled as a PHAR file (PHP
Archive) which is quite easy to install and use.</p>

<p>For Linux, install PHPUnit with following commands.</p>
<div class="highlight"><pre class="chroma"><code class="language-screen" data-lang="screen">$ wget https://phar.phpunit.de/phpunit.phar
$ chmod +x phpunit.phar
$ mv phpunit.phar /usr/local/bin/phpunit</code></pre></div>
<p>Verify the installation, with following command.</p>
<div class="highlight"><pre class="chroma"><code class="language-screen" data-lang="screen">$ phpunit --version
PHPUnit x.y.z by Sebastian Bergmann and contributors.</code></pre></div>
<p>For Windows, refer <a href="https://phpunit.de/manual/current/en/installation.html#installation.phar.windows" target="_blank">PHPUnit Installation for
Windows</a>.
PHPUnit requires PHP 5.3.3 or above, and Windows users also have to
install PHP, if not installed.</p>


<div>&nbsp;</div>

<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-1281079745125126"
     data-ad-slot="6135368983"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<div>&nbsp;</div>


<h3 id="create-simple-plugin">Create Simple Plugin</h3>

<p>To understand the unit test setup, we require a simple plugin. If you
have already created the simple plugin explained in <a href="/tutorial/wordpress-plugin-development/simple-plugin/">WordPress Simple Plugin</a> then you can reuse it, otherwise create a new one as explained here.</p>

<p>Create a directory named <code>wp-simple-plugin</code> in some location and add
plugin main file <code>wp-simple-plugin.php</code> to it with following contents.</p>

<p><code>wp-simple-plugin/wp-simple-plugin.php</code></p>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="sd">/**
</span><span class="sd"> * Plugin Name: WordPress Simple Plugin
</span><span class="sd"> * Plugin URI: http://www.codetab.org/tutorial/wordpress/
</span><span class="sd"> * Description: Plugin to explain WordPress Plugin Basics
</span><span class="sd"> * Version: 1.0.0
</span><span class="sd"> * Author: maithilish
</span><span class="sd"> * Author URI: http://www.codetab.org/about/
</span><span class="sd"> * License: GPLv2
</span><span class="sd"> */</span>

<span class="nx">defined</span><span class="p">(</span> <span class="s1">&#39;ABSPATH&#39;</span> <span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span> <span class="s2">&#34;Access denied !&#34;</span> <span class="p">);</span>

<span class="nx">define</span><span class="p">(</span><span class="s1">&#39;WPSP_NAME&#39;</span><span class="p">,</span><span class="s1">&#39;wp-simple-plugin&#39;</span><span class="p">);</span>

<span class="nx">define</span><span class="p">(</span> <span class="s2">&#34;WPSP_URL&#34;</span><span class="p">,</span> <span class="nx">trailingslashit</span><span class="p">(</span> <span class="nx">plugin_dir_url</span><span class="p">(</span> <span class="no">__FILE__</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</code></pre></div>
<p>As we not going to install or use the simple plugin in WordPress, there
is nothing functional in it apart from the usual plugin header and a
couple of define statements.</p>

<p>Next, we require a directory to hold configuration files and the test
cases. Create following directories under <code>wp-simple-plugin</code> folder with
following commands.</p>
<div class="highlight"><pre class="chroma"><code class="language-screen" data-lang="screen">$ cd wp-simple-plugin
$ mkdir tests
$ mkdir tests/phpunit
$ mkdir tests/phpunit/tests

// or create all directories recursively

$ mkdir -p tests/phpunit/tests  </code></pre></div>
<h3 id="install-wordpress-tests-library">Install WordPress Tests Library</h3>

<p>To run unit test against WordPress, we require <strong>WordPress Tests
Library</strong>. Install the library under <code>tests/phpunit</code> directory with
following commands.</p>
<div class="highlight"><pre class="chroma"><code class="language-screen" data-lang="screen">$ cd wp-simple-plugin
$ cd tests/phpunit
$ svn co https://develop.svn.wordpress.org/trunk/tests/phpunit/includes/</code></pre></div>
<figure class="text-center" >
  <img class="lazy" data-src="/tutorial/wordpress-plugin-development/media/wp-pd-sos-ut-lib-files.png" alt="WordPress PHPUnit Setup - WordPress Test Library files" />
</figure>


<p>SVN pulls the latest version of WordPress Test Library from WordPress
repository and saves it under <code>tests/phpunit/includes</code> .</p>

<p>When we run tests, WordPress Test Library ( i.e. files of includes
directory ) integrates PHPUnit with WordPress to handle following tasks.</p>

<ul>
<li><p>creates a new instance of WordPress.</p></li>

<li><p>creates WP tables in test database.</p></li>

<li><p>runs test cases against test instance of WP including special test
cases such as Ajax calls and Multisite tests cases.</p></li>

<li><p>when tests are through, deletes the tables to clean up the test
database.</p></li>
</ul>

<h3 id="setup-configuration-files">Setup Configuration Files</h3>

<p>The first configuration file is <code>phpunit.xml</code>, which as name suggests is
a PHPUnit file and it defines the test suit and test files. Add
phpunit.xml with following contents to the top directory of the plugin.</p>

<p><code>wp-simple-plugin/phpunit.xml</code></p>
<div class="highlight"><pre class="chroma"><code class="language-XML" data-lang="XML"><span class="nt">&lt;phpunit</span> <span class="na">bootstrap=</span><span class="s">&#34;tests/phpunit/bootstrap.php&#34;</span> <span class="na">backupGlobals=</span><span class="s">&#34;false&#34;</span>
        <span class="na">colors=</span><span class="s">&#34;false&#34;</span> <span class="na">convertErrorsToExceptions=</span><span class="s">&#34;true&#34;</span>
        <span class="na">convertNoticesToExceptions=</span><span class="s">&#34;true&#34;</span> <span class="na">convertWarningsToExceptions=</span><span class="s">&#34;true&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;testsuites&gt;</span>
                <span class="nt">&lt;testsuite&gt;</span>
                        <span class="nt">&lt;file&gt;</span>tests/phpunit/tests/test-wp-simple-plugin.php<span class="nt">&lt;/file&gt;</span>
                <span class="nt">&lt;/testsuite&gt;</span>
        <span class="nt">&lt;/testsuites&gt;</span>
<span class="nt">&lt;/phpunit&gt;</span></code></pre></div>
<p>PHPUnit configuration defines single <strong>testsuite</strong> with one test file.
Later we add more test files to the <strong>testsuit</strong> element.</p>

<p>In <strong>phpunit</strong> element we indicate that PHPUnit has to use
<code>tests/phpunit/bootstrap.php</code> to bootstrap the tests. Add the
<code>bootstrap.php</code> to <code>wp-simple-plugin/tests/phpunit</code> directory.</p>

<p><code>wp-simple-plugin/tests/phpunit/bootstrap.php</code></p>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="c1">// path to test lib bootstrap.php
</span><span class="c1"></span><span class="nv">$test_lib_bootstrap_file</span> <span class="o">=</span> <span class="nx">dirname</span><span class="p">(</span> <span class="no">__FILE__</span> <span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/includes/bootstrap.php&#39;</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">file_exists</span><span class="p">(</span> <span class="nv">$test_lib_bootstrap_file</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nx">PHP_EOL</span> <span class="o">.</span> <span class="s2">&#34;Error : unable to find &#34;</span> <span class="o">.</span> <span class="nv">$test_lib_bootstrap_file</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">(</span> <span class="s1">&#39;&#39;</span> <span class="o">.</span> <span class="nx">PHP_EOL</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// set plugin and options for activation
</span><span class="c1"></span><span class="nv">$GLOBALS</span><span class="p">[</span> <span class="s1">&#39;wp_tests_options&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;active_plugins&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;wp-simple-plugin/wp-simple-plugin.php&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;wpsp_test&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
<span class="p">);</span>

<span class="c1">// call test-lib&#39;s bootstrap.php
</span><span class="c1"></span><span class="k">require_once</span> <span class="nv">$test_lib_bootstrap_file</span><span class="p">;</span>

<span class="nv">$current_user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WP_User</span><span class="p">(</span> <span class="mi">1</span> <span class="p">);</span>
<span class="nv">$current_user</span><span class="o">-&gt;</span><span class="na">set_role</span><span class="p">(</span> <span class="s1">&#39;administrator&#39;</span> <span class="p">);</span>

<span class="k">echo</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;Using Wordpress core : &#39;</span> <span class="o">.</span> <span class="nx">ABSPATH</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="k">echo</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
</code></pre></div>
<p>In bootstrap.php, we first check whether WordPress Tests Libs&rsquo;
bootstrap.php exists in includes directory else exit from the test run.
Next, we create an array which holds details of Simple Plugin as active
plugins and add the array to  <strong>$GLOBALS[&lsquo;wp_tests_options&rsquo;]</strong>.
WordPress Tests Lib activates and loads the plugin using these details.
We will explain the significance of the second item of the array,
<strong>wpsp_test,</strong>  in the next blog.</p>

<p>After defining the plugin details, we call <code>includes/bootstrap.php</code>
using require_once statement. The <code>includes/bootstrap.php</code> which is
actually the bootstrap file that comes with WordPress Tests Lib loads
new WordPress instance, activates and loads the Simple Plugin.</p>

<p>Next, we create the default user for test by using WordPress class
<a href="http://codex.wordpress.org/Class_Reference/WP_User" target="_blank">WP_User</a> and set
administrator role to it.</p>

<p>Earlier, we explained that includes/bootstrap.php creates a new instance
of WordPress, but from where it gets the configurations for WordPress.
The third and last configuration file is the <code>wp-tests-config.php</code> which
provides the configurations to WordPress test instance. Add the
<code>wp-tests-config.php</code> to <code>tests/phpunit</code> directory with following
contents.</p>

<p><code>wp-simple-plugin/tests/phpunit/wp-tests-config.php</code></p>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="c1">// change the next line to points to your wordpress dir
</span><span class="c1"></span><span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;ABSPATH&#39;</span><span class="p">,</span> <span class="s1">&#39;/opt/lampp/wptest/wordpress/&#39;</span> <span class="p">);</span>

<span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;WP_DEBUG&#39;</span><span class="p">,</span> <span class="k">false</span> <span class="p">);</span>

<span class="c1">// WARNING WARNING WARNING!
</span><span class="c1">// tests DROPS ALL TABLES in the database. DO NOT use a production database
</span><span class="c1"></span>
<span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;DB_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;wptest&#39;</span> <span class="p">);</span>
<span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;DB_USER&#39;</span><span class="p">,</span> <span class="s1">&#39;wptest&#39;</span> <span class="p">);</span>
<span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;DB_PASSWORD&#39;</span><span class="p">,</span> <span class="s1">&#39;wptest&#39;</span> <span class="p">);</span>
<span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;DB_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost.localdomain&#39;</span> <span class="p">);</span>
<span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;DB_CHARSET&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span> <span class="p">);</span>
<span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;DB_COLLATE&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span> <span class="p">);</span>

<span class="nv">$table_prefix</span> <span class="o">=</span> <span class="s1">&#39;wptests_&#39;</span><span class="p">;</span> <span class="c1">// Only numbers, letters, and underscores please!
</span><span class="c1"></span>
<span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;WP_TESTS_DOMAIN&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span> <span class="p">);</span>
<span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;WP_TESTS_EMAIL&#39;</span><span class="p">,</span> <span class="s1">&#39;admin@example.org&#39;</span> <span class="p">);</span>
<span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;WP_TESTS_TITLE&#39;</span><span class="p">,</span> <span class="s1">&#39;Test Blog&#39;</span> <span class="p">);</span>

<span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;WP_PHP_BINARY&#39;</span><span class="p">,</span> <span class="s1">&#39;php&#39;</span> <span class="p">);</span>

<span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;WPLANG&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span> <span class="p">);</span>
</code></pre></div>
<p>It defines the location of WordPress software using which instance has
to be created and the name of the test database.</p>

<p>At this point, your <code>wp-simple-plugin</code> directory structure should be
similar to the one shown in the screenshot.</p>

<figure class="text-center" >
  <img class="lazy" data-src="/tutorial/wordpress-plugin-development/media/wp-pd-sos-ut-dir-structure.png" alt="WordPress Plugin Unit Testing - unit test directory structure" />
</figure>


<h3 id="create-test-database">Create Test Database</h3>

<p>In <code>wp-tests-config.php</code> we defined MySQL connection properties pointing
to a test database. We need to create the database and user, and grant
permissions so that WordPress can create tables and run tests. Use
following commands to accomplish that.</p>
<div class="highlight"><pre class="chroma"><code class="language-screen" data-lang="screen">$ cd /opt/lampp
$ bin/mysql -u root
mysql&gt; create database wptest;
mysql&gt; GRANT ALL PRIVILEGES ON wptest.* TO wptest@localhost IDENTIFIED BY &#39;wptest&#39;;
mysql&gt; flush privileges;
mysql&gt; exit</code></pre></div>

<div>&nbsp;</div>

<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-1281079745125126"
     data-ad-slot="6135368983"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<div>&nbsp;</div>


<h3 id="install-wordpress">Install WordPress</h3>

<p>WordPress Tests Library requires WordPress software to create an test
instance. In <code>wp-tests-config.php</code>, we defined ABSPATH pointing it the
location of WordPress at <code>/opt/lampp/wptest/wordpress/</code>, but you are
free to install WordPress in any other location. While defining ABSPATH
ensure that path ends with a trailing slash as in
<code>/opt/lampp/wptest/wordpress/</code> otherwise WordPress fails to load.</p>

<p>Download the latest archive of WordPress and extract it with following
commands.</p>
<div class="highlight"><pre class="chroma"><code class="language-screen" data-lang="screen">$ cd /opt/lampp/
$ mkdir wptest
$ cd wptest
$ unzip wordpress-4.1.zip
$ chown -R xyz.xyz wordpress   // xyz is the user who runs test
$ chmod -R 775 wordpress</code></pre></div>
<p>User who runs test should have write access to wordpress/wp-content
directory and last two commands chown and chmod are used to set the
permission to wordpress and its subdirectories.</p>

<p>No further installation is required as WordPress as Tests Library will
use <code>wp-tests-config.php</code> to configure the WordPress Instance it
creates.</p>

<p><strong>Production WordPress</strong></p>

<p>We can point ABSPATH to any existing WordPress folder and run tests but
there is a downside. For some reason, if <code>wp-tests-config.php</code> is
missing from <code>tests/phpunit</code> directory, then WordPress Test Library will
use <code>wp-config.php</code> of the WordPress folder and drops the WP tables
defined by it. Keep this in mind, while pointing ABSPATH to a WordPress
folder of production site as you may end up loosing the production
database.</p>

<p>Since space required of WordPress software is very small it is much safe
to place WordPress in a dedicated test folder such as
<code>/opt/lampp/wptest</code> and keep it exclusively for testing. It also allows
us to place multiple WordPress version in wptest folder and run tests
against multiple versions.</p>

<p><a name="create-plugin-link"></a></p>

<h3 id="create-link-to-plugin">Create Link to Plugin</h3>

<p>We had defined Simple Plugin as active plugin in
<code>tests/phpunit/bootstrap.php</code>, but Test Library loads only the plugins
present in <code>wordpress/wp-content/plugins</code> directory. If we develop the
plugin directly from the plugins directory then Test Library finds and
activates the plugin without any problem.</p>

<p>Normally, it is much more convenient to develop the plugin from IDE
workspace or some other location and in such case, we have to create a
symbolic link to plugins&rsquo; actual location in
<code>wordpress/wp-content/plugins/</code> directory.</p>

<p>For example, if Simple Plugin is at <code>/home/xyz/work/wp-simple-plugin</code>
and WordPress package is at <code>/opt/lampp/wptest/wordpress</code>, then create
symbolic with following commands.</p>
<div class="highlight"><pre class="chroma"><code class="language-screen" data-lang="screen">$ cd /opt/lampp/wptest/wordpress/wp-content/plugins
$ ln -s /home/xyz/work/wp-simple-plugin wp-simple-plugin</code></pre></div>
<p>That completes the WordPress PHPUnit Setup. In the next blog, we write a
couple of simple unit tests and check whether the setup is working as
expected.</p>

    </main>
  </div>
</div>

<footer class="container-fluid mt-5">

    <div class="row">
        <div class="col ml-auto">
            <div class="row mb-1 ml-2">
                <a class="text-muted" href="/privacy-policy">Privacy</a>
            </div>
            <div class="row text-muted mb-2 ml-2">
                <span>&copy; 2019 &middot;Powered by <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span>
            </div>
        </div>
        <div class="col mr-auto">
            <span class="float-right">
                <a href="#" id="back_to_top">
                    <img src="/icon/arrow-up.png" alt="Back to Top">
                </a>
            </span>
        </div>
    </div>

</footer>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>







<script src="/js/vendor.min.d5750c855207aebcf4fdb7568961a27500008ef4a4f40b63a7b028f80a9221d3.js"></script>
</body>

</html>