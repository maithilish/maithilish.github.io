<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=description content="WordPress Save Post Tutorial explains the steps to save custom post and meta data. In the previous tutorial, we saw how to add custom post type and editor."><meta name=author content="Maithilish"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QYHTHXW09H"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QYHTHXW09H")</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://google.com/article"},"articleSection":"tutorial","name":"Save Post - WordPress Plugin Development - CodeTab","headline":"Save Post - WordPress Plugin Development - CodeTab","url":"https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/save-post/","description":"WordPress Save Post Tutorial explains the steps to save custom post and meta data. In the previous tutorial, we saw how to add custom post type and editor.","inLanguage":"en","image":"https://www.codetab.org/logo.jpg","author":"Maithilish","creator":"Maithilish","publisher":{"@type":"Organization","name":"Maithilish","url":"https://www.codetab.org/","logo":{"@type":"ImageObject","url":"https://www.codetab.org/logo.png","width":"200","height":"200"}},"copyrightHolder":"Maithilish","copyrightYear":"2019","datePublished":"2019-01-11T10:10:00+0530","dateModified":"2019-01-11T10:10:00+0530","wordCount":"1029","keywords":["wordpress save post","Blog"]}</script><link rel=icon href=/favicon.ico><link rel=stylesheet href=/css/vendor.min.b34f4a49e8fbf83dd7dd8f945eb35a939c19aa15051f677ac5a9c057ac6c8774.css integrity="sha256-s09KSej7+D3X3Y+UXrNak5wZqhUFH2d6xanAV6xsh3Q="><title>Save Post - WordPress Plugin Development - CodeTab</title>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1281079745125126" crossorigin=anonymous></script></head><body id=top><header><nav id=navbar-main class="navbar fixed-top navbar-light navbar-expand-lg bg-white border-bottom shadow-sm"><div class=container-fluid><a class=navbar-brand href=/>Codetab</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbar aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbar><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/#tutorials><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#projects><span>Projects</span></a></li><li class=nav-item><a class=nav-link href=/post><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#about><span>About</span></a></li></ul></div></div></nav></header><div class=container-fluid><div class=row>&nbsp;</div><div class=row><aside id=sidebar class=col-md-3><div class=row><nav id=navbar-side class="bg-light text-secondary"><h4 class="text-muted bg-white pl-2">WP Plugin Development</h4><nav class="navbar navbar-light bg-white navbar-expand-md"><button class="navbar-toggler ml-auto" type=button data-toggle=collapse data-target=#bookmenu aria-controls=bookmenu aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=bookmenu><div><div id="WordPress Plugin Development - CodeTab"><div><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/introduction/ class="toc-page text-wrap text-muted">Introduction</a></div><div><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/install-locally/ class="toc-page text-wrap text-muted">Install WP on Docker</a></div><div><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/simple-plugin/ class="toc-page text-wrap text-muted">Simple Plugin</a></div><div><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/shortcode/ class="toc-page text-wrap text-muted">Shortcode</a></div><div><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/plugin-structure/ class="toc-page text-wrap text-muted">Plugin Structure</a></div><div><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/plugin-main-file/ class="toc-page text-wrap text-muted">Main File</a></div><div><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/hooks-actions-filters/ class="toc-page text-wrap text-muted">Hooks, Actions, Filters</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-wordpress-plugin-development-admin-module-settings id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Admin - Settings</a><div id=tutorial-wordpress-plugin-development-admin-module-settings class=collapse><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-settings/add-menu/ class="toc-page dropdown-item text-wrap text-muted">Add Menu
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-settings/settings-api/ class="toc-page dropdown-item text-wrap text-muted">Settings API
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-settings/options-page/ class="toc-page dropdown-item text-wrap text-muted">Options Page</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-wordpress-plugin-development-admin-module-custom-posts id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Admin - Posts</a><div id=tutorial-wordpress-plugin-development-admin-module-custom-posts><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/post-type/ class="toc-page dropdown-item text-wrap text-muted">Custom Post Type
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/meta-box/ class="toc-page dropdown-item text-wrap text-muted">Meta Box
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/save-post/ class="toc-page dropdown-item text-wrap text-danger">Save Post</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-wordpress-plugin-development-frontend id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Frontend</a><div id=tutorial-wordpress-plugin-development-frontend class=collapse><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/frontend/enqueue-scripts/ class="toc-page dropdown-item text-wrap text-muted">Plugin Enqueue Scripts
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/frontend/pass-data-to-javascript/ class="toc-page dropdown-item text-wrap text-muted">Pass Data to JavaScript
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/frontend/debug-info/ class="toc-page dropdown-item text-wrap text-muted">Debug Info</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-wordpress-plugin-development-ajax id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Ajax</a><div id=tutorial-wordpress-plugin-development-ajax class=collapse><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/wordpress-ajax/ class="toc-page dropdown-item text-wrap text-muted">Ajax
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/chart-page/ class="toc-page dropdown-item text-wrap text-muted">Chart Page
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/google-charts/ class="toc-page dropdown-item text-wrap text-muted">Google Charts</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-wordpress-plugin-development-internationalization id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Internationalization</a><div id=tutorial-wordpress-plugin-development-internationalization class=collapse><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/internationalization/internationalize/ class="toc-page dropdown-item text-wrap text-muted">Internationalization
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/internationalization/localization/ class="toc-page dropdown-item text-wrap text-muted">Localization</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-wordpress-plugin-development-activation id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Activation</a><div id=tutorial-wordpress-plugin-development-activation class=collapse><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/activation/plugin-activation/ class="toc-page dropdown-item text-wrap text-muted">Activation
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/activation/enable-multisite/ class="toc-page dropdown-item text-wrap text-muted">Multi site
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/activation/multisite-activation/ class="toc-page dropdown-item text-wrap text-muted">Multi site Activation
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/activation/plugin-deactivation/ class="toc-page dropdown-item text-wrap text-muted">Deactivation
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/activation/plugin-uninstall/ class="toc-page dropdown-item text-wrap text-muted">Uninstall</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-wordpress-plugin-development-unit-test id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Testing</a><div id=tutorial-wordpress-plugin-development-unit-test class=collapse><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/plugin-unit-testing/ class="toc-page dropdown-item text-wrap text-muted">Unit Test
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/setup/ class="toc-page dropdown-item text-wrap text-muted">Test Setup
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/simple-unit-tests/ class="toc-page dropdown-item text-wrap text-muted">Simple Unit Tests
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/scripts-actions-filters/ class="toc-page dropdown-item text-wrap text-muted">Unit Test Scripts, Actions, Filters
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/advanced-unit-tests/ class="toc-page dropdown-item text-wrap text-muted">Advanced Unit Tests
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/internationalization-functions/ class="toc-page dropdown-item text-wrap text-muted">Test Internationalization Functions
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/ajax/ class="toc-page dropdown-item text-wrap text-muted">Ajax Unit Tests
</a><a href=https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/multisite-plugin-unit-tests/ class="toc-page dropdown-item text-wrap text-muted">Multi site Plugin Unit Tests</a></div></div></div></div></nav></nav></div></aside><div id=contentbar class=col-md-8><div id=share class="row justify-content-end"><div title=twitter><a href="https://twitter.com/intent/tweet?url=https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/save-post/&amp;text=Save%20Post%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target=_blank rel=noopener><i class="icon-twitter-squared text-secondary"></i></a></div><div title=facebook><a href="https://www.facebook.com/sharer.php?u=https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/save-post/&amp;t=Save%20Post%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target=_blank rel=noopener><i class="icon-facebook-squared text-secondary"></i></a></div><div title=linkedin><a href="https://www.linkedin.com/shareArticle?url=https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/save-post/&amp;title=Save%20Post%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target=_blank rel=noopener><i class="icon-linkedin-squared text-secondary"></i></a></div><div title=email><a href="mailto:?subject=Save%20Post%20-%20WordPress%20Plugin%20Development%20-%20CodeTab&amp;body=https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/save-post/" target=_blank rel=noopener><i class="icon-mail-squared text-secondary"></i></a></div><div title=whatsapp><a href="https://web.whatsapp.com/send?text=Save%20Post%20-%20WordPress%20Plugin%20Development%20-%20CodeTab%20https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/save-post/" target=_blank rel=noopener><i class="icon-whatsapp text-secondary"></i></a></div><div title=reddit><a href="https://reddit.com/submit?url=https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/save-post/&amp;title=Save%20Post%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target=_blank rel=noopener><i class="icon-reddit-alien text-secondary"></i></a></div><i class="icon-blank ctab-transparent"></i></div><div class=row><main id=content class="col-md-11 post-basic"><h2 id=73wordpress-save-post>7.3. WordPress Save Post</h2><p>In the previous two blogs, we saw how to add custom post type and
customize post editor. In this blog, we cover the steps to save the
custom post and its meta data.</p><figure class=text-center><img class="lazy img-fluid" data-src=/tutorial/wordpress-plugin-development/media/wp-pd-sos-custom-post-publish.png alt="WordPress Save Post - WordPress Publish Meta box"></figure><p>We added sos custom post type as use it as social lockers. Sos Lockers
defines four meta data fields. One of benefits of WordPress Custom Post
Type is that we can use WordPress Post management framework to handle
activities such as publish, trash and edit. For example, to save or
publish a social locker, we use the WordPress Post Publish button. This
reduces large amount of code as the task of saving the Post (Social
Locker) and its content is delegated to WordPress posts module.</p><h3 id=wordpress-save-post-and-meta-data>WordPress Save Post and Meta Data</h3><p>Though WordPress Post management framework takes care of publishing the
custom post, the meta data management is still left to the plugin
developer.</p><p>To do that, WordPress provides <strong>save_post</strong> action hook. After saving
the post, WordPress executes action methods attached to the hook. In
<code>Sos::setup()</code> method, we add <code>Sos::save_post()</code> method as the action to
the save_post hook.</p><p><code>share-on-social/admin/class-sos.php</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>setup</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>....</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>add_action</span><span class=p>(</span> <span class=s1>&#39;save_post&#39;</span><span class=p>,</span> <span class=k>array</span><span class=p>(</span><span class=nv>$this</span><span class=p>,</span><span class=s1>&#39;save_post&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>....</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>function</span> <span class=nf>save_post</span> <span class=p>(</span> <span class=nv>$post_id</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=nx>defined</span><span class=p>(</span> <span class=s1>&#39;DOING_AUTOSAVE&#39;</span> <span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nx>DOING_AUTOSAVE</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=o>!</span> <span class=nx>isset</span><span class=p>(</span> <span class=nv>$_POST</span><span class=p>[</span> <span class=s1>&#39;locker_nonce&#39;</span> <span class=p>]</span> <span class=p>)</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>                 <span class=o>!</span> <span class=nx>wp_verify_nonce</span><span class=p>(</span> <span class=nv>$_POST</span><span class=p>[</span> <span class=s1>&#39;locker_nonce&#39;</span> <span class=p>],</span> <span class=s1>&#39;save_locker&#39;</span> <span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=o>!</span> <span class=nx>current_user_can</span><span class=p>(</span> <span class=s1>&#39;edit_posts&#39;</span> <span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>....</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nv>$id</span> <span class=o>=</span> <span class=s1>&#39;share_target&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$data</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>sanitized_text</span><span class=p>(</span> <span class=nv>$id</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>update_post_meta</span><span class=p>(</span> <span class=nv>$post_id</span><span class=p>,</span> <span class=nv>$id</span><span class=p>,</span> <span class=nv>$data</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>.....</span>
</span></span><span class=line><span class=cl>     <span class=p>}</span>
</span></span></code></pre></div><p>In the <code>save_post()</code> method, we return without doing anything if
WordPress is auto saving the post or current user doesn&rsquo;t have
<strong>edit_posts</strong> capability. We also check whether <strong>locker_nonce</strong> is
set for save_locker. This nonce ensures two things, firstly
save_post() method is executes only for sos custom post type as for
other post types this nonce is not set and secondly it secures the
publish request.</p><p>After passing these three conditions, we start to save meta data fields
with WordPress function <a href=http://codex.wordpress.org/Function_Reference/update_post_meta target=_blank>update_post_meta()</a>. To the function, we pass the data returned by helper method - sanitized_text().</p><p><code>share-on-social/admin/class-sos.php</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl>    <span class=k>function</span> <span class=nf>sanitized_text</span> <span class=p>(</span> <span class=nv>$id</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$data</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=nx>isset</span><span class=p>(</span> <span class=nv>$_POST</span><span class=p>[</span> <span class=nv>$id</span> <span class=p>]</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$data</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span> <span class=nv>$id</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>sanitize_text_field</span><span class=p>(</span> <span class=nv>$data</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>In the helper method, we obtain the data from $_POST if it is set and
then sanitize it using WordPress function <a href=http://codex.wordpress.org/Function_Reference/sanitize_text_field target=_blank>sanitize_text_field()</a>.</p><p>Similarly, we handle other meta data field such as locker id, share on
and locker text.</p><div>&nbsp;</div><div>&nbsp;</div><h3 id=duplicate-id>Duplicate ID</h3><p>By using WordPress Post management framework, we avoid lots of code to
save the locker. But there is a glitch. When we add multiple lockers
with same id, WordPress happily saves them as it is not equipped to
distinguish the duplicate posts. Lockers have to enforce unique
constraint so that no two lockers can have same id.</p><p>In WordPress, there is no way to intercept and stop WordPress from
publishing the post. Best we can do is, after the post publish check
whether locker id is duplicate and if so, save an empty id and output
duplicate id message to the user.</p><p><code>share-on-social/admin/class-sos.php</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl>    <span class=k>function</span> <span class=nf>save_post</span> <span class=p>(</span> <span class=nv>$post_id</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>....</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nv>$id</span> <span class=o>=</span> <span class=s1>&#39;locker_id&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$data</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>sanitized_text</span><span class=p>(</span> <span class=nv>$id</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=s1>&#39;&#39;</span> <span class=o>==</span> <span class=nv>$data</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>set_transient</span><span class=p>(</span> <span class=s1>&#39;sos_invalid_id&#39;</span><span class=p>,</span> <span class=k>true</span><span class=p>,</span> <span class=mi>180</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>update_post_meta</span><span class=p>(</span> <span class=nv>$post_id</span><span class=p>,</span> <span class=nv>$id</span><span class=p>,</span> <span class=nv>$data</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>is_duplicate_locker</span><span class=p>(</span> <span class=nv>$post_id</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nv>$data</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=nx>update_post_meta</span><span class=p>(</span> <span class=nv>$post_id</span><span class=p>,</span> <span class=nv>$id</span><span class=p>,</span> <span class=nv>$data</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>set_transient</span><span class=p>(</span> <span class=s1>&#39;sos_duplicate_id&#39;</span><span class=p>,</span> <span class=k>true</span><span class=p>,</span> <span class=mi>180</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>update_post_meta</span><span class=p>(</span> <span class=nv>$post_id</span><span class=p>,</span> <span class=nv>$id</span><span class=p>,</span> <span class=nv>$data</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>....</span>
</span></span><span class=line><span class=cl>     <span class=p>}</span>
</span></span></code></pre></div><p>In the save_post() method, we check whether locker id is duplicate and
if so, we set id to an empty string and then set a flag -
<strong>sos_duplicate_id</strong> - as a transient option.</p><p>WordPress Transient Options are similar to WordPress Options, but they
expire after certain interval. We use WordPress function
<a href=http://codex.wordpress.org/Function_Reference/set_transient target=_blank>set_transient()</a>
to set the flag for 180 seconds and after which it is deleted from
database.</p><p>To display the duplicate id message we require another action hook
<strong>admin_notices</strong>. This hook is used to display messages and notices at
the top of the editor.</p><p><code>share-on-social/admin/class-sos.php</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>setup</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>add_action</span><span class=p>(</span> <span class=s1>&#39;admin_notices&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=k>array</span><span class=p>(</span><span class=nv>$this</span><span class=p>,</span><span class=s1>&#39;sos_admin_notice&#39;</span><span class=p>)</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>function</span> <span class=nf>sos_admin_notice</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$duplicate_id</span> <span class=o>=</span> <span class=nx>get_transient</span><span class=p>(</span> <span class=s1>&#39;sos_duplicate_id&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>delete_transient</span><span class=p>(</span> <span class=s1>&#39;sos_duplicate_id&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=nv>$duplicate_id</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$message1</span> <span class=o>=</span> <span class=nx>__</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;Duplicate Locker ID! Save the locker with an unique Locker ID.&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;sos-domain&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nv>$html</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=nv>$duplicate_id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$html</span> <span class=o>=</span> <span class=s>&lt;&lt;&lt;</span><span class=dl>EOD</span><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>   &lt;div class=&#34;error&#34;&gt;&lt;p&gt;{$message1} {$message2}&lt;/p&gt;&lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=s></span><span class=dl>EOD</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=nv>$html</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><figure class=text-center><img class="lazy img-fluid" data-src=/tutorial/wordpress-plugin-development/media/wp-pd-sos-custom-post-duplicate-error.png alt="WordPress Save Post - WordPress Publish Meta box"></figure><p>Why are we doing this? The action method save_post() executes between
submission of publish form and display of the request. We can&rsquo;t pass the
duplicate id message from save_post() method to the request output
through $_POST or other mechanism. Workaround is to set a flag as a
temporary option and echo the message to request output.</p><p>Posts, before save, pass through <strong>wp_insert_post_data</strong> filter and
it looks promising for duplicate id issue. So far, we have not tried it
out and may do so in future.</p><h3 id=change-post-updated-message>Change Post Updated Message</h3><p>To change post save and update messages for custom post type, use filter
hook post_updated_messages.</p><p><code>share-on-social/admin/class-sos.php</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>setup</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>add_filter</span><span class=p>(</span> <span class=s1>&#39;post_updated_messages&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=k>array</span><span class=p>(</span><span class=nv>$this</span><span class=p>,</span><span class=s1>&#39;filter_published_message&#39;</span> <span class=p>)</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>....</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>function</span> <span class=nf>filter_published_message</span> <span class=p>(</span> <span class=nv>$messages</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>global</span> <span class=nv>$post</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=k>false</span> <span class=o>==</span> <span class=nx>isset</span><span class=p>(</span> <span class=nv>$post</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nv>$messages</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=nv>$post</span><span class=o>-&gt;</span><span class=na>post_type</span> <span class=o>!=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>post_type</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nv>$messages</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nv>$index</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$message</span> <span class=o>=</span> <span class=nx>__</span><span class=p>(</span> <span class=s1>&#39;Share Locker updated&#39;</span><span class=p>,</span> <span class=s1>&#39;sos-domain&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$messages</span><span class=p>[</span> <span class=s1>&#39;post&#39;</span> <span class=p>][</span> <span class=nv>$index</span> <span class=p>]</span> <span class=o>=</span> <span class=nv>$message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nv>$index</span> <span class=o>=</span> <span class=mi>6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$message</span> <span class=o>=</span> <span class=nx>__</span><span class=p>(</span> <span class=s1>&#39;Share Locker saved&#39;</span><span class=p>,</span> <span class=s1>&#39;sos-domain&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$messages</span><span class=p>[</span> <span class=s1>&#39;post&#39;</span> <span class=p>][</span> <span class=nv>$index</span> <span class=p>]</span> <span class=o>=</span> <span class=nv>$message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$messages</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><div>&nbsp;</div><div>&nbsp;</div><p>WordPress passes array of messages as parameter to the callback
function. If post type is sos, we change messages at index 1 and 6 which
corresponds to update and save respectively and return the modified
array back to the WordPress. For other post types, return the unmodified
array.</p><p>In the tutorial, so far, we saw how to manage settings and custom
lockers. With those admin modules in place we are ready to explore the
plugins&rsquo; frontend. In the next chapter, we go through some of the
important features that are essential for the frontend.</p></main></div></div><aside id=sidebar-right class=col-md-1><div class="row my-5 justify-content-center"></div></aside></div></div><footer class="container-fluid mt-5"><div class=row><div class="col ml-auto"><div class="row mb-1 ml-2"><a class=text-muted href=/privacy-policy>Privacy</a></div><div class="row text-muted mb-2 ml-2"><span>&copy; 2019 &#183;Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span></div></div><div class="col mr-auto"><span class=float-right><a href=# id=back_to_top><i class="icon-up-open h1 text-secondary"></i></a></span></div></div></footer><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script src=/js/vendor.min.c32ad1c7e87da9243fe3a4ff30c9040737545641e3a0a16a1cde4d62759f9fea.js></script></body></html>