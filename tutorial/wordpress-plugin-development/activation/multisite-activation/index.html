<!DOCTYPE html>
<html lang="en-us">

<head><meta charset="utf-8">
<meta name="description" content="WordPress Multisite Activation Tutorial shows how to code the plugin activation in WordPress Multisite Installations.">
<meta name="author" content="Maithilish">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">



<script async src="https://www.googletagmanager.com/gtag/js?id=UA-42139846-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-42139846-3');
</script>

<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://www.codetab.org/"
        },
        "articleSection" : "tutorial",
        "name" : "Multisite Activation - WordPress Plugin Development - CodeTab",
        "headline" : "Multisite Activation - WordPress Plugin Development - CodeTab",
        "description" : "WordPress Multisite Activation Tutorial shows how to code the plugin activation in WordPress Multisite Installations.",
        "inLanguage" : "en",
        "author" : "Maithilish",
        "creator" : "Maithilish",
        "publisher": "Maithilish",
        "copyrightHolder" : "Maithilish",
        "copyrightYear" : "2019",
        "datePublished": "2019-01-11 12:18:00 +0530 IST",
        "dateModified" : "2019-01-11 12:18:00 +0530 IST",
        "url" : "/tutorial/wordpress-plugin-development/activation/multisite-activation/",
        "wordCount" : "632",
        "keywords" : [ "wordpress multisite activation","Blog" ]
    }
</script>
<link rel="icon" href="/favicon.ico">






<link rel="stylesheet" href="/css/vendor.min.06af1451a3c5b3b70a0c0bd7be26092e20e9c31251c08d44dbe1486a9a2a414c.css" integrity="sha256-Bq8UUaPFs7cKDAvXviYJLiDpwxJRwI1E2&#43;FIapoqQUw=">

<title>Multisite Activation - WordPress Plugin Development - CodeTab</title></head>

<body id="top"><header><nav id="navbar-main" class="navbar fixed-top navbar-light navbar-expand-lg bg-white border-bottom shadow-sm">

    <div class="container-fluid">

        
        <a class="navbar-brand" href="/">Codetab</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbar">

            
            
            <ul class="navbar-nav ml-auto">
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#tutorials"  >
                        
                        <span>Home</span>
                        
                    </a>
                </li>

                
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#projects"  >
                        
                        <span>Projects</span>
                        
                    </a>
                </li>

                
                

                

                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/post"  >
                        
                        <span>Posts</span>
                        
                    </a>
                </li>

                
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#about"  >
                        
                        <span>About</span>
                        
                    </a>
                </li>

                
                

            </ul>

        </div>
    </div>
</nav></header>

<div class="container-fluid">
  <div class="row">&nbsp;</div>
  <div class="row">
    <aside id="sidebar" class="col-md-4">
      <div class="row"><nav id="navbar-side" class="bg-light text-secondary">
        
    
    

    

    
    

    

    <h4 class="text-muted bg-white pl-2">WP Plugin Development</h4>

    <nav class="navbar navbar-light bg-white navbar-expand-md">

        <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#bookmenu"
            aria-controls="bookmenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bookmenu">
            <div>
                
                









<div id="WordPress Plugin Development - CodeTab">
    
    <div>
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/introduction/" class="toc-page text-muted ">
            Introduction
        </a>
    </div>
    
    <div>
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/install-locally/" class="toc-page text-muted ">
            Install Locally
        </a>
    </div>
    
    <div>
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/simple-plugin/" class="toc-page text-muted ">
            Simple Plugin
        </a>
    </div>
    
    <div>
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/shortcode/" class="toc-page text-muted ">
            Shortcode
        </a>
    </div>
    
    <div>
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/plugin-structure/" class="toc-page text-muted ">
            Plugin Structure
        </a>
    </div>
    
    <div>
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/plugin-main-file/" class="toc-page text-muted ">
            Main File
        </a>
    </div>
    
    <div>
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/hooks-actions-filters/" class="toc-page text-muted ">
            Hooks, Actions, Filters
        </a>
    </div>
    
</div>







<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-admin-module-settings" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Admin Module - Settings
    </a>
    
    <div id="tutorial-wordpress-plugin-development-admin-module-settings" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-settings/add-menu/" class="toc-page dropdown-item text-muted">
            Add Menu
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-settings/settings-api/" class="toc-page dropdown-item text-muted">
            Settings API
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-settings/options-page/" class="toc-page dropdown-item text-muted">
            Options Page
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-admin-module-custom-posts" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Admin Module - Posts
    </a>
    
    <div id="tutorial-wordpress-plugin-development-admin-module-custom-posts" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/post-type/" class="toc-page dropdown-item text-muted">
            Custom Post Type
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/meta-box/" class="toc-page dropdown-item text-muted">
            Meta Box
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/admin-module-custom-posts/save-post/" class="toc-page dropdown-item text-muted">
            Save Post
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-frontend" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Frontend
    </a>
    
    <div id="tutorial-wordpress-plugin-development-frontend" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/frontend/enqueue-scripts/" class="toc-page dropdown-item text-muted">
            Plugin Enqueue Scripts
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/frontend/pass-data-to-javascript/" class="toc-page dropdown-item text-muted">
            Pass Data to JavaScript
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/frontend/debug-info/" class="toc-page dropdown-item text-muted">
            Debug Info
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-ajax" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Ajax
    </a>
    
    <div id="tutorial-wordpress-plugin-development-ajax" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/wordpress-ajax/" class="toc-page dropdown-item text-muted">
            Ajax
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/chart-page/" class="toc-page dropdown-item text-muted">
            Chart Page
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/ajax/google-charts/" class="toc-page dropdown-item text-muted">
            Google Charts
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-internationalization" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Internationalization
    </a>
    
    <div id="tutorial-wordpress-plugin-development-internationalization" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/internationalization/internationalize/" class="toc-page dropdown-item text-muted">
            Internationalization
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/internationalization/localization/" class="toc-page dropdown-item text-muted">
            Localization
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-activation" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Activation
    </a>
    
    <div id="tutorial-wordpress-plugin-development-activation" class="">
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/activation/plugin-activation/" class="toc-page dropdown-item text-muted">
            Activation
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/activation/enable-multisite/" class="toc-page dropdown-item text-muted">
            Multi site
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/activation/multisite-activation/" class="toc-page dropdown-item text-danger">
            Multi site Activation
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/activation/plugin-deactivation/" class="toc-page dropdown-item text-muted">
            Deactivation
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/activation/plugin-uninstall/" class="toc-page dropdown-item text-muted">
            Uninstall
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-wordpress-plugin-development-unit-test" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Testing
    </a>
    
    <div id="tutorial-wordpress-plugin-development-unit-test" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/plugin-unit-testing/" class="toc-page dropdown-item text-muted">
            Unit Test
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/setup/" class="toc-page dropdown-item text-muted">
            Test Setup
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/simple-unit-tests/" class="toc-page dropdown-item text-muted">
            Simple Unit Tests
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/scripts-actions-filters/" class="toc-page dropdown-item text-muted">
            Unit Test Scripts, Actions, Filters
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/advanced-unit-tests/" class="toc-page dropdown-item text-muted">
            Advanced Unit Tests
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/internationalization-functions/" class="toc-page dropdown-item text-muted">
            Test Internationalization Functions
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/ajax/" class="toc-page dropdown-item text-muted">
            Ajax Unit Tests
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/wordpress-plugin-development/unit-test/multisite-plugin-unit-tests/" class="toc-page dropdown-item text-muted">
            Multi site Plugin Unit Tests
        </a>
        
        
        
        
    </div>
</div>



                
            </div>
        </div>
    </nav>

</nav>

</div>
      <div class="row my-5 justify-content-center">
<div>&nbsp;</div>


<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-1281079745125126"
     data-ad-slot="8963022093"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<div>&nbsp;</div>
</div>
    </aside>
    <div id="contentbar" class="col-md-8">
      <div id="share" class="row justify-content-end">





<div title=twitter>
    <a href="https://twitter.com/intent/tweet?url=https://www.codetab.org/tutorial/wordpress-plugin-development/activation/multisite-activation/&amp;text=Multisite%20Activation%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target="_blank" rel="noopener">
        <i class="icon-twitter-squared text-secondary"></i>
    </a>
</div>




<div title=facebook>
    <a href="https://www.facebook.com/sharer.php?u=https://www.codetab.org/tutorial/wordpress-plugin-development/activation/multisite-activation/&amp;t=Multisite%20Activation%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target="_blank" rel="noopener">
        <i class="icon-facebook-squared text-secondary"></i>
    </a>
</div>




<div title=linkedin>
    <a href="https://www.linkedin.com/shareArticle?url=https://www.codetab.org/tutorial/wordpress-plugin-development/activation/multisite-activation/&amp;title=Multisite%20Activation%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target="_blank" rel="noopener">
        <i class="icon-linkedin-squared text-secondary"></i>
    </a>
</div>




<div title=email>
    <a href="mailto:?subject=Multisite%20Activation%20-%20WordPress%20Plugin%20Development%20-%20CodeTab&amp;body=https://www.codetab.org/tutorial/wordpress-plugin-development/activation/multisite-activation/" target="_blank" rel="noopener">
        <i class="icon-mail-squared text-secondary"></i>
    </a>
</div>




<div title=whatsapp>
    <a href="https://web.whatsapp.com/send?text=Multisite%20Activation%20-%20WordPress%20Plugin%20Development%20-%20CodeTab%20https://www.codetab.org/tutorial/wordpress-plugin-development/activation/multisite-activation/" target="_blank" rel="noopener">
        <i class="icon-whatsapp text-secondary"></i>
    </a>
</div>




<div title=reddit>
    <a href="https://reddit.com/submit?url=https://www.codetab.org/tutorial/wordpress-plugin-development/activation/multisite-activation/&amp;title=Multisite%20Activation%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target="_blank" rel="noopener">
        <i class="icon-reddit-alien text-secondary"></i>
    </a>
</div>




<div title=weibo>
    <a href="https://service.weibo.com/share/share.php?url=https://www.codetab.org/tutorial/wordpress-plugin-development/activation/multisite-activation/&amp;title=Multisite%20Activation%20-%20WordPress%20Plugin%20Development%20-%20CodeTab" target="_blank" rel="noopener">
        <i class="icon-weibo text-secondary"></i>
    </a>
</div>




<i class="icon-blank ctab-transparent"></i></div>
      <div class="row">
        <main id="content" class="col-md-11 post-basic">
          

<h2 id="11-3-wordpress-multisite-activation">11.3. WordPress Multisite Activation</h2>

<p>In the previous blog, we installed and configured WordPress Multisite.
In this blog, we explain the plugin activation in Multisite
Installations.</p>

<h3 id="multisite-super-admin-and-site-admins">Multisite Super Admin and Site Admins</h3>

<p>WordPress Multisite Installation will have a Super Admin (SA) to manage
the network and multiple admins to manage the sites in the network.</p>

<p>In multisite, only SA can install (add) and update the plugins and site
admins are not allowed to do so.</p>

<p>SA can activate or deactivate the plugins network wide. When SA
activates a plugin network wide, it will be activated in all the sites.
Network wide activated plugins are not listed in the site admin
<strong>Plugins</strong> menu.</p>

<figure class="text-center" >
  <img class="lazy" data-src="/tutorial/wordpress-plugin-development/media/wp-pd-ms-plugin-network-activation.png/" alt="WordPress Multisite Activation" />
</figure>


<p>However, when a plugin is installed but not activated by SA then it is
listed in site admin <strong>Plugins</strong> menu and they can activate/deactivate
the plugin for their site.</p>

<p>SA can also control whether <strong>Plugins</strong> menu is enabled for site admins.
To enable Plugins menu for sites, open Network Admin Dashboard and go to
<strong>Settings</strong> → <strong>Network Settings</strong> and scroll down to Menu Settings
section at the end and check the <strong>Enable administration menus</strong>. When
enabled, site admin menu panel will have the <strong>Plugins</strong> menu else it is
not displayed.</p>



<div>&nbsp;</div>

<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-1281079745125126"
     data-ad-slot="6135368983"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<div>&nbsp;</div>




<h3 id="wordpress-multisite-plugin-activation">WordPress Multisite Plugin Activation</h3>

<p>The plugin activation method uses WordPress function is_multisite() and
parameter $networkwide to handle the multisite activation.</p>

<p><code>share-on-social/admin/class-activator.php</code></p>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php">class Sos_Activator {

    public function setup () {
        register_activation_hook( SOS_PLUGIN_FILE, 
                array( $this,&#39;activate&#39; ));
    }

    public function activate ( $networkwide ) {
        if ( function_exists( &#39;is_multisite&#39; ) <span class="err">&amp;&amp;</span> is_multisite() ) {
            if ( $networkwide ) {
                if ( false == is_super_admin() ) {
                    return;
                }
                $blogs = wp_get_sites();
                foreach ( $blogs as $blog ) {
                    switch_to_blog( $blog[ &#39;blog_id&#39; ] );
                    $this-&gt;activate_for_blog();
                    restore_current_blog();
                }
            } else {
                if ( false == current_user_can( &#39;activate_plugins&#39; ) ) {
                    return;
                }
                $this-&gt;activate_for_blog();
            }
        } else {
            // single site stuff
            ....            
        }
    }</code></pre></div>
<p>The WordPress function is <a href="http://codex.wordpress.org/Function_Reference/is_multisite" target="_blank">_multisite()</a> doesn&rsquo;t exist in normal WordPress installation. Hence, we check whether the function exists and then call it to check whether the installation is multisite. If installation is not multisite enabled, then we activate the plugin for the single site as explained in <a href="/tutorial/wordpress-plugin-development/activation/plugin-activation/#sec-activation">Plugin Activation</a>.</p>

<p>If is_multisite() is true, then we check, with the help of $networkwide
parameter, whether it is a network wide activation by SA or site level
activation by site admin.</p>

<p>In network wide activation by SA, we first check whether the user is
really a SA using WordPress function
<a href="http://codex.wordpress.org/Function_Reference/is_super_admin" target="_blank">is_super_admin()</a>.</p>

<p>Next, we fetch the list of all sites in the network using WordPress
function
<a href="http://codex.wordpress.org/Function_Reference/wp_get_sites" target="_blank">wp_get_sites()</a>.
Sites in multisite are also called as blogs. We loop through the list of
blogs and for each blog (site), we fetch its id using <code>$blog['blog_id']</code> and then call WordPress function <a href="http://codex.wordpress.org/Function_Reference/switch_to_blog" target="_blank">switch_to_blog()</a>
to switch to that site and the activate the plugin for the blog by
calling <code>Sos_Activator::activate_for_blog()</code>.</p>



<div>&nbsp;</div>

<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-1281079745125126"
     data-ad-slot="6135368983"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<div>&nbsp;</div>



<p>After activating the plugin for a blog, we need to call WordPress
function
<a href="http://codex.wordpress.org/WPMU_Functions/restore_current_blog" target="_blank">restore_current_blog()</a> so that internal pointers are reverted back to the site before switching
the site.</p>

<p>We continue the process for all sites of the network so that plugin gets
activated in all sites.</p>

<p><strong>Network Wide</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-screen" data-lang="screen">$blogs = wp_get_sites();
foreach ( $blogs as $blog ) {
    switch_to_blog( $blog[ &#39;blog_id&#39; ] );      
      .... do something
    restore_current_blog();
}</code></pre></div>
<p>We see this pattern in activation, deactivation and uninstall code which
as follows.</p>

<ul>
<li><p>get the list of blogs (sites) in the network.</p></li>

<li><p>for each site, call switch_to_blog() to switch to the site</p></li>

<li><p>do something by calling appropriate method.</p></li>

<li><p>revert back to the existing site using restore_current_blog().</p></li>
</ul>

<p>Remember to call restore_current_blog() before switching to the next
blog within the loop and failure to do so may lead to inconsistency.</p>

<p>In the next section, we go through the plugin deactivation code.</p>

        </main>
        <aside id="sidebar-right" class="col-md-1">
        </aside>
      </div>
    </div>
  </div>
</div>

<footer class="container-fluid mt-5">

    <div class="row">
        <div class="col ml-auto">
            <div class="row mb-1 ml-2">
                <a class="text-muted" href="/privacy-policy">Privacy</a>
            </div>
            <div class="row text-muted mb-2 ml-2">
                <span>&copy; 2019 &middot;Powered by <a href="https://gohugo.io" target="_blank"
                        rel="noopener">Hugo</a></span>
            </div>
        </div>
        <div class="col mr-auto">
            <span class="float-right">
                <a href="#" id="back_to_top">
                    <i class="icon-up-open h1 text-secondary"></i>
                </a>
            </span>
        </div>
    </div>

</footer>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>








<script src="/js/vendor.min.d5750c855207aebcf4fdb7568961a27500008ef4a4f40b63a7b028f80a9221d3.js"></script>
</body>

</html>