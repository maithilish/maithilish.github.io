<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=description content="With Persistence Gotz offers following benefits. reduce network usage as it can reuse the downloaded pages recover from the aborted run"><meta name=author content="Maithilish"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-42139846-3"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-42139846-3")</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://google.com/article"},"articleSection":"tutorial","name":"Persistence - Gotz ETL - CodeTab","headline":"Persistence - Gotz ETL - CodeTab","url":"https://www.codetab.org/tutorial/gotz-etl/persistence/","description":"With Persistence Gotz offers following benefits. reduce network usage as it can reuse the downloaded pages recover from the aborted run","inLanguage":"en","image":"https://www.codetab.org/logo.jpg","author":"Maithilish","creator":"Maithilish","publisher":{"@type":"Organization","name":"Maithilish","url":"https://www.codetab.org/","logo":{"@type":"ImageObject","url":"https://www.codetab.org/logo.png","width":"200","height":"200"}},"copyrightHolder":"Maithilish","copyrightYear":"2019","datePublished":"2019-01-11T21:10:00+0530","dateModified":"2019-01-11T21:10:00+0530","wordCount":"653","keywords":["persistence","Blog"]}</script><link rel=icon href=/favicon.ico><link rel=stylesheet href=/css/vendor.min.36dba173dca94f4b9fca7c6a1c3d15560f7a96c6ab0c0042dcd000f8469a9dc1.css integrity="sha256-Ntuhc9ypT0ufynxqHD0VVg96lsarDABC3NAA+EaancE="><title>Persistence - Gotz ETL - CodeTab</title></head><body id=top><header><nav id=navbar-main class="navbar fixed-top navbar-light navbar-expand-lg bg-white border-bottom shadow-sm"><div class=container-fluid><a class=navbar-brand href=/>Codetab</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbar aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbar><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/#tutorials><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#projects><span>Projects</span></a></li><li class=nav-item><a class=nav-link href=/post><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#about><span>About</span></a></li></ul></div></div></nav></header><div class=container-fluid><div class=row>&nbsp;</div><div class=row><aside id=sidebar class=col-md-3><div class=row><nav id=navbar-side class="bg-light text-secondary"><h4 class="text-muted bg-white pl-2">Gotz ETL</h4><nav class="navbar navbar-light bg-white navbar-expand-md"><button class="navbar-toggler ml-auto" type=button data-toggle=collapse data-target=#bookmenu aria-controls=bookmenu aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=bookmenu><div><div id="Gotz ETL - Gotz ETL - CodeTab"><div><a href=https://www.codetab.org/tutorial/gotz-etl/gotz-installation-quick-start/ class="toc-page text-wrap text-muted">Installation and Quick Start</a></div><div><a href=https://www.codetab.org/tutorial/gotz-etl/introduction/ class="toc-page text-wrap text-muted">Introduction</a></div><div><a href=https://www.codetab.org/tutorial/gotz-etl/bean-locator/ class="toc-page text-wrap text-muted">Bean and Locator</a></div><div><a href=https://www.codetab.org/tutorial/gotz-etl/datadef-axis-member/ class="toc-page text-wrap text-muted">DataDef, Axis and Member</a></div><div><a href=https://www.codetab.org/tutorial/gotz-etl/query-region-field/ class="toc-page text-wrap text-muted">Query, Region and Field</a></div><div><a href=https://www.codetab.org/tutorial/gotz-etl/members-dynamic-query/ class="toc-page text-wrap text-muted">Members and Dynamic Query</a></div><div><a href=https://www.codetab.org/tutorial/gotz-etl/indexrange-index/ class="toc-page text-wrap text-muted">IndexRange, Index and BreakAfter</a></div><div><a href=https://www.codetab.org/tutorial/gotz-etl/filters/ class="toc-page text-wrap text-muted">Filters</a></div><div><a href=https://www.codetab.org/tutorial/gotz-etl/namespace/ class="toc-page text-wrap text-muted">Namespace</a></div><div><a href=https://www.codetab.org/tutorial/gotz-etl/tasks-steps/ class="toc-page text-wrap text-muted">Tasks and Steps</a></div><div><a href=https://www.codetab.org/tutorial/gotz-etl/multiple-task-tasks/ class="toc-page text-wrap text-muted">Multiple Task and Tasks</a></div><div><a href=https://www.codetab.org/tutorial/gotz-etl/converters/ class="toc-page text-wrap text-muted">Converters</a></div><div><a href=https://www.codetab.org/tutorial/gotz-etl/persistence/ class="toc-page text-wrap text-danger">Persistence</a></div><div><a href=https://www.codetab.org/tutorial/gotz-etl/appenders-encoders/ class="toc-page text-wrap text-muted">Appenders and Encoders</a></div><div><a href=https://www.codetab.org/tutorial/gotz-etl/split-definitions/ class="toc-page text-wrap text-muted">Split Definitions</a></div></div></div></div></nav></nav></div></aside><div id=contentbar class=col-md-7><div id=share class="row justify-content-end"><div title=twitter><a href="https://twitter.com/intent/tweet?url=https://www.codetab.org/tutorial/gotz-etl/persistence/&text=Persistence%20-%20Gotz%20ETL%20-%20CodeTab" target=_blank rel=noopener><i class="icon-twitter-squared text-secondary"></i></a></div><div title=facebook><a href="https://www.facebook.com/sharer.php?u=https://www.codetab.org/tutorial/gotz-etl/persistence/&t=Persistence%20-%20Gotz%20ETL%20-%20CodeTab" target=_blank rel=noopener><i class="icon-facebook-squared text-secondary"></i></a></div><div title=linkedin><a href="https://www.linkedin.com/shareArticle?url=https://www.codetab.org/tutorial/gotz-etl/persistence/&title=Persistence%20-%20Gotz%20ETL%20-%20CodeTab" target=_blank rel=noopener><i class="icon-linkedin-squared text-secondary"></i></a></div><div title=email><a href="mailto:?subject=Persistence%20-%20Gotz%20ETL%20-%20CodeTab&body=https://www.codetab.org/tutorial/gotz-etl/persistence/" target=_blank rel=noopener><i class="icon-mail-squared text-secondary"></i></a></div><div title=whatsapp><a href="https://web.whatsapp.com/send?text=Persistence%20-%20Gotz%20ETL%20-%20CodeTab%20https://www.codetab.org/tutorial/gotz-etl/persistence/" target=_blank rel=noopener><i class="icon-whatsapp text-secondary"></i></a></div><div title=reddit><a href="https://reddit.com/submit?url=https://www.codetab.org/tutorial/gotz-etl/persistence/&title=Persistence%20-%20Gotz%20ETL%20-%20CodeTab" target=_blank rel=noopener><i class="icon-reddit-alien text-secondary"></i></a></div><i class="icon-blank ctab-transparent"></i></div><div class=row><main id=content class="col-md-11 post-basic"><p>With persistence, Gotz offers following benefits.</p><ul><li>reduce network usage as it can reuse the downloaded pages</li><li>recover from the aborted run without redoing the tasks already
completed</li><li>avoid expensive parse operation as it can reuse the persisted data</li><li>set expiry date for each page</li></ul><p>If you installed Gotz from GitHub, then to run examples with persistence
we need to setup database. We explain how to install and setup HSQLDB as
it is the easy one. But, in case you have installed Gotz from Docker
image then you can skip installing HSQLDB as image comes with MariaDB
instance preconfigured as explained in <a href=/gotz-etl/gotz-installation-quick-start>Install Gotz</a>. Otherwise, download <a href=https://sourceforge.net/projects/hsqldb/files/hsqldb/hsqldb_2_3 target=_blank>HSQLDB version 2.3</a> and extract it to some folder. To create database and start HSQLDB server, run</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-XML data-lang=XML><span class=line><span class=cl>cd hsqldb-2.3.0/hsqldb
</span></span><span class=line><span class=cl>java -cp lib/hsqldb.jar org.hsqldb.server.Server --database.0 file:data/gotz --dbname.0 gotz
</span></span></code></pre></div><p>This creates database named gotz and places database files in data
directory.</p><p>Use HSQLDB client to connect running database and to do that run
following from another console</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-XML data-lang=XML><span class=line><span class=cl>java -cp hsqldb.jar org.hsqldb.util.DatabaseManagerSwing
</span></span></code></pre></div><p>To connect to HSQLDB server, enter connection details as shown in the
figure and click OK.</p><figure class=text-center><img class="lazy img-fluid" data-src=/tutorial/gotz-etl/media/gotz-persistence-hsqldbclient.png alt="Gotz Persistence HSQLDB client"></figure><h2 id=enable-persistence-in-gotz>Enable Persistence in Gotz</h2><p>By default persistence is enabled in Gotz, but to run examples, we have
disabled it by setting <strong>gotz.useDatastore</strong> property as <strong>false</strong> in
<strong>conf/gotz.properties</strong> file. To enable persistence, either set this
property as <strong>true</strong> or remove the property by hashing it out.</p><p>Now run Example-10 and you should have locator, datadef, data and
document tables with data in gotz database.</p><div>&nbsp;</div><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-1281079745125126 data-ad-slot=6135368983></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><div>&nbsp;</div><h2 id=live>Live</h2><p>When we first run Example-10 with persistence enabled, document table
which contains compressed contents of the pages - acme-quote-links.html,
acme-bs.html and acme-pl.html will end up with three rows and table data
which holds the parsed data will have five rows - finLinks, price,
snapshot, bs and pl. If we run Gotz again and inspect the database
tables, the document table will have six rows and data table will end up
with 10 rows. For each run, Gotz fetches fresh pages and parse it to get
data even though persistence is enabled. This is because, by default,
<strong>live</strong> setting which controls the expiry of page is set to zero days
(P0D). So, in each run, Gotz sees page as expired and fetches new one.
We can use live with each tasks group to alter this behavior.</p><p>Suppose, we want to fetch new quote page every day but BS and PL pages
once in 3 months as they change less frequently. The
<strong>defs/examples/jsoup/ex-11/job.xml</strong> sets live element in for each
<strong>&lt;tasks></strong> as follows</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-XML data-lang=XML><span class=line><span class=cl><span class=nt>&lt;tasks</span> <span class=na>name=</span><span class=s>&#34;quote tasks&#34;</span> <span class=na>group=</span><span class=s>&#34;quote&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    ... task ...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;live&gt;</span>P1D<span class=nt>&lt;/live&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/tasks&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;tasks</span> <span class=na>name=</span><span class=s>&#34;bs tasks&#34;</span> <span class=na>group=</span><span class=s>&#34;bs&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    ... task ...
</span></span><span class=line><span class=cl>    <span class=nt>&lt;live&gt;</span>P3M<span class=nt>&lt;/live&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/tasks&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;tasks</span> <span class=na>name=</span><span class=s>&#34;pl tasks&#34;</span> <span class=na>group=</span><span class=s>&#34;pl&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    ... task ...
</span></span><span class=line><span class=cl>    <span class=nt>&lt;live&gt;</span>P3M<span class=nt>&lt;/live&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/tasks&gt;</span>
</span></span></code></pre></div><p>The P1D, P3M are <a href=https://en.wikipedia.org/wiki/ISO_8601#Durations target=_blank>ISO_8601</a> based representation of duration.</p><p>Now only for first run fresh pages are fetched and persisted and for
subsequent runs the persisted page and data are reused till pages are
expired. This speeds up the run many fold.</p><h2 id=persist-setting>Persist Setting</h2><p>We can further control how locator or data is persisted using persist
element in each task.</p><p>For example there is no need to store link data in database as they have
little relevance other than to create new locators. So to disable links
persistence, we add persist/data as false to fin links task.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-XML data-lang=XML><span class=line><span class=cl><span class=nt>&lt;tasks</span> <span class=na>name=</span><span class=s>&#34;quote tasks&#34;</span> <span class=na>group=</span><span class=s>&#34;quote&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;task</span> <span class=na>name=</span><span class=s>&#34;fin links&#34;</span> <span class=na>dataDef=</span><span class=s>&#34;finLinks&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;steps</span> <span class=na>ref=</span><span class=s>&#34;commonSteps&#34;</span> <span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>             ... local step ...
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/steps&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;persist&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;data&gt;</span>false<span class=nt>&lt;/data&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/persist&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/task&gt;</span>
</span></span></code></pre></div><p>Similarly we can set persist/locator for tasks element which disable
persistence of locators group and their pages. The persist/data is set
in task element where as persist/locator is set in tasks element.</p><div>&nbsp;</div><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-1281079745125126 data-ad-slot=6135368983></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><div>&nbsp;</div><h2 id=use-gotz-with-other-databases>Use Gotz with other Databases</h2><p>Gotz uses JDO and <a href=http://www.datanucleus.org/ target=_blank>DataNucleus
AccessPlatform</a> which works with variety of
databases. Gotz is tested with MySQL, MariaDB and MongoDB and
configuration for each of them is in <strong>conf/jdoconfig.properties</strong> file.</p><p>In the next chapter we look at appenders and persist output data to
database.</p></main></div></div><aside id=sidebar-right class=col-md-2><div class="row my-5 justify-content-center border"><div>&nbsp;</div><ins class=adsbygoogle style=display:inline-block;width:160px;height:600px data-ad-client=ca-pub-1281079745125126 data-ad-slot=8963022093></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><div>&nbsp;</div></div></aside></div></div><footer class="container-fluid mt-5"><div class=row><div class="col ml-auto"><div class="row mb-1 ml-2"><a class=text-muted href=/privacy-policy>Privacy</a></div><div class="row text-muted mb-2 ml-2"><span>&copy; 2019 &#183;Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span></div></div><div class="col mr-auto"><span class=float-right><a href=# id=back_to_top><i class="icon-up-open h1 text-secondary"></i></a></span></div></div></footer><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<script src=/js/vendor.min.6426da8436d34406d4c00f2275c86cf1747a900b1609a0b04e1b68d542f60f72.js></script></body></html>