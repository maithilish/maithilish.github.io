<!DOCTYPE html>
<html lang="en-us">

<head><meta charset="utf-8">
<meta name="description" content="GWT Tutorial uses App Engine Task Queue service, to organize the datastore inserts into tasks, and add them to task queue for later execution.">
<meta name="author" content="Maithilish">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">



<script async src="https://www.googletagmanager.com/gtag/js?id=UA-42139846-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-42139846-3');
</script>

<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://google.com/article"
        },
        "articleSection" : "tutorial",        
        "name" : "Task Queue - GWT Tutorial - CodeTab",
        "headline" : "Task Queue - GWT Tutorial - CodeTab",
        "url" : "https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-task-queue/",
        "description" : "GWT Tutorial uses App Engine Task Queue service, to organize the datastore inserts into tasks, and add them to task queue for later execution.",        
        "inLanguage" : "en",
        "image": "https://www.codetab.org/logo.jpg",
        "author" : "Maithilish",
        "creator" : "Maithilish",
        "publisher": {
            "@type": "Organization",
            "name": "Maithilish",
            "url": "https://www.codetab.org/",            
            "logo": {
               "@type": "ImageObject",
               "url": "https://www.codetab.org/logo.jpg",
               "width":"100",
               "height":"100"
            } 
        },
        "copyrightHolder" : "Maithilish",
        "copyrightYear" : "2019",
        "datePublished": "2019-01-10T19:33:00+0530",
        "dateModified" : "2019-01-10T19:33:00+0530",        
        "wordCount" : "1982",
        "keywords" : [ "app engine task queue","Blog" ]
    }
</script>
<link rel="icon" href="/favicon.ico">






<link rel="stylesheet" href="/css/vendor.min.5094155807f5e8e42efd4efe08a15d3c51025b1e28787bdea850902bf7650261.css" integrity="sha256-UJQVWAf16OQu/U7&#43;CKFdPFECWx4oeHveqFCQK/dlAmE=">

<title>Task Queue - GWT Tutorial - CodeTab</title></head>

<body id="top"><header><nav id="navbar-main" class="navbar fixed-top navbar-light navbar-expand-lg bg-white border-bottom shadow-sm">

    <div class="container-fluid">

        
        <a class="navbar-brand" href="/">Codetab</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbar">

            
            
            <ul class="navbar-nav ml-auto">
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#tutorials"  >
                        
                        <span>Home</span>
                        
                    </a>
                </li>

                
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#projects"  >
                        
                        <span>Projects</span>
                        
                    </a>
                </li>

                
                

                

                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/post"  >
                        
                        <span>Posts</span>
                        
                    </a>
                </li>

                
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#about"  >
                        
                        <span>About</span>
                        
                    </a>
                </li>

                
                

            </ul>

        </div>
    </div>
</nav></header>

<div class="container-fluid">
  <div class="row">&nbsp;</div>

  <div class="row">
    
    <aside id="sidebar" class="col-md-3">
      <div class="row"><nav id="navbar-side" class="bg-light text-secondary">

    
    

    

    
    

    

    <h4 class="text-muted bg-white pl-2">GWT Tutorial</h4>

    <nav class="navbar navbar-light bg-white navbar-expand-md">

        <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#bookmenu"
            aria-controls="bookmenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bookmenu">
            <div>
                
                









<div id="GWT Tutorial - Complete Project - CodeTab">
    
    <div>
        <a href="https://www.codetab.org/tutorial/gwt/introduction/"
            class="toc-page text-wrap text-muted ">
            Introduction
        </a>
    </div>
    
    <div>
        <a href="https://www.codetab.org/tutorial/gwt/install/"
            class="toc-page text-wrap text-muted ">
            Install GWT in Eclipse
        </a>
    </div>
    
    <div>
        <a href="https://www.codetab.org/tutorial/gwt/create-project/"
            class="toc-page text-wrap text-muted ">
            Project Setup
        </a>
    </div>
    
    <div>
        <a href="https://www.codetab.org/tutorial/gwt/gwt-project-code/"
            class="toc-page text-wrap text-muted ">
            GWT Project Code
        </a>
    </div>
    
    <div>
        <a href="https://www.codetab.org/tutorial/gwt/gwt-demo/"
            class="toc-page text-wrap text-muted ">
            GWT Tutorial Demo
        </a>
    </div>
    
</div>







<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-gwt-shell" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Shell
    </a>
    
    <div id="tutorial-gwt-shell" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/gwt/shell/finsshell/"
            class="toc-page dropdown-item text-wrap text-muted">
            UIBinder and Custom Widget
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/shell/contentpanel/"
            class="toc-page dropdown-item text-wrap text-muted">
            TabLayoutPanel
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/shell/gwt-logging/"
            class="toc-page dropdown-item text-wrap text-muted">
            Logging
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-gwt-menu" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Menu
    </a>
    
    <div id="tutorial-gwt-menu" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/gwt/menu/menu/"
            class="toc-page dropdown-item text-wrap text-muted">
            ClientBundle
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/menu/menu-parts/"
            class="toc-page dropdown-item text-wrap text-muted">
            Anchor 
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/menu/gwt-eventbus-events/"
            class="toc-page dropdown-item text-wrap text-muted">
            EventBus
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/menu/gwt-eventbus-example/"
            class="toc-page dropdown-item text-wrap text-muted">
            EventBus Example
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-gwt-model" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Modle
    </a>
    
    <div id="tutorial-gwt-model" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/gwt/model/model/"
            class="toc-page dropdown-item text-wrap text-muted">
            Model
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-gwt-content" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Content
    </a>
    
    <div id="tutorial-gwt-content" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/gwt/content/content/"
            class="toc-page dropdown-item text-wrap text-muted">
            GWT Tutorial - Content
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/content/gwt-celltable/"
            class="toc-page dropdown-item text-wrap text-muted">
            CellTable
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/content/gwt-autosuggest/"
            class="toc-page dropdown-item text-wrap text-muted">
            SuggestBox
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/content/titlepanel/"
            class="toc-page dropdown-item text-wrap text-muted">
            TitlePanel
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/content/gwt-uifactory/"
            class="toc-page dropdown-item text-wrap text-muted">
            UiFactory
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/content/factpanel/"
            class="toc-page dropdown-item text-wrap text-muted">
            FactPanel
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/content/gwt-disclosepanel/"
            class="toc-page dropdown-item text-wrap text-muted">
            DisclosurePanel
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/content/toolbar/"
            class="toc-page dropdown-item text-wrap text-muted">
            Toolbar
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/content/gwt-datagrid/"
            class="toc-page dropdown-item text-wrap text-muted">
            DataGrid
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/content/gwt-chart/"
            class="toc-page dropdown-item text-wrap text-muted">
            Google Chart
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/content/gwt-close-tabs/"
            class="toc-page dropdown-item text-wrap text-muted">
            Close Tabs
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-gwt-rpc" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        RPC
    </a>
    
    <div id="tutorial-gwt-rpc" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/gwt/rpc/gwt-remote-procedure-calls/"
            class="toc-page dropdown-item text-wrap text-muted">
            RPC
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/rpc/rest-of-rpc/"
            class="toc-page dropdown-item text-wrap text-muted">
            Rest of RPC
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-gwt-database" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Database
    </a>
    
    <div id="tutorial-gwt-database" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/gwt/database/setup-database/"
            class="toc-page dropdown-item text-wrap text-muted">
            Database Setup
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/database/persist/"
            class="toc-page dropdown-item text-wrap text-muted">
            JDO Persistence 
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/database/retrieve/"
            class="toc-page dropdown-item text-wrap text-muted">
            JDO and Hibernate
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/database/gwt-dao/"
            class="toc-page dropdown-item text-wrap text-muted">
            DAO
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-gwt-google-app-engine" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Goolge App Engine
    </a>
    
    <div id="tutorial-gwt-google-app-engine" class="">
        
        
        <a href="https://www.codetab.org/tutorial/gwt/google-app-engine/google-app-engine/"
            class="toc-page dropdown-item text-wrap text-muted">
            Google App Engine
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-deploy/"
            class="toc-page dropdown-item text-wrap text-muted">
            App Engine Deploy
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-manage-data/"
            class="toc-page dropdown-item text-wrap text-muted">
            GAE Data Upload
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-cache/"
            class="toc-page dropdown-item text-wrap text-muted">
            App Engine Cache
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-task-queue/"
            class="toc-page dropdown-item text-wrap text-danger">
            App Engine Task Queue
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-backends/"
            class="toc-page dropdown-item text-wrap text-muted">
            GAE Backends
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-gwt-openshift" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        OpenShift
    </a>
    
    <div id="tutorial-gwt-openshift" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/gwt/openshift/openshift/"
            class="toc-page dropdown-item text-wrap text-muted">
            OpenShift Setup
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/openshift/prepare-openshift-project/"
            class="toc-page dropdown-item text-wrap text-muted">
            Prepare Project
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/openshift/openshift-configure/"
            class="toc-page dropdown-item text-wrap text-muted">
            Configure
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/openshift/openshift-build-deploy/"
            class="toc-page dropdown-item text-wrap text-muted">
            Build and Deploy
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/openshift/openshift-development/"
            class="toc-page dropdown-item text-wrap text-muted">
            Development
        </a>
        
        
        <a href="https://www.codetab.org/tutorial/gwt/openshift/openshift-online-v3-deployment/"
            class="toc-page dropdown-item text-wrap text-muted">
            OpenShift Online V3 Deployment
        </a>
        
        
        
        
    </div>
</div>




<div class="dropdown show mt-2">
    <a class="no-collapse-on-click card-link toc-section text-dark" href="#tutorial-gwt-build" id="dropdownheader"
        data-toggle="collapse" aria-haspopup="true" aria-expanded="false">
        Apache Ivy
    </a>
    
    <div id="tutorial-gwt-build" class="collapse">
        
        
        <a href="https://www.codetab.org/tutorial/gwt/build/apache-ivy/"
            class="toc-page dropdown-item text-wrap text-muted">
            Apache Ivy
        </a>
        
        
        
        
    </div>
</div>



                
            </div>
        </div>
    </nav>

</nav>

</div>
    </aside>

    <div id="contentbar" class="col-md-7">
        <div id="share" class="row justify-content-end">





<div title=twitter>
    <a href="https://twitter.com/intent/tweet?url=https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-task-queue/&amp;text=Task%20Queue%20-%20GWT%20Tutorial%20-%20CodeTab" target="_blank" rel="noopener">
        <i class="icon-twitter-squared text-secondary"></i>
    </a>
</div>




<div title=facebook>
    <a href="https://www.facebook.com/sharer.php?u=https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-task-queue/&amp;t=Task%20Queue%20-%20GWT%20Tutorial%20-%20CodeTab" target="_blank" rel="noopener">
        <i class="icon-facebook-squared text-secondary"></i>
    </a>
</div>




<div title=linkedin>
    <a href="https://www.linkedin.com/shareArticle?url=https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-task-queue/&amp;title=Task%20Queue%20-%20GWT%20Tutorial%20-%20CodeTab" target="_blank" rel="noopener">
        <i class="icon-linkedin-squared text-secondary"></i>
    </a>
</div>




<div title=email>
    <a href="mailto:?subject=Task%20Queue%20-%20GWT%20Tutorial%20-%20CodeTab&amp;body=https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-task-queue/" target="_blank" rel="noopener">
        <i class="icon-mail-squared text-secondary"></i>
    </a>
</div>




<div title=whatsapp>
    <a href="https://web.whatsapp.com/send?text=Task%20Queue%20-%20GWT%20Tutorial%20-%20CodeTab%20https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-task-queue/" target="_blank" rel="noopener">
        <i class="icon-whatsapp text-secondary"></i>
    </a>
</div>




<div title=reddit>
    <a href="https://reddit.com/submit?url=https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-task-queue/&amp;title=Task%20Queue%20-%20GWT%20Tutorial%20-%20CodeTab" target="_blank" rel="noopener">
        <i class="icon-reddit-alien text-secondary"></i>
    </a>
</div>




<div title=weibo>
    <a href="https://service.weibo.com/share/share.php?url=https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-task-queue/&amp;title=Task%20Queue%20-%20GWT%20Tutorial%20-%20CodeTab" target="_blank" rel="noopener">
        <i class="icon-weibo text-secondary"></i>
    </a>
</div>




<i class="icon-blank ctab-transparent"></i></div>
        <div class="row">
          <main id="content" class="col-md-11 post-basic">
            

<h2 id="11-3-task-queue">11.3. Task Queue</h2>

<p>Once we have Symbols in the cache, all that it takes to persist is to
retrieve them, one by one, from the cache and persist with a call to
JDO. This simple task seems to be achievable through RPC, but it will
not work as intended on App Engine. Let&rsquo;s understand the limitations
imposed by the App Engine.</p>

<p>RPC has to be completed within 60 seconds, and when there are few
symbols, call may finish within the deadline. But as their number
increases, persistence being a resource hungry operation, App Engine
begins to throw <code>DeadlineExceededException</code>. Next, we try to overcome
this issue by invoking separate RPC for each Symbol. While this
overcomes the deadline issue, it flogs the App Engine with multiple
simultaneous RPC, which occasionally results in persistence error.</p>

<p>For long running or resource hungry process, App Engine provides Task
Queue service, which allows us to organize the work into small, discrete
units called tasks, and add them to task queue for later execution.
These tasks are initiated by the user request, but they run outside that
request and not bound by the usual request deadline.</p>

<p>Before we get into task queues, we have to make some preparations to
access the App Engine datastore.</p>

<h5 id="jdo-config">Jdo Config</h5>

<p>In a earlier chapter, we used <code>jdoconfig.xml</code> to configure a database
connection to HSQLDB, and we need to modify the configuration to access
App Engine datastore as follows:</p>

<p><code>META-INF/jdoconfig.xml</code></p>
<div class="highlight"><pre class="chroma"><code class="language-XML" data-lang="XML">        <span class="c">&lt;!-- GAE Datastore --&gt;</span>

        <span class="nt">&lt;persistence-manager-factory</span> <span class="na">name=</span><span class="s">&#34;datastore&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;javax.jdo.PersistenceManagerFactoryClass&#34;</span>
                        <span class="na">value=</span><span class="s">&#34;org.datanucleus.api.jdo.JDOPersistenceManagerFactory&#34;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;javax.jdo.option.ConnectionURL&#34;</span> <span class="na">value=</span><span class="s">&#34;appengine&#34;</span> <span class="nt">/&gt;</span>

                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;javax.jdo.option.NontransactionalRead&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;javax.jdo.option.NontransactionalWrite&#34;</span>
                        <span class="na">value=</span><span class="s">&#34;true&#34;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;javax.jdo.option.RetainValues&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;datanucleus.appengine.autoCreateDatastoreTxns&#34;</span>
                        <span class="na">value=</span><span class="s">&#34;true&#34;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;datanucleus.cache.level2.type&#34;</span> <span class="na">value=</span><span class="s">&#34;soft&#34;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;datanucleus.metadata.validate&#34;</span> <span class="na">value=</span><span class="s">&#34;false&#34;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/persistence-manager-factory&gt;</span></code></pre></div>
<p>In case, this configuration is not available in <code>jdoconfig.xml</code>, then
App Engine throws, a rather confusing, error - <code>NoClassDefFoundError</code>.
Same error also props up when JDO version is not set to <strong>v2</strong> in App
Engine Settings window. So, you know what to look for when you encounter
this exception.</p>
<div class="highlight"><pre class="chroma"><code class="language-screen" data-lang="screen">com.google.apphosting.utils.jetty.JettyLogger warn
WARNING: Error for /fins/gaeInsertTask
java.lang.NoClassDefFoundError: Could not initialize class in.fins.server.dao.jdo.PMF
        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Class.java:186)
        ....</code></pre></div>
<h5 id="identity">Identity</h5>

<p>Earlier in domain classes, <code>DataGroup</code> and <code>Data</code>, we used long type for
Id, which is also the primary key. These classes are also child objects
of others because of one-to-many relationship, and in such cases when
primary key is of type long, App Engine JDO throws
<code>JDOFatalUserException</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-screen" data-lang="screen">javax.jdo.JDOFatalUserException: Error in meta-data for field 
  in.fins.shared.DataGroup.id : Cannot have a primary key of type long and 
  be a child object (owning field is in.fins.shared.Symbol.dataGroups&#34;).</code></pre></div>
<p>To overcome this error, we have to use type String for primary key id in
<code>in.fins.shared.DataGroup</code> and <code>in.fins.shared.Data</code> classes. Then, in
mapping file <code>package.jdo</code>, we have to map the field into App Engine
specific type <strong>gae.encoded-pk</strong> using extension feature of JDO.</p>

<p><code>in.fins.shared/package.jdo</code></p>
<div class="highlight"><pre class="chroma"><code class="language-XML" data-lang="XML">    <span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&#34;DataGroup&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&#34;id&#34;</span> <span class="na">primary-key=</span><span class="s">&#34;true&#34;</span> <span class="na">value-strategy=</span><span class="s">&#34;identity&#34;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;extension</span> <span class="na">vendor-name=</span><span class="s">&#34;datanucleus&#34;</span> <span class="na">key=</span><span class="s">&#34;gae.encoded-pk&#34;</span>
                            <span class="na">value=</span><span class="s">&#34;true&#34;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/field&gt;</span>                    
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&#34;category&#34;</span> <span class="nt">/&gt;</span>
    ....
                        
    <span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&#34;Data&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&#34;id&#34;</span> <span class="na">primary-key=</span><span class="s">&#34;true&#34;</span> <span class="na">value-strategy=</span><span class="s">&#34;identity&#34;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;extension</span> <span class="na">vendor-name=</span><span class="s">&#34;datanucleus&#34;</span> <span class="na">key=</span><span class="s">&#34;gae.encoded-pk&#34;</span>
                            <span class="na">value=</span><span class="s">&#34;true&#34;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&#34;date&#34;</span> <span class="err">/</span>        
    <span class="err">....</span></code></pre></div>
<p>This solves the App Engine specific error, but in case you rollback to
regular app server, then it complains that type String is not allowed
for primary key when <strong>value-strategy</strong> is identity. So, when you want
to move the app to regular app server, change the value-strategy
attribute from <strong>identity</strong> to <strong>uuid-string</strong> (for HSQLDB) or <strong>auid</strong>
(for MySQL), which should resolve the issue.</p>

<h2 id="id-as-string">ID as String</h2>

<p>It is a good practice to use id field of long type in domain classes and
use strategies like Join Table to overcome App Engine related issues.
But, we intentionally stick with the present domain model to highlight
the issues with id of String type.</p>

<p>With these preparations, we are ready to use App Engine&rsquo;s datastore to
persist our domain classes.</p>

<h5 id="datastorepanel">DataStorePanel</h5>

<p><code>DataStorePanel</code> is a custom widget with just one button - Persist
Symbols.</p>

<figure class="text-center" >
  <img class="lazy img-fluid" data-src="/tutorial/gwt/media/datastorepanel.png" alt="DataStorePanel" />
</figure>


<h6 id="figure-11-5-datastorepanel">Figure 11.5. DataStorePanel</h6>

<p>Unlike UploadPanel and CachePanel, DataStorePanel uses GWT RPC instead
of FormPanel and form submission.</p>

<p>Only interesting thing in this widget is Click handler, which makes RPC
call to <code>persistSymbols()</code> method of SymbolService.</p>

<p><code>in.fins.client.widget/DataStorePanel.java</code></p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java"><span class="p">....</span>
    <span class="n">Handler</span><span class="p">(</span><span class="s">&#34;persistButton&#34;</span><span class="p">)</span>
    <span class="kt">void</span> <span class="nf">onInsertButtonClick</span><span class="p">(</span><span class="n">ClickEvent</span> <span class="nf">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ISymbolServiceAsync</span> <span class="nf">dataStoreService</span> <span class="o">=</span> <span class="n">GWT</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">ISymbolService</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
            <span class="n">dataStoreService</span><span class="p">.</span><span class="na">persistSymbols</span><span class="p">(</span><span class="s">&#34;insert-queue&#34;</span><span class="p">,</span>
                <span class="k">new</span> <span class="n">AsyncCallback</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>

                 <span class="nd">@Override</span>
                 <span class="kd">public</span> <span class="nf">void</span> <span class="n">onSuccess</span><span class="p">(</span><span class="n">String</span> <span class="nf">result</span><span class="p">)</span> <span class="p">{</span>
                      <span class="n">StatusEvent</span> <span class="nf">se</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
                      <span class="n">EventBus</span><span class="p">.</span><span class="na">get</span><span class="p">().</span><span class="na">fireEvent</span><span class="p">(</span><span class="n">se</span><span class="p">);</span>
                 <span class="p">}</span>   

                 <span class="nd">@Override</span>
                 <span class="kd">public</span> <span class="nf">void</span> <span class="n">onFailure</span><span class="p">(</span><span class="n">Throwable</span> <span class="nf">caught</span><span class="p">)</span> <span class="p">{</span>
                      <span class="n">StatusEvent</span> <span class="nf">se</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">caught</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
                      <span class="n">EventBus</span><span class="p">.</span><span class="na">get</span><span class="p">().</span><span class="na">fireEvent</span><span class="p">(</span><span class="n">se</span><span class="p">);</span>
                 <span class="p">}</span>   
          <span class="p">});</span> 
   <span class="p">}</span></code></pre></div>
<p>String insert-queue argument to method <code>persistSymbols()</code>, tells server
to use that queue to persist the symbols.</p>

<h5 id="symbolservice-rpc">SymbolService RPC</h5>

<p>Service method, <code>persistSymbols()</code> is a new method in existing
<code>SymbolService</code>. Its definition is added to <code>ISymbolService</code> and
<code>ISymbolServiceAsync</code> interfaces in the client and its implementation to
SymbolService in the server.</p>

<p><code>in.fins.client.rpc/ISymbolService.java</code></p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java"><span class="nd">@RemoteServiceRelativePath</span><span class="p">(</span><span class="s">&#34;symbolService&#34;</span><span class="p">)</span>
<span class="kd">public</span> <span class="nf">interface</span> <span class="n">ISymbolService</span> <span class="nf">extends</span> <span class="n">RemoteService</span> <span class="p">{</span>

        <span class="p">....</span>

        <span class="kd">public</span> <span class="nf">String</span> <span class="n">persistSymbols</span><span class="p">(</span><span class="n">String</span> <span class="nf">qName</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>
<p><code>in.fins.client.rpc/ISymbolServiceAsync.java</code></p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java"><span class="kd">public</span> <span class="nf">interface</span> <span class="n">ISymbolServiceAsync</span> <span class="p">{</span>

        <span class="p">....</span>                     

        <span class="kt">void</span> <span class="nf">persistSymbols</span><span class="p">(</span><span class="n">String</span> <span class="nf">qName</span><span class="p">,</span> <span class="n">AsyncCallback</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">callback</span><span class="p">);</span>        
<span class="p">}</span></code></pre></div>
<p><code>in.fins.server.service/SymbolService.java</code></p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java">     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="nf">String</span> <span class="n">persistSymbols</span><span class="p">(</span><span class="n">String</span> <span class="nf">qName</span><span class="p">)</span> <span class="p">{</span>

          <span class="c1">// persist symbols through ITask interface
</span><span class="c1"></span>     <span class="p">}</span></code></pre></div>
<h5 id="task-interface">Task Interface</h5>

<p>In app <code>servers, persistSymbols()</code> method can retrieve Symbols from
cache one by one and then using DAO, persist them to datastore. But, in
App Engine, same doesn&rsquo;t work properly. To handle these differences,
interaction between <code>SymbolService.persistSymbols()</code> method and
underlying datastore is done through an Interface, <code>ITask</code> as show in
the next figure.</p>

<figure class="text-center" >
  <img class="lazy img-fluid" data-src="/tutorial/gwt/media/itask.png" alt="Task interface" />
</figure>


<h6 id="figure-11-6-task-interface">Figure 11.6. Task interface</h6>

<p>ITask interface contains a single method execute(), which is implemented
by <code>GaePersistTask</code> and <code>PersistTask</code> classes.
<code>SymbolService.persistSymbols()</code> method, based on the server type,
instantiates either of these two classes and assigns it to ITask field.
Then, it retrieves the list of symbol names from the cache and calls
<code>ITask.execute()</code> method for each symbol name.</p>

<p>Let&rsquo;s have a look at PersistTask, which is used by regular app servers.</p>

<p><code>in.fins.server.task/PersistTask.java</code></p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java"><span class="kd">public</span> <span class="nf">class</span> <span class="n">PersistTask</span> <span class="nf">implements</span> <span class="n">ITask</span> <span class="p">{</span>

        <span class="kd">private</span> <span class="nf">DaoFactory</span> <span class="n">daoFactory</span><span class="p">;</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="nf">void</span> <span class="n">execute</span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">parameters</span><span class="p">)</span> <span class="kd">throws</span> <span class="nf">Exception</span> <span class="p">{</span>
                <span class="n">String</span> <span class="nf">ormName</span> <span class="o">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">parameters</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&#34;ormName&#34;</span><span class="p">);</span>
                <span class="n">ORM</span> <span class="nf">orm</span> <span class="o">=</span> <span class="n">DaoFactory</span><span class="p">.</span><span class="na">getOrmType</span><span class="p">(</span><span class="n">ormName</span><span class="p">);</span>
                <span class="n">daoFactory</span> <span class="o">=</span> <span class="n">DaoFactory</span><span class="p">.</span><span class="na">getDaoFactory</span><span class="p">(</span><span class="n">orm</span><span class="p">);</span>
                <span class="n">String</span> <span class="nf">symbolName</span> <span class="o">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">parameters</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&#34;symbolName&#34;</span><span class="p">);</span>
                <span class="n">ICache</span> <span class="nf">cache</span> <span class="o">=</span> <span class="n">Utils</span><span class="p">.</span><span class="na">createInstance</span><span class="p">(</span><span class="n">ICache</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                                <span class="s">&#34;in.fins.server.cache.SimpleCache&#34;</span><span class="p">);</span>
                <span class="n">cache</span><span class="p">.</span><span class="na">createCache</span><span class="p">();</span>
                <span class="n">Symbol</span> <span class="nf">symbol</span> <span class="o">=</span> <span class="p">(</span><span class="n">Symbol</span><span class="p">)</span> <span class="n">cache</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">symbolName</span><span class="p">);</span>
                <span class="n">persistSymbol</span><span class="p">(</span><span class="n">symbol</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kd">public</span> <span class="nf">void</span> <span class="n">persistSymbol</span><span class="p">(</span><span class="n">Symbol</span> <span class="nf">symbol</span><span class="p">)</span> <span class="kd">throws</span> <span class="nf">Exception</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                        <span class="n">IDao</span><span class="o">&lt;</span><span class="n">Symbol</span><span class="o">&gt;</span> <span class="nf">symbolDao</span> <span class="o">=</span> <span class="n">daoFactory</span><span class="p">.</span><span class="na">getDao</span><span class="p">(</span><span class="n">Symbol</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
                        <span class="n">symbolDao</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">symbol</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="nf">e</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">log</span><span class="p">.</span><span class="na">warning</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
                        <span class="k">throw</span> <span class="n">e</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p><code>SymbolService.persistSymbol()</code> calls <code>execute()</code> method passing symbol
name and Orm type through parameters and <code>execute()</code> method, using these
parameters, obtains symbol from the cache and also appropriate
<code>DaoFactory</code>. From DaoFactory, it gets SymbolDao and calls insert method
to persist the symbol.</p>

<p>But things get slightly complicated when Fins run on App Engine, which
uses <code>GaePersistTask</code>.</p>

<p><code>in.fins.server.task/PersistTask.java</code></p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java"><span class="kd">public</span> <span class="nf">class</span> <span class="n">GaePersistTask</span> <span class="nf">extends</span> <span class="n">HttpServlet</span> <span class="nf">implements</span> <span class="n">ITask</span> <span class="p">{</span>

        <span class="kd">private</span> <span class="nf">DaoFactory</span> <span class="n">daoFactory</span><span class="p">;</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="nf">void</span> <span class="n">execute</span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">parameters</span><span class="p">)</span> <span class="kd">throws</span> <span class="nf">Exception</span> <span class="p">{</span>
                <span class="n">String</span> <span class="nf">qName</span> <span class="o">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">parameters</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&#34;queueName&#34;</span><span class="p">);</span>
                <span class="n">String</span> <span class="nf">symbolName</span> <span class="o">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">parameters</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&#34;symbolName&#34;</span><span class="p">);</span>

              <span class="c1">// add a task to Task Queue to 
</span><span class="c1"></span>              <span class="c1">// persist a Symbol
</span><span class="c1"></span>
        <span class="p">}</span></code></pre></div>
<p>Here execute() method obtains symbol name and queue name from parameters
and then adds a task to App Engine task queue. Later, App Engine
dequeues the tasks one by one, which persist the symbol.</p>

<p>It is a two step process, first we have to define a Task and then, add
them to Queue. Let&rsquo;s see how it is done in detail.</p>



<div>&nbsp;</div>

<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-1281079745125126"
     data-ad-slot="6135368983"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<div>&nbsp;</div>



<h5 id="app-engine-tasks">App Engine Tasks</h5>

<p>App Engine Task is simply a regular servlet, and <code>GaePersistTask</code>
extends <code>HttpServlet</code> so that it acts as a App Engine Task. Please note
that we combined <code>ITask</code> and <code>HttpServlet</code> into a single class,
<code>GaePersistTask</code>, just reduce a file, but it may be split into separate
classes one that implements ITask and another one to act task servlet.</p>

<p>When App Engine dequeues the task, it invokes the servlet and calls
either <code>HttpServlet.doPost()</code> or <code>HttpServlet.doGet()</code> method of the
task. Place persistence code in <code>doPost()</code> method as shown below.</p>

<p><code>in.fins.server.task/GaePersistTask.java</code></p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java">        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="nf">void</span> <span class="n">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span> <span class="nf">req</span><span class="p">,</span> <span class="n">HttpServletResponse</span> <span class="nf">resp</span><span class="p">)</span>
                        <span class="kd">throws</span> <span class="nf">ServletException</span><span class="p">,</span> <span class="n">IOException</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                        <span class="n">ICache</span> <span class="nf">cache</span> <span class="o">=</span> <span class="n">Utils</span><span class="p">.</span><span class="na">createInstance</span><span class="p">(</span><span class="n">ICache</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                                        <span class="s">&#34;in.fins.server.cache.GaeCache&#34;</span><span class="p">);</span>
                        <span class="n">String</span> <span class="nf">symbolName</span> <span class="o">=</span> <span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&#34;symbolName&#34;</span><span class="p">);</span>
                        <span class="n">cache</span><span class="p">.</span><span class="na">createCache</span><span class="p">();</span>
                        <span class="n">Symbol</span> <span class="nf">symbol</span> <span class="o">=</span> <span class="p">(</span><span class="n">Symbol</span><span class="p">)</span> <span class="n">cache</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">symbolName</span><span class="p">);</span>
                        <span class="n">persistSymbol</span><span class="p">(</span><span class="n">symbol</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="nf">e</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">log</span><span class="p">.</span><span class="na">warning</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
                <span class="p">}</span>
        <span class="p">}</span></code></pre></div>
<p>From <code>HttpServletRequest</code>, it obtains symbol name and retrieves the
corresponding Symbol from the cache and then, it persists the Symbol
using DaoFactory and SymbolDao as explained earlier in case of
PersistTask.</p>

<p>Next, we have to map the task servlet to an URL, like we do in case of
any other regular servlet, adding a servlet mapping to the descriptor
file web.xml.</p>

<p><code>war/WEB-INF/web.xml</code></p>
<div class="highlight"><pre class="chroma"><code class="language-XML" data-lang="XML"> <span class="nt">&lt;servlet&gt;</span>
         <span class="nt">&lt;servlet-name&gt;</span>gaePersistTask<span class="nt">&lt;/servlet-name&gt;</span>
         <span class="nt">&lt;servlet-class&gt;</span>in.fins.server.task.GaePersistTask<span class="nt">&lt;/servlet-class&gt;</span>
 <span class="nt">&lt;/servlet&gt;</span>
 <span class="nt">&lt;servlet-mapping&gt;</span>
         <span class="nt">&lt;servlet-name&gt;</span>gaePersistTask<span class="nt">&lt;/servlet-name&gt;</span>
         <span class="nt">&lt;url-pattern&gt;</span>/fins/gaePersistTask<span class="nt">&lt;/url-pattern&gt;</span>
 <span class="nt">&lt;/servlet-mapping&gt;</span></code></pre></div>
<h5 id="app-engine-queue">App Engine Queue</h5>

<p>Task Queue API supports Push queues and Pull queues. Push queues process
tasks, based on the processing rate configured in the queue definition,
while Pull queues provides greater control over the task processing and
also allows tasks to be consumed by code external to the application. In
Fins, we use push queues as they are simple to use.</p>

<p>Queue definition file, <code>queue.xml</code>, defines queues. For convenience, App
Engine provides a default push queue and inserts tasks, which are
without a queue name, into the default queue. In addition to default
queue, we may configure additional named queues through queue definition
file queue.xml.</p>

<p><code>war/WEB-INF/queue.xml</code></p>
<div class="highlight"><pre class="chroma"><code class="language-XML" data-lang="XML"><span class="nt">&lt;queue-entries&gt;</span>
  <span class="nt">&lt;queue&gt;</span>
    <span class="nt">&lt;name&gt;</span>insert-queue<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;rate&gt;</span>1/s<span class="nt">&lt;/rate&gt;</span>
    <span class="nt">&lt;bucket-size&gt;</span>10<span class="nt">&lt;/bucket-size&gt;</span>
  <span class="nt">&lt;/queue&gt;</span>
<span class="nt">&lt;/queue-entries&gt;</span></code></pre></div>
<p>The above definition, configures push queue named insert-queue with
bucket-size of 10 and rate of 1 task per second. Task queue uses Token
bucket algorithm to control the rate of task execution. Rate directive
tells that App Engine should refill the bucket with one token per second
and bucket can hold a max 10 tokens.</p>

<p>App Engine executes push tasks by calling application-specific URL,
which means we have to provide the URL of task when we add them to task
queue. Following code adds GaePersistTask to insert-queue.</p>

<p><code>in.fins.server.task/PersistTask.java</code></p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java">    
    <span class="n">TaskOptions</span> <span class="nf">task</span> <span class="o">=</span> <span class="n">withUrl</span><span class="p">(</span><span class="s">&#34;/fins/gaePersistTask&#34;</span><span class="p">).</span><span class="na">param</span><span class="p">(</span><span class="s">&#34;symbolName&#34;</span><span class="p">,</span>
<span class="n">symbolName</span><span class="p">).</span><span class="na">method</span><span class="p">(</span><span class="n">Method</span><span class="p">.</span><span class="na">POST</span><span class="p">);</span>
    <span class="n">Queue</span> <span class="nf">queue</span> <span class="o">=</span> <span class="n">QueueFactory</span><span class="p">.</span><span class="na">getQueue</span><span class="p">(</span><span class="n">qName</span><span class="p">);</span>
    <span class="n">queue</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">task</span><span class="p">);</span></code></pre></div>
<p><code>TaskOptions.Builder.withUrl()</code> method is used to create a task and set
various options. Arguments to this builder method indicate that, URL of
the task is <strong>/fins/gaePersistTask</strong> and symbol name is a request
parameter and method is POST. Then, task is added to queue. App Engine
dequeues the tasks one by one by calling the URL
<strong>/fins/gaePersistTask</strong> which invokes the GaePersistTask and calls it
doPost() method with symbol name as the request parameter.</p>



<div>&nbsp;</div>

<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-1281079745125126"
     data-ad-slot="6135368983"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<div>&nbsp;</div>




<h5 id="task-instances">Task instances</h5>

<p>Now, question is how many instances of GaePersistTask gets created when
we persist say, three symbols and the answer is four instances. First,
we create an instance of GaePersist task in
<code>SymbolService.persistSymbols()</code> method and call its execute method
which adds three tasks to task queue. For each task, App engine invokes
its URL, which creates an GaePersistTask servlet. In normal app server,
only one instance of servlet gets created, but it is important to note
that here tasks are executed on a cloud platform where each request may
get executed on some instance of app engine, on some server, in some
data center and somewhere in the world. App Engine instance in Data
Center X creates a GaePersistTask servlet to execute the first task and
another servlet instance in Data Center Y may handle the second task and
so on.</p>

<p>Following figure helps to clarify what plays out in the cloud, when we
persist three Symbols.</p>

<figure class="text-center" >
  <img class="lazy img-fluid" data-src="/tutorial/gwt/media/taskqueue.png" alt="Task Queue" />
</figure>


<h6 id="figure-11-7-task-queue">Figure 11.7. Task Queue</h6>

<h5 id="datastore-insert">DataStore Insert</h5>

<p>To persist symbols, <code>IDao</code> defines a new method <code>insert()</code> which is
implemented by <code>in.fins.server.dao.jdo.SymbolDao</code> and
<code>in.fins.server.dao.hibernate.SymbolDao</code>. We have not taken efforts to
implement it for MyBatis, which is slightly complicated as compared to
the other two.</p>

<p>While persisting the symbol, <code>insert()</code> method first checks whether a
symbol with the same name already existing in datastore and if so, it
updates the existing symbol else it insert the symbol.</p>

<h2 id="manage-taskqueue-and-datastore">Manage TaskQueue and DataStore</h2>

<p>In Development Mode, App Engine provides Development Console -
<code>http://localhost:8888/\_ah/admin</code> which is useful to manage DataStore and
Queue. Development console has options to view or delete datastore
entities. It also provides stats about the default and named task queues
and an option to purge pending tasks.</p>

<p>App Engine, in development mode, uses a binary file
<code>war/WEB-INF/appengine-generated/local_db.bin</code> as its local datastore.
In case you want to zap the entire datastore, then hack is to delete
this file and restart the App Engine.</p>

<p>Next section explains the use of App Engine Backends to free the
frontend exclusively for user requests.</p>

          </main>
        </div>
      </div>
  
    <aside id="sidebar-right" class="col-md-2">
      <div class="row my-5 justify-content-center border">
<div>&nbsp;</div>


<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-1281079745125126"
     data-ad-slot="8963022093"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<div>&nbsp;</div>
</div>
    </aside>

  </div>

</div>

<footer class="container-fluid mt-5">

    <div class="row">
        <div class="col ml-auto">
            <div class="row mb-1 ml-2">
                <a class="text-muted" href="/privacy-policy">Privacy</a>
            </div>
            <div class="row text-muted mb-2 ml-2">
                <span>&copy; 2019 &middot;Powered by <a href="https://gohugo.io" target="_blank"
                        rel="noopener">Hugo</a></span>
            </div>
        </div>
        <div class="col mr-auto">
            <span class="float-right">
                <a href="#" id="back_to_top">
                    <i class="icon-up-open h1 text-secondary"></i>
                </a>
            </span>
        </div>
    </div>

</footer>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>








<script src="/js/vendor.min.8489448e4e75ceb388a38abde3871de9485502974c5feddcf04a3d413dc6e103.js"></script>
</body>

</html>