<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=description content="JDO Persistence - this section of GWT Tutorial uses JDO to persist sample data to HSQLDB. It provides a quick introduction to ORM and JDO."><meta name=author content="Maithilish"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-42139846-3"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-42139846-3")</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://google.com/article"},"articleSection":"tutorial","name":"JDO Persistence - GWT Tutorial - CodeTab","headline":"JDO Persistence - GWT Tutorial - CodeTab","url":"https://www.codetab.org/tutorial/gwt/database/persist/","description":"JDO Persistence - this section of GWT Tutorial uses JDO to persist sample data to HSQLDB. It provides a quick introduction to ORM and JDO.","inLanguage":"en","image":"https://www.codetab.org/logo.jpg","author":"Maithilish","creator":"Maithilish","publisher":{"@type":"Organization","name":"Maithilish","url":"https://www.codetab.org/","logo":{"@type":"ImageObject","url":"https://www.codetab.org/logo.png","width":"200","height":"200"}},"copyrightHolder":"Maithilish","copyrightYear":"2019","datePublished":"2019-01-10T18:45:00+0530","dateModified":"2019-01-10T18:45:00+0530","wordCount":"1655","keywords":["jdo persistence","Blog"]}</script><link rel=icon href=/favicon.ico><link rel=stylesheet href=/css/vendor.min.36dba173dca94f4b9fca7c6a1c3d15560f7a96c6ab0c0042dcd000f8469a9dc1.css integrity="sha256-Ntuhc9ypT0ufynxqHD0VVg96lsarDABC3NAA+EaancE="><title>JDO Persistence - GWT Tutorial - CodeTab</title></head><body id=top><header><nav id=navbar-main class="navbar fixed-top navbar-light navbar-expand-lg bg-white border-bottom shadow-sm"><div class=container-fluid><a class=navbar-brand href=/>Codetab</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbar aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbar><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/#tutorials><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#projects><span>Projects</span></a></li><li class=nav-item><a class=nav-link href=/post><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#about><span>About</span></a></li></ul></div></div></nav></header><div class=container-fluid><div class=row>&nbsp;</div><div class=row><aside id=sidebar class=col-md-3><div class=row><nav id=navbar-side class="bg-light text-secondary"><h4 class="text-muted bg-white pl-2">GWT Tutorial</h4><nav class="navbar navbar-light bg-white navbar-expand-md"><button class="navbar-toggler ml-auto" type=button data-toggle=collapse data-target=#bookmenu aria-controls=bookmenu aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=bookmenu><div><div id="GWT Tutorial - Complete Project - CodeTab"><div><a href=https://www.codetab.org/tutorial/gwt/introduction/ class="toc-page text-wrap text-muted">Introduction</a></div><div><a href=https://www.codetab.org/tutorial/gwt/install/ class="toc-page text-wrap text-muted">Install GWT in Eclipse</a></div><div><a href=https://www.codetab.org/tutorial/gwt/create-project/ class="toc-page text-wrap text-muted">Project Setup</a></div><div><a href=https://www.codetab.org/tutorial/gwt/gwt-project-code/ class="toc-page text-wrap text-muted">GWT Project Code</a></div><div><a href=https://www.codetab.org/tutorial/gwt/gwt-demo/ class="toc-page text-wrap text-muted">GWT Tutorial Demo</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-gwt-shell id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Shell</a><div id=tutorial-gwt-shell class=collapse><a href=https://www.codetab.org/tutorial/gwt/shell/finsshell/ class="toc-page dropdown-item text-wrap text-muted">UIBinder and Custom Widget</a>
<a href=https://www.codetab.org/tutorial/gwt/shell/contentpanel/ class="toc-page dropdown-item text-wrap text-muted">TabLayoutPanel</a>
<a href=https://www.codetab.org/tutorial/gwt/shell/gwt-logging/ class="toc-page dropdown-item text-wrap text-muted">Logging</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-gwt-menu id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Menu</a><div id=tutorial-gwt-menu class=collapse><a href=https://www.codetab.org/tutorial/gwt/menu/menu/ class="toc-page dropdown-item text-wrap text-muted">ClientBundle</a>
<a href=https://www.codetab.org/tutorial/gwt/menu/menu-parts/ class="toc-page dropdown-item text-wrap text-muted">Anchor</a>
<a href=https://www.codetab.org/tutorial/gwt/menu/gwt-eventbus-events/ class="toc-page dropdown-item text-wrap text-muted">EventBus</a>
<a href=https://www.codetab.org/tutorial/gwt/menu/gwt-eventbus-example/ class="toc-page dropdown-item text-wrap text-muted">EventBus Example</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-gwt-model id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Modle</a><div id=tutorial-gwt-model class=collapse><a href=https://www.codetab.org/tutorial/gwt/model/model/ class="toc-page dropdown-item text-wrap text-muted">Model</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-gwt-content id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Content</a><div id=tutorial-gwt-content class=collapse><a href=https://www.codetab.org/tutorial/gwt/content/content/ class="toc-page dropdown-item text-wrap text-muted">GWT Tutorial - Content</a>
<a href=https://www.codetab.org/tutorial/gwt/content/gwt-celltable/ class="toc-page dropdown-item text-wrap text-muted">CellTable</a>
<a href=https://www.codetab.org/tutorial/gwt/content/gwt-autosuggest/ class="toc-page dropdown-item text-wrap text-muted">SuggestBox</a>
<a href=https://www.codetab.org/tutorial/gwt/content/titlepanel/ class="toc-page dropdown-item text-wrap text-muted">TitlePanel</a>
<a href=https://www.codetab.org/tutorial/gwt/content/gwt-uifactory/ class="toc-page dropdown-item text-wrap text-muted">UiFactory</a>
<a href=https://www.codetab.org/tutorial/gwt/content/factpanel/ class="toc-page dropdown-item text-wrap text-muted">FactPanel</a>
<a href=https://www.codetab.org/tutorial/gwt/content/gwt-disclosepanel/ class="toc-page dropdown-item text-wrap text-muted">DisclosurePanel</a>
<a href=https://www.codetab.org/tutorial/gwt/content/toolbar/ class="toc-page dropdown-item text-wrap text-muted">Toolbar</a>
<a href=https://www.codetab.org/tutorial/gwt/content/gwt-datagrid/ class="toc-page dropdown-item text-wrap text-muted">DataGrid</a>
<a href=https://www.codetab.org/tutorial/gwt/content/gwt-chart/ class="toc-page dropdown-item text-wrap text-muted">Google Chart</a>
<a href=https://www.codetab.org/tutorial/gwt/content/gwt-close-tabs/ class="toc-page dropdown-item text-wrap text-muted">Close Tabs</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-gwt-rpc id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>RPC</a><div id=tutorial-gwt-rpc class=collapse><a href=https://www.codetab.org/tutorial/gwt/rpc/gwt-remote-procedure-calls/ class="toc-page dropdown-item text-wrap text-muted">RPC</a>
<a href=https://www.codetab.org/tutorial/gwt/rpc/rest-of-rpc/ class="toc-page dropdown-item text-wrap text-muted">Rest of RPC</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-gwt-database id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Database</a><div id=tutorial-gwt-database><a href=https://www.codetab.org/tutorial/gwt/database/setup-database/ class="toc-page dropdown-item text-wrap text-muted">Database Setup</a>
<a href=https://www.codetab.org/tutorial/gwt/database/persist/ class="toc-page dropdown-item text-wrap text-danger">JDO Persistence</a>
<a href=https://www.codetab.org/tutorial/gwt/database/retrieve/ class="toc-page dropdown-item text-wrap text-muted">JDO and Hibernate</a>
<a href=https://www.codetab.org/tutorial/gwt/database/gwt-dao/ class="toc-page dropdown-item text-wrap text-muted">DAO</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-gwt-google-app-engine id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Goolge App Engine</a><div id=tutorial-gwt-google-app-engine class=collapse><a href=https://www.codetab.org/tutorial/gwt/google-app-engine/google-app-engine/ class="toc-page dropdown-item text-wrap text-muted">Google App Engine</a>
<a href=https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-deploy/ class="toc-page dropdown-item text-wrap text-muted">App Engine Deploy</a>
<a href=https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-manage-data/ class="toc-page dropdown-item text-wrap text-muted">GAE Data Upload</a>
<a href=https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-cache/ class="toc-page dropdown-item text-wrap text-muted">App Engine Cache</a>
<a href=https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-task-queue/ class="toc-page dropdown-item text-wrap text-muted">App Engine Task Queue</a>
<a href=https://www.codetab.org/tutorial/gwt/google-app-engine/app-engine-backends/ class="toc-page dropdown-item text-wrap text-muted">GAE Backends</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-gwt-openshift id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>OpenShift</a><div id=tutorial-gwt-openshift class=collapse><a href=https://www.codetab.org/tutorial/gwt/openshift/openshift/ class="toc-page dropdown-item text-wrap text-muted">OpenShift Setup</a>
<a href=https://www.codetab.org/tutorial/gwt/openshift/prepare-openshift-project/ class="toc-page dropdown-item text-wrap text-muted">Prepare Project</a>
<a href=https://www.codetab.org/tutorial/gwt/openshift/openshift-configure/ class="toc-page dropdown-item text-wrap text-muted">Configure</a>
<a href=https://www.codetab.org/tutorial/gwt/openshift/openshift-build-deploy/ class="toc-page dropdown-item text-wrap text-muted">Build and Deploy</a>
<a href=https://www.codetab.org/tutorial/gwt/openshift/openshift-development/ class="toc-page dropdown-item text-wrap text-muted">Development</a>
<a href=https://www.codetab.org/tutorial/gwt/openshift/openshift-online-v3-deployment/ class="toc-page dropdown-item text-wrap text-muted">OpenShift Online V3 Deployment</a></div></div><div class="dropdown show mt-2"><a class="no-collapse-on-click card-link toc-section text-dark" href=#tutorial-gwt-build id=dropdownheader data-toggle=collapse aria-haspopup=true aria-expanded=false>Apache Ivy</a><div id=tutorial-gwt-build class=collapse><a href=https://www.codetab.org/tutorial/gwt/build/apache-ivy/ class="toc-page dropdown-item text-wrap text-muted">Apache Ivy</a></div></div></div></div></nav></nav></div></aside><div id=contentbar class=col-md-7><div id=share class="row justify-content-end"><div title=twitter><a href="https://twitter.com/intent/tweet?url=https://www.codetab.org/tutorial/gwt/database/persist/&amp;text=JDO%20Persistence%20-%20GWT%20Tutorial%20-%20CodeTab" target=_blank rel=noopener><i class="icon-twitter-squared text-secondary"></i></a></div><div title=facebook><a href="https://www.facebook.com/sharer.php?u=https://www.codetab.org/tutorial/gwt/database/persist/&amp;t=JDO%20Persistence%20-%20GWT%20Tutorial%20-%20CodeTab" target=_blank rel=noopener><i class="icon-facebook-squared text-secondary"></i></a></div><div title=linkedin><a href="https://www.linkedin.com/shareArticle?url=https://www.codetab.org/tutorial/gwt/database/persist/&amp;title=JDO%20Persistence%20-%20GWT%20Tutorial%20-%20CodeTab" target=_blank rel=noopener><i class="icon-linkedin-squared text-secondary"></i></a></div><div title=email><a href="mailto:?subject=JDO%20Persistence%20-%20GWT%20Tutorial%20-%20CodeTab&amp;body=https://www.codetab.org/tutorial/gwt/database/persist/" target=_blank rel=noopener><i class="icon-mail-squared text-secondary"></i></a></div><div title=whatsapp><a href="https://web.whatsapp.com/send?text=JDO%20Persistence%20-%20GWT%20Tutorial%20-%20CodeTab%20https://www.codetab.org/tutorial/gwt/database/persist/" target=_blank rel=noopener><i class="icon-whatsapp text-secondary"></i></a></div><div title=reddit><a href="https://reddit.com/submit?url=https://www.codetab.org/tutorial/gwt/database/persist/&amp;title=JDO%20Persistence%20-%20GWT%20Tutorial%20-%20CodeTab" target=_blank rel=noopener><i class="icon-reddit-alien text-secondary"></i></a></div><i class="icon-blank ctab-transparent"></i></div><div class=row><main id=content class="col-md-11 post-basic"><h2 id=82persist>8.2. Persist</h2><p>To load data, we use RStore which has following features,</p><ul><li><p>enhance java classes for persistence</p></li><li><p>create database schema</p></li><li><p>delete database schema</p></li><li><p>persist and retrieve objects from database</p></li></ul><h5 id=prepare-rstore-project>Prepare RStore project</h5><p>Download RStore.zip from the book site. Create a regular Java project
named rstore with default settings. Select the project in Project
Explorer and choose <strong>File</strong> → <strong>Import</strong>. In Import dialog, expand
general and choose Archive File and import RStore.zip into folder
rstore.</p><h5 id=dependencies>Dependencies</h5><p>RStore requires HSQLDB, Data Nucleus JDO, MyBatis and Hibernate
libraries. Following table lists the
dependencies.</p><h6 id=table81dependencies>Table 8.1. Dependencies</h6><table><thead><tr><th>Common</th><th>JDO</th><th>Hibernate</th><th>MyBatis</th></tr></thead><tbody><tr><td>hsqldb-2.2.9.jar</td><td>jdo-api-3.0.1.jar</td><td>hibernate-commons-annotations-4.0.1.Final.jar</td><td>mybatis-3.2.0.jar</td></tr><tr><td>commons-lang-2.6.jar</td><td>datanucleus-api-jdo-3.1.3.jar</td><td>hibernate-core-4.1.10.Final.jar</td><td></td></tr><tr><td>log4j-1.2.16.jar</td><td>datanucleus-core-3.1.4.jar</td><td>hibernate-jpa-2.0-api-1.0.1.Final.jar</td><td></td></tr><tr><td></td><td>datanucleus-rdbms-3.1.4.jar</td><td>jboss-logging-3.1.0.GA.jar</td><td></td></tr><tr><td></td><td>datanucleus-enhancer-3.1.1.jar</td><td>jboss-transaction-api_1.1_spec-1.0.0.Final.jar</td><td></td></tr><tr><td></td><td>asm-4.0.jar</td><td>antlr-2.7.7.jar</td><td></td></tr><tr><td></td><td></td><td>dom4j-1.6.1.jar</td><td></td></tr><tr><td></td><td></td><td>javassist-3.15.0-GA.jar</td><td></td></tr></tbody></table><h6 id=table82download-url>Table 8.2. Download URL</h6><table><col style=width:25%><col style=width:25%><col style=width:25%><col style=width:25%><thead><tr class=header><th>Common</th><th>JDO</th><th>Hibernate</th><th>MyBatis</th></tr></thead><tbody><tr class=odd><td><div class=para><a href=http://sourceforge.net/projects/hsqldb/files/hsqldb/>HSQLDB</a></div></td><td><div class=para><a href=http://sourceforge.net/projects/datanucleus/files/datanucleus-accessplatform/>Data Nucleus</a></div><div class=para>Download zip for rdbms and extract. <code class=filename>lib/</code> dir contains required jars.</div></td><td><div class=para><a href=http://sourceforge.net/projects/hibernate/files/hibernate4/>Hibernate</a></div><div class=para><code class=filename>lib/required</code> contains all the jars</div></td><td><div class=para><a href=http://code.google.com/p/mybatis/>MyBatis</a></div><div class=para>Download Core Framework zip</div></td></tr><tr class=even><td><div class=para><a href=http://commons.apache.org/proper/commons-lang//download_lang.cgi>Apache Commons</a></div></td><td><div class=para><a href=https://repository.ow2.org/>ASM</a></div></td><td></td><td></td></tr><tr class=odd><td><div class=para><a href=http://logging.apache.org/log4j/1.2/download.html>Log4j</a></div></td><td><div class=para><a href=http://db.apache.org/jdo/downloads.html>JDO API</a></div></td><td></td><td></td></tr></tbody></table><p>Download the packages and place the essential jars in projects lib
directory. Also add the jars to project build path.</p><h2 id=automatic-dependency-management>Automatic Dependency Management</h2><p>Thats a handful of downloads. Rather than struggling with downloads, it
makes a lot of sense to use dependency management softwares like Maven
or Apache Ivy.</p><p>Maven is the leading contender in this space, but if you are in a hurry
then go for Apache Ivy, which is equally powerful. Apache Ivy is quite
easy to start with, zero configuration and comes with a Plugin for
Eclipse.</p><p>With Eclipse Plugin, IvyDE, you may shift to automatic dependency
management in just under ten minutes. All you have to do is, install
IvyDE plugin and add the ivy.xml file, which is in the root folder of
RStore project, as Ivy Library. Thats all, Ivy downloads all the
dependencies and add them to project. It also updates project build
path, links package&rsquo;s API documentation and source. In case jars are
deleted from project workspace, it restores them from its cache to keep
the project in shipshape. Refer <a href=/tutorial/gwt/introduction/#tutorial-gwt-build>Apache Ivy</a> for quick start.</p><h5 id=run-rstore>Run RStore</h5><p>Open HSQLDB view and start HSQLDB. Next, open Ant View using <strong>Windows</strong>
→ <strong>Show View.</strong> Drag and drop <code>build.xml</code> to Ant View, which shows
following targets.</p><figure class=text-center><img class="lazy img-fluid" data-src=/tutorial/gwt/media/antview.png alt="Ant View"></figure><h6 id=figure83ant-view>Figure 8.3. Ant View</h6><p>Select Run target and run it. RStore compiles the project and enhances
the domain classes for persistence using Data Nucleus Enhance. It then
parses fins.xml file from data directory and creates four Symbol with
DataGroup, Data and Facts as found in xml file. Using JDO, it creates
the database schema and inserts four symbol objects to database tables.
Once objects are persisted, RStore retrieves a Symbol with all related
data first via JDO and then through alternate ORM, Hibernate and MyBatis
and output the details to Console. At this point, you may browse the
tables using Database Manager. Targets createschema creates empty tables
and dropschema drops the schema.</p><p>XML file, <code>data/fins-data.xml</code>, contains data for four symbols from year
2007 onwards. These data are from real listed companies from India where
financial year generally between 1st April to 31st March, hence you will
find financial year end dates as 31st March instead of usual 31st Dec.
Class <code>in.rstore.processor.SymbolParser</code> parse the XML file. Method
<code>startElement()</code> creates a new empty Symbol and pushes it to a Stack and
as parse progresses, populates the Symbol with data. On SAX
<strong>endElement</strong> event, it pops Symbol object from the stack and passes it
to <code>ISymbolProcessor</code> whose method <code>ISymbolProcessor.processSymbol()</code>
persists the object using JdoData. Let&rsquo;s see how JDO accomplish this.</p><div>&nbsp;</div><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-1281079745125126 data-ad-slot=6135368983></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><div>&nbsp;</div><h5 id=orm-configuration>ORM Configuration</h5><p>ORM softwares use two types of setup files.</p><ul><li><p>Configuration file - ORM requires various configurations to deal
with different databases and this file defines configuration
properties that is essential to connect and interact with database.</p></li><li><p>Mapping file - maps Java classes to tables and its fields to table
columns.</p></li></ul><p>For these files, each ORM has its own naming convention and path.
Following table shows RStore&rsquo;s configuration and mapping files.</p><h6 id=table83orm-setup>Table 8.3. ORM Setup</h6><table style=width:99%><col style=width:33%><col style=width:33%><col style=width:33%><thead><tr class=header><th>ORM</th><th>Configuration file</th><th>Mapping file</th></tr></thead><tbody><tr class=odd><td>JDO</td><td>src/datanucleus.properties</td><td>src/in/fins/shared/package.jdo</td></tr><tr class=even><td>Hibernate</td><td>src/hibernate.cfg.xml</td><td><div class=para>src/in/fins/shared/Symbol.hbm.xml</div><div class=para>src/in/fins/shared/DataGroup.hbm.xml</div><div class=para>src/in/fins/shared/Data.hbm.xml</div></td></tr><tr class=odd><td>MyBatis</td><td>src/mybatis-config.xml</td><td>src/in/fins/shared/Mapper.xml</td></tr></tbody></table><p>In this section, we use JDO to persist Symbols. JDO is a specification
to persist data. There are many implementations of JDO specification and
we use implementation by DataNucleus known as DataNucleus Access
Platform.</p><h5 id=configuration-file>Configuration file</h5><p>DataNucleus JDO uses <code>datanucleus.properties</code> to configure connection
and other properties.</p><p><code>src/datanucleus.properties</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-XML data-lang=XML><span class=line><span class=cl>javax.jdo.option.ConnectionDriverName=org.hsqldb.jdbcDriver
</span></span><span class=line><span class=cl>javax.jdo.option.ConnectionURL=jdbc:hsqldb:hsql://localhost/finsdb
</span></span><span class=line><span class=cl>javax.jdo.option.ConnectionUserName=sa
</span></span><span class=line><span class=cl>javax.jdo.option.ConnectionPassword=
</span></span><span class=line><span class=cl>javax.jdo.option.Mapping=hsql
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>datanucleus.metadata.validate=false
</span></span><span class=line><span class=cl>datanucleus.autoCreateSchema=true
</span></span><span class=line><span class=cl>datanucleus.validateTables=false
</span></span><span class=line><span class=cl>datanucleus.validateConstraints=false
</span></span></code></pre></div><p>Preferences set for HSQLDB is used to configure the JDBC connection.</p><h5 id=java-object-to-table-mapping>Java Object to Table Mapping</h5><p>JDO uses <code>package.jdo</code> as its mapping file, and allows to place it in
various locations. We prefer to place it along with persistable classes.</p><p><code>in.fins.shared/package.jdo</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-XML data-lang=XML><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE jdo PUBLIC
</span></span></span><span class=line><span class=cl><span class=cp>    &#34;-//Sun Microsystems, Inc.//DTD Java Data Objects Metadata 2.0//EN&#34;
</span></span></span><span class=line><span class=cl><span class=cp>    &#34;http://java.sun.com/dtd/jdo_2_0.dtd&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;jdo&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;package</span> <span class=na>name=</span><span class=s>&#34;in.fins.shared&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;class</span> <span class=na>name=</span><span class=s>&#34;Symbol&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;field</span> <span class=na>name=</span><span class=s>&#34;name&#34;</span> <span class=na>primary-key=</span><span class=s>&#34;true&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;field</span> <span class=na>name=</span><span class=s>&#34;label&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;field</span> <span class=na>name=</span><span class=s>&#34;dataGroups&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;element</span> <span class=na>column=</span><span class=s>&#34;symbol_name&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/field&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;query</span> <span class=na>name=</span><span class=s>&#34;selectSymbolNames&#34;</span> <span class=na>language=</span><span class=s>&#34;javax.jdo.query.JDOQL&#34;</span><span class=nt>&gt;</span><span class=cp>&lt;![CDATA[
</span></span></span><span class=line><span class=cl><span class=cp>            SELECT s.name FROM in.fins.shared.Symbol s
</span></span></span><span class=line><span class=cl><span class=cp>            ]]&gt;</span><span class=nt>&lt;/query&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/class&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;class</span> <span class=na>name=</span><span class=s>&#34;DataGroup&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;field</span> <span class=na>name=</span><span class=s>&#34;id&#34;</span> <span class=na>primary-key=</span><span class=s>&#34;true&#34;</span> <span class=na>value-strategy=</span><span class=s>&#34;identity&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;field</span> <span class=na>name=</span><span class=s>&#34;category&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;field</span> <span class=na>name=</span><span class=s>&#34;dataList&#34;</span> <span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;element</span> <span class=na>column=</span><span class=s>&#34;datagroup_id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/field&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;field</span> <span class=na>name=</span><span class=s>&#34;positionDate&#34;</span> <span class=na>persistence-modifier=</span><span class=s>&#34;none&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/class&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;class</span> <span class=na>name=</span><span class=s>&#34;Data&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;field</span> <span class=na>name=</span><span class=s>&#34;id&#34;</span> <span class=na>primary-key=</span><span class=s>&#34;true&#34;</span> <span class=na>value-strategy=</span><span class=s>&#34;identity&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;field</span> <span class=na>name=</span><span class=s>&#34;date&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;field</span> <span class=na>name=</span><span class=s>&#34;facts&#34;</span> <span class=na>serialized=</span><span class=s>&#34;true&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/class&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/package&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/jdo&gt;</span>
</span></span></code></pre></div><p><strong>Package</strong> element names the package that contains persistable classes
and <strong>Class</strong> element maps a class to a table and <strong>Field</strong> element map
field to table column. In Class element, <strong>table</strong> attribute is used to
name the table, and in its absence, class name is used as table name.
For primary key field, <strong>primary-key</strong> attribute is used. Attribute
<strong>persistence-modifier</strong> set to none indicates that field is not
persistable as in field positionDate. We will explain the <strong>Query</strong>
element in the next section when we retrieve the objects. JDO creates
following schema from this mapping file.</p><figure class=text-center><img class="lazy img-fluid" data-src=/tutorial/gwt/media/dbschema.png alt=Schema></figure><h6 id=figure84schema>Figure 8.4. Schema</h6><p>In the absence of table attribute in Class elements, JDO uses class
names to name tables. JDO maps the simple fields like <code>String</code>, <code>Date</code>
and <code>long</code> to equivalent database column types but it is quite
interesting to understand how JDO maps the List&lt;T> items.</p><p>For example, take Symbol which has a field List&lt;DataGroup> that holds
a list of <code>DataGroup</code> which comes from certain rows of DATAGROUP table.
In JDO, this 1-N unidirectional relationship may be handled using three
strategies; Join Table, Primay Key - Foreign Key (PK-FK) and Serialized
list. We use PK-FK and Serialized list strategies in RStore.</p><p>We use PK-FK strategy for List&lt;DataGroup> field in Symbol, which is
specified as</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-XML data-lang=XML><span class=line><span class=cl>    <span class=nt>&lt;field</span> <span class=na>name=</span><span class=s>&#34;dataGroups&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>       <span class=nt>&lt;element</span> <span class=na>column=</span><span class=s>&#34;symbol_name&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/field&gt;</span>
</span></span></code></pre></div><p>This tells JDO to create a column SYMBOL_NAME in DATAGROUP table and
use it as foreign key of primary key of SYMBOL. To construct the list of
DataGroup, JDO retrieves rows from table DATAGROUP whose SYMBOL_NAME is
same as SYMBOL.NAME. Likewise, between DATAGROUP and DATA tables,
DATAGROUP.ID and DATA.DATAGROUP_ID are PK and FK respectively.</p><p>JDO also creates columns DATAGROUPS_INTEGER_IDX and
DATALIST_INTEGER_IND and use them to sort the rows, if required.</p><p>Next, let&rsquo;s understand Serialized list strategy. Field List&lt;Fact> in
<code>Data</code> class, uses this strategy as we have set serialize attribute to
true. Usually, items from a collection are stored in individual rows,
but in some cases it is optimal to store the whole list in a single row.
There are roughly 800 facts in a Symbol, and FACT table ends up with 800
rows for each symbol if we use PK-FK strategy. But with the
Serialization, JDO serializes the List&lt;Fact> and inserts it into a
column named Facts which occupies a single row of DATA table.</p><p>There is a couple of drawbacks with this approach. For starters, one
will not be able to query the facts directly. But most importantly, it
is not possible to deserialize facts into a Fact of another package. In
other words, fully qualified name of the class should be same in both
phases, persistence and retrieval. For this reason, we placed all domain
classes in package <code>in.fins.shared</code> instead of say <code>in.rstore.xyz</code>, as
we have to retrieve them in Fins. Classes and fields which are not
serialized, are freely interchangeable between any package, but we must
honor the java serialization rules for serialized field, else we get
Class cast exception in runtime.</p><p>JDO and Hibernate also supports annotation of persistence classes and
with annotation one may avoid mapping files altogether. But with this,
persistence classes end up with ORM specific annotations. To avoid
lock-in with a specific ORM, we go with mapping files for the sake of
interchangeability.</p><div>&nbsp;</div><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-1281079745125126 data-ad-slot=6135368983></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><div>&nbsp;</div><h5 id=persist>Persist</h5><p>Once we are through with the mapping, it is quite easy to persist an
object in JDO. Following code block explains JDO persistence logic.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl>        <span class=n>PersistenceManagerFactory</span> <span class=n>pmf</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>                <span class=n>JDOHelper</span><span class=o>.</span><span class=na>getPersistenceManagerFactory</span><span class=o>(</span><span class=s>&#34;datanucleus.properties&#34;</span><span class=o>);</span>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>PersistenceManager</span> <span class=n>pm</span> <span class=o>=</span> <span class=n>pmf</span><span class=o>.</span><span class=na>getPersistenceManager</span><span class=o>();</span>                         
</span></span><span class=line><span class=cl>        <span class=n>Transaction</span> <span class=n>tx</span> <span class=o>=</span> <span class=n>pm</span><span class=o>.</span><span class=na>currentTransaction</span><span class=o>();</span>                                    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>tx</span><span class=o>.</span><span class=na>begin</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>pm</span><span class=o>.</span><span class=na>makePersistent</span><span class=o>(</span><span class=n>symbol</span><span class=o>);</span>                                               
</span></span><span class=line><span class=cl>            <span class=n>tx</span><span class=o>.</span><span class=na>commit</span><span class=o>();</span>                                                             
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>tx</span><span class=o>.</span><span class=na>isActive</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>tx</span><span class=o>.</span><span class=na>rollback</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=n>pm</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span></code></pre></div><table><col style=width:50%><col style=width:50%><tbody><tr class=odd><td style=text-align:left><p><img src=../media/1.png alt=1 class=callout></p></td><td style=text-align:left><div class=para>get <code class=classname>PersistenceManagerFactory</code> instance through <code class=classname>JDOHelper</code> and factory configures JDO and JDBC options through the configuration file <code class=filename>datanucleus.properties</code>. Usually the factory is singleton as a single instance is sufficient across the application.</div></td></tr><tr class=even><td style=text-align:left><p><img src=../media/2.png alt=2 class=callout></p></td><td style=text-align:left><div class=para>get <code class=classname>PersistenceManager</code> from <code class=classname>PersistenceManagerFactory</code>. PM is all that is required to interact with the database.</div></td></tr><tr class=odd><td style=text-align:left><p><img src=../media/3.png alt=3 class=callout></p></td><td style=text-align:left><div class=para>get current transaction from PM.</div></td></tr><tr class=even><td style=text-align:left><p><img src=../media/4.png alt=4 class=callout></p></td><td style=text-align:left><div class=para>Method <code class=methodname>PersistenceManager.makePersistent()</code> persists the object. In this example, we are passing the fully loaded Symbol object, and PM persists Symbol and its DataGroups, Data and Facts.</div></td></tr><tr class=odd><td style=text-align:left><p><img src=../media/5.png alt=5 class=callout></p></td><td style=text-align:left><div class=para>either commit or rollback transaction based on transaction outcome.</div></td></tr></tbody></table><p>The actual method that takes care of persistence in RStore is
<code>JdoDao.insert()</code>.</p><p><code>in.rstore.dao.jdo/JdoDao.java</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl>        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>insert</span><span class=o>(</span><span class=n>Symbol</span> <span class=n>symbol</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>PersistenceManager</span> <span class=n>pm</span> <span class=o>=</span> <span class=n>pmf</span><span class=o>.</span><span class=na>getPersistenceManager</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=n>Transaction</span> <span class=n>tx</span> <span class=o>=</span> <span class=n>pm</span><span class=o>.</span><span class=na>currentTransaction</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>tx</span><span class=o>.</span><span class=na>begin</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                        <span class=n>Symbol</span> <span class=n>existingSymbol</span> <span class=o>=</span> <span class=n>pm</span><span class=o>.</span><span class=na>getObjectById</span><span class=o>(</span><span class=n>Symbol</span><span class=o>.</span><span class=na>class</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                                        <span class=n>symbol</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                        <span class=n>SymbolHelper</span><span class=o>.</span><span class=na>updateSymbol</span><span class=o>(</span><span class=n>symbol</span><span class=o>,</span> <span class=n>existingSymbol</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                        <span class=n>tx</span><span class=o>.</span><span class=na>commit</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>JDOObjectNotFoundException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>pm</span><span class=o>.</span><span class=na>makePersistent</span><span class=o>(</span><span class=n>symbol</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                        <span class=n>tx</span><span class=o>.</span><span class=na>commit</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=o>(</span><span class=n>tx</span><span class=o>.</span><span class=na>isActive</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                <span class=n>tx</span><span class=o>.</span><span class=na>rollback</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span>
</span></span><span class=line><span class=cl>                        <span class=n>pm</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span></code></pre></div><p><code>JdoDao.insert()</code>. initially tries to retrieve symbol object if similar
one already exists in the database. If found, it uses
<code>SymbolHelper.updateSymbol()</code> method to update the retrieved object&rsquo;s
fields with new values. JDO keeps track of any modification to retrieved
object and auto updates the tables on any changes. In case object is not
found in the database, then <code>PM.makePersistent()</code> method persists the
new symbol.</p><p>Next section explains object retrieval via JDO, Hibernate or MyBatis.</p></main></div></div><aside id=sidebar-right class=col-md-2><div class="row my-5 justify-content-center border"><div>&nbsp;</div><ins class=adsbygoogle style=display:inline-block;width:160px;height:600px data-ad-client=ca-pub-1281079745125126 data-ad-slot=8963022093></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><div>&nbsp;</div></div></aside></div></div><footer class="container-fluid mt-5"><div class=row><div class="col ml-auto"><div class="row mb-1 ml-2"><a class=text-muted href=/privacy-policy>Privacy</a></div><div class="row text-muted mb-2 ml-2"><span>&copy; 2019 &#183;Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span></div></div><div class="col mr-auto"><span class=float-right><a href=# id=back_to_top><i class="icon-up-open h1 text-secondary"></i></a></span></div></div></footer><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<script src=/js/vendor.min.e0afe83ba5579b9676fc5f849c1becff1395739520a7c0bc45535f04acd819c3.js></script></body></html>