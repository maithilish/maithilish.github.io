<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=description content="This post explains the use of Java IO classes and Charsets"><meta name=author content="Maithilish"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-42139846-3"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-42139846-3');</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://google.com/article"},"articleSection":"post","name":"Java IO Classes and Charsets","headline":"Java IO Classes and Charsets","url":"https://www.codetab.org/post/java-io-charset/","description":"This post explains the use of Java IO classes and Charsets","inLanguage":"en","image":"https://www.codetab.org/logo.jpg","author":"Maithilish","creator":"Maithilish","publisher":{"@type":"Organization","name":"Maithilish","url":"https://www.codetab.org/","logo":{"@type":"ImageObject","url":"https://www.codetab.org/logo.png","width":"200","height":"200"}},"copyrightHolder":"Maithilish","copyrightYear":"2019","datePublished":"2019-09-29T11:00:00Z","dateModified":"2019-09-29T11:00:00Z","wordCount":"670","keywords":["java unicode encode decode transcode linux io","Blog"]}</script><link rel=icon href=/favicon.ico><link rel=stylesheet href=/css/vendor.min.e7fd2d89f73c680873529a110a9007503a1bda864a3a3a6c53c4eb02a54c35eb.css integrity="sha256-5/0tifc8aAhzUpoRCpAHUDob2oZKOjpsU8TrAqVMNes="><title>Java IO Classes and Charsets</title></head><body id=top><header><nav id=navbar-main class="navbar fixed-top navbar-light navbar-expand-lg bg-white border-bottom shadow-sm"><div class=container-fluid><a class=navbar-brand href=/>Codetab</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbar aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbar><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/#tutorials><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#projects><span>Projects</span></a></li><li class=nav-item><a class=nav-link href=/post><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#about><span>About</span></a></li></ul></div></div></nav></header><div class=container-fluid><div class=row>&nbsp;</div><div class=row><div id=contentspace class="col-md-8 post-basic order-md-2"><h2>Java IO Classes and Charsets</h2><small class=text-muted>Sep 29, 2019 . 4 min read</small><div id=share class="row mx-0 justify-content-end"><div title=twitter><a href="https://twitter.com/intent/tweet?url=https://www.codetab.org/post/java-io-charset/&text=Java%20IO%20Classes%20and%20Charsets" target=_blank rel=noopener><i class="icon-twitter-squared text-secondary"></i></a></div><div title=facebook><a href="https://www.facebook.com/sharer.php?u=https://www.codetab.org/post/java-io-charset/&t=Java%20IO%20Classes%20and%20Charsets" target=_blank rel=noopener><i class="icon-facebook-squared text-secondary"></i></a></div><div title=linkedin><a href="https://www.linkedin.com/shareArticle?url=https://www.codetab.org/post/java-io-charset/&title=Java%20IO%20Classes%20and%20Charsets" target=_blank rel=noopener><i class="icon-linkedin-squared text-secondary"></i></a></div><div title=email><a href="mailto:?subject=Java%20IO%20Classes%20and%20Charsets&body=https://www.codetab.org/post/java-io-charset/" target=_blank rel=noopener><i class="icon-mail-squared text-secondary"></i></a></div><div title=whatsapp><a href="https://web.whatsapp.com/send?text=Java%20IO%20Classes%20and%20Charsets%20https://www.codetab.org/post/java-io-charset/" target=_blank rel=noopener><i class="icon-whatsapp text-secondary"></i></a></div><div title=reddit><a href="https://reddit.com/submit?url=https://www.codetab.org/post/java-io-charset/&title=Java%20IO%20Classes%20and%20Charsets" target=_blank rel=noopener><i class="icon-reddit-alien text-secondary"></i></a></div><i class="icon-blank ctab-transparent"></i></div><hr class=my-3><main id=content class=post-basic><h1 id=java-io-unicode>Java IO Unicode</h1><p>In the previous post, we covered unicode basics. This post explains charset handling while working with Java IO classes.</p><h2 id=char-io>Char IO</h2><p>Use char stream IO classes <code>Reader</code> and <code>Writer</code> while dealing with text and text files. As already explained, the default charset of Java platform is UTF-8 and text written using Writer class is encoded in UTF-8 and Reader class reads the text in UTF-8.</p><p>Using java.io package, we can write and read a text file in default charset as below.</p><div class=highlight><pre class=chroma><code class=language-Java data-lang=Java>
    <span class=n>String</span> <span class=n>str</span> <span class=o>=</span> <span class=s>&#34;a Z â Δ 你 好 ಡ ತ ع&#34;</span><span class=o>;</span>
    <span class=n>File</span> <span class=n>file</span> <span class=o>=</span> <span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=s>&#34;x-utf8.txt&#34;</span><span class=o>);</span>

    <span class=c1>// write file in default charset (UTF-8)
</span><span class=c1></span>    <span class=k>try</span> <span class=o>(</span><span class=n>BufferedWriter</span> <span class=n>out</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedWriter</span><span class=o>(</span><span class=k>new</span> <span class=n>FileWriter</span><span class=o>(</span><span class=n>file</span><span class=o>)))</span> <span class=o>{</span>
        <span class=n>out</span><span class=o>.</span><span class=na>write</span><span class=o>(</span><span class=n>str</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=c1>// read file in default charset (UTF-8)
</span><span class=c1></span>    <span class=k>try</span> <span class=o>(</span><span class=n>BufferedReader</span> <span class=n>in</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedReader</span><span class=o>(</span><span class=k>new</span> <span class=n>FileReader</span><span class=o>(</span><span class=n>file</span><span class=o>)))</span> <span class=o>{</span>
        <span class=n>String</span> <span class=n>line</span><span class=o>;</span>
        <span class=k>while</span> <span class=o>((</span><span class=n>line</span> <span class=o>=</span> <span class=n>in</span><span class=o>.</span><span class=na>readLine</span><span class=o>())</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>line</span><span class=o>);</span>
        <span class=o>}</span>
    <span class=o>}</span>
    
</code></pre></div><p>The above example, uses char stream classes - Writer and Reader - directly that uses default character set (UTF-8).</p><h2 id=byte-io>Byte IO</h2><p>To encode/decode in non-default charset use byte oriented classes and use a bridge class to convert it char oriented class. For example, to read file as raw bytes use <code>FileInputStream</code> and wrap it with <code>InputStreamReader</code>, a bridge that can encode the bytes to chars in specified charset. Similarly for output, use <code>OutputStreamWriter</code> (bridge) and <code>FileOutputWriter</code> (byte output)</p><div class=highlight><pre class=chroma><code class=language-Java data-lang=Java>
    <span class=c1>// read in UTF_16LE
</span><span class=c1></span>    <span class=n>InputStream</span> <span class=n>byteInStream</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=n>file</span><span class=o>);</span>
    <span class=n>Reader</span> <span class=n>encodedCharStream</span> <span class=o>=</span> 
        <span class=k>new</span> <span class=n>InputStreamReader</span><span class=o>(</span><span class=n>byteInStream</span><span class=o>,</span> <span class=n>StandardCharsets</span><span class=o>.</span><span class=na>UTF_16LE</span><span class=o>);</span>

    <span class=c1>// write in UTF_16LE
</span><span class=c1></span>    <span class=n>OutputStream</span> <span class=n>byteOutStream</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileOutputStream</span><span class=o>(</span><span class=n>file</span><span class=o>);</span>
    <span class=n>Writer</span> <span class=n>decodedCharStream</span> <span class=o>=</span> 
        <span class=k>new</span> <span class=n>OutputStreamWriter</span><span class=o>(</span><span class=n>byteOutStream</span><span class=o>,</span> <span class=n>StandardCharsets</span><span class=o>.</span><span class=na>UTF_16LE</span><span class=o>);</span>

</code></pre></div><p>Following example, writes a file in UTF_16BE charset and reads it back.</p><div class=highlight><pre class=chroma><code class=language-Java data-lang=Java>
    <span class=n>String</span> <span class=n>str</span> <span class=o>=</span> <span class=s>&#34;a Z â Δ 你 好 ಡ ತ ع&#34;</span><span class=o>;</span>
    <span class=n>Charset</span> <span class=n>charset</span> <span class=o>=</span> <span class=n>StandardCharsets</span><span class=o>.</span><span class=na>UTF_16BE</span><span class=o>;</span>
    <span class=n>File</span> <span class=n>file</span> <span class=o>=</span> <span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=s>&#34;x-utf16be.txt&#34;</span><span class=o>);</span>

    <span class=c1>// write file in non default charset
</span><span class=c1></span>    <span class=k>try</span> <span class=o>(</span><span class=n>BufferedWriter</span> <span class=n>out</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedWriter</span><span class=o>(</span>
        <span class=k>new</span> <span class=n>OutputStreamWriter</span><span class=o>(</span><span class=k>new</span> <span class=n>FileOutputStream</span><span class=o>(</span><span class=n>file</span><span class=o>),</span> <span class=n>charset</span><span class=o>)))</span> <span class=o>{</span>
      <span class=n>out</span><span class=o>.</span><span class=na>write</span><span class=o>(</span><span class=n>str</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=c1>// read file in non default charset
</span><span class=c1></span>    <span class=k>try</span> <span class=o>(</span><span class=n>BufferedReader</span> <span class=n>in</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedReader</span><span class=o>(</span>
            <span class=k>new</span> <span class=n>InputStreamReader</span><span class=o>(</span><span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=n>file</span><span class=o>),</span> <span class=n>charset</span><span class=o>)))</span> <span class=o>{</span>
        <span class=n>String</span> <span class=n>line</span><span class=o>;</span>
        <span class=k>while</span> <span class=o>((</span><span class=n>line</span> <span class=o>=</span> <span class=n>in</span><span class=o>.</span><span class=na>readLine</span><span class=o>())</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>line</span><span class=o>);</span>
        <span class=o>}</span>      
    <span class=o>}</span>

</code></pre></div><h2 id=transcoding>Transcoding</h2><p>Transcoding is the direct digital-to-digital conversion from an encoding to another, such as UTF-8 to UTF-16. We regularly encounter transcoding in video, audio and image files but rarely with text files.</p><p>Imagine, we receive a stream of bytes over the network encoded in CP-1252 (Windows-1252) or ISO 8859-1 and want to save it to text file in UTF 8.</p><p>There are couple of options to transcode from one charset to another. The easiest way to transcode it to use String class.</p><div class=highlight><pre class=chroma><code class=language-Java data-lang=Java>
    <span class=n>String</span> <span class=n>str</span> <span class=o>=</span> <span class=k>new</span> <span class=n>String</span><span class=o>(</span><span class=n>bytes</span><span class=o>,</span> <span class=n>StandardCharsets</span><span class=o>.</span><span class=na>ISO_8859_1</span><span class=o>);</span>
    <span class=kt>byte</span><span class=o>[]</span> <span class=n>toBytes</span> <span class=o>=</span> <span class=n>str</span><span class=o>.</span><span class=na>getBytes</span><span class=o>(</span><span class=n>StandardCharsets</span><span class=o>.</span><span class=na>UTF_8</span><span class=o>);</span>

</code></pre></div><p>While this quite fast, it suffers when we deal with large set of byte as heap memory gets allocated to multiple large strings. Better option is to use java.io classes as shown below:</p><figure class=text-center><img class="lazy img-fluid" data-src=/post/java-io-charset/media/transcode-io.png alt="Java Unicode charset convert"></figure><p>See <a href=https://github.com/maithilish/codefs/blob/master/misc/transcode/Transcode.java target=_blank>Transcode.java</a> for transcoding example and <a href=https://github.com/maithilish/codefs/tree/master/misc/char-server target=_blank>Char Server</a> for a rough take on encoding between server and socket.</p><h2 id=play-with-unicode-in-linux-terminal>Play with Unicode in Linux terminal</h2><p>We can work with text encoding in Linux terminal with some simple commands. Note that Linux terminal can display ASCII and UTF-8 files but not UTF-16.</p><div class=highlight><pre class=chroma><code class=language-Bash data-lang=Bash>
    <span class=c1># create a text file from encoded bytes</span>
    $ <span class=nb>echo</span> -n -e <span class=s1>&#39;\xce\x94&#39;</span> &gt; delta-8.txt
    $ <span class=nb>echo</span> -n -e <span class=s1>&#39;\xfe\xff\x03\x94&#39;</span> &gt; delta-16.txt
    $ <span class=nb>echo</span> -n -e <span class=s1>&#39;\xe4\xbd\xa0\x20\xe5\xa5\xbd&#39;</span> &gt; nihou-8.txt
    $ <span class=nb>echo</span> -n -e <span class=s1>&#39;\xfe\xff\x4f\x60\xfe\xff\x20\x59\x7d&#39;</span> &gt; nihou-16.txt

    <span class=c1># debug a text file as hex</span>
    $ hd nihou-16.txt

    <span class=m>00000000</span>  fe ff 4f <span class=m>60</span> fe ff <span class=m>20</span> <span class=m>59</span> 7d  <span class=p>|</span>..O<span class=sb>`</span>.. Y<span class=o>}</span><span class=p>|</span>
    <span class=m>00000009</span>

    <span class=c1># know file encoding scheme</span>
    $ file -i *.txt

    delta-16.txt: text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-16be
    delta-8.txt:  text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8
    nihou-16.txt: text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-16be
    nihou-8.txt:  text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8

    <span class=c1># transcode from UTF 8 to UTF 16LE</span>
    $ iconv -f UTF8 -t UTF16LE &lt; nihou-8.txt &gt; nihou-16le.txt

    <span class=c1># list encoding schemes </span>
    $ iconv -l

    <span class=c1># read a file in default charset</span>
    $ gedit nihou-8.txt     
    <span class=c1># non-default</span>
    $ gedit --encoding UTF-16LE nihou-16le.txt

</code></pre></div><h2 id=further-reading>Further Reading</h2><p>Some good posts about Unicode usage in Java.</p><p><a href=https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/ target=_blank>The Absolute Minimum Developers should know about Unicode and Character Sets</a></p><p><a href=http://illegalargumentexception.blogspot.com/2009/05/java-rough-guide-to-character-encoding.html target=_blank>Java: a rough guide to character encoding</a></p><p><a href=https://wiki.sei.cmu.edu/confluence/display/java/STR00-J.+Don%27t+form+strings+containing+partial+characters+from+variable-width+encodings target=_blank>Don&rsquo;t form strings containing partial characters from variable-width encodings</a></p></main></div><aside id=sidebar class="col-md-3 order-md-1"><div class="row my-5 justify-content-center"><div>&nbsp;</div><ins class=adsbygoogle style=display:inline-block;width:160px;height:600px data-ad-client=ca-pub-1281079745125126 data-ad-slot=8963022093></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script><div>&nbsp;</div></div></aside><aside id=sidebar-right class="col-md-1 order-md-last"></aside></div></div><footer class="container-fluid mt-5"><div class=row><div class="col ml-auto"><div class="row mb-1 ml-2"><a class=text-muted href=/privacy-policy>Privacy</a></div><div class="row text-muted mb-2 ml-2"><span>&copy; 2019 &#183;Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span></div></div><div class="col mr-auto"><span class=float-right><a href=# id=back_to_top><i class="icon-up-open h1 text-secondary"></i></a></span></div></div></footer><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script src=/js/vendor.min.8489448e4e75ceb388a38abde3871de9485502974c5feddcf04a3d413dc6e103.js></script></body></html>