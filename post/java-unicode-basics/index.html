<!DOCTYPE html>
<html lang="en-us">

<head><meta charset="utf-8">
<meta name="description" content="Things can get quite confusing when we crisscross between byte and char streams in Java unless we know basics of character sets and encoding. This post demystifies Unicode with easy to follow examples">
<meta name="author" content="Maithilish">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">



<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://google.com/article"
        },
        "articleSection" : "post",
        "name" : "Fun with Unicode in Java",
        "headline" : "Fun with Unicode in Java",
        "url" : "https://www.codetab.org/post/java-unicode-basics/",
        "description" : "Things can get quite confusing when we crisscross between byte and char streams in Java unless we know basics of character sets and encoding. This post demystifies Unicode with easy to follow examples",
        "inLanguage" : "en",
        "image": "https://www.codetab.org/logo.jpg",
        "author" : "Maithilish",
        "creator" : "Maithilish",
        "publisher": {
            "@type": "Organization",
            "name": "Maithilish",
            "url": "https://www.codetab.org/",
            "logo": {
               "@type": "ImageObject",
               "url": "https://www.codetab.org/logo.png",
               "width":"200",
               "height":"200"
            }
        },
        "copyrightHolder" : "Maithilish",
        "copyrightYear" : "2019",
        "datePublished": "2019-09-29T11:00:00Z",
        "dateModified" : "2019-09-29T11:00:00Z",
        "wordCount" : "1841",
        "keywords" : [ "java unicode encode decode transcode linux","Blog" ]
    }
</script>
<link rel="icon" href="/favicon.ico">






<link rel="stylesheet" href="/css/vendor.min.e7fd2d89f73c680873529a110a9007503a1bda864a3a3a6c53c4eb02a54c35eb.css" integrity="sha256-5/0tifc8aAhzUpoRCpAHUDob2oZKOjpsU8TrAqVMNes=">

<title>Fun with Unicode in Java</title></head>

<body id="top"><header><nav id="navbar-main" class="navbar fixed-top navbar-light navbar-expand-lg bg-white border-bottom shadow-sm">

    <div class="container-fluid">

        
        <a class="navbar-brand" href="/">Codetab</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbar">

            
            
            <ul class="navbar-nav ml-auto">
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#tutorials"  >
                        
                        <span>Home</span>
                        
                    </a>
                </li>

                
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#projects"  >
                        
                        <span>Projects</span>
                        
                    </a>
                </li>

                
                

                

                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/post"  >
                        
                        <span>Posts</span>
                        
                    </a>
                </li>

                
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#about"  >
                        
                        <span>About</span>
                        
                    </a>
                </li>

                
                

            </ul>

        </div>
    </div>
</nav></header>

<div class="container-fluid">
  <div class="row">&nbsp;</div>

  <div class="row">
    
    <div id="contentspace" class="col-md-8 post-basic order-md-2">
      <h2>Fun with Unicode in Java</h2>
      <small class="text-muted">
        Sep 29, 2019 . 9 min read
      </small>
      <div id="share" class="row mx-0 justify-content-end">





<div title=twitter>
    <a href="https://twitter.com/intent/tweet?url=https://www.codetab.org/post/java-unicode-basics/&amp;text=Fun%20with%20Unicode%20in%20Java" target="_blank" rel="noopener">
        <i class="icon-twitter-squared text-secondary"></i>
    </a>
</div>




<div title=facebook>
    <a href="https://www.facebook.com/sharer.php?u=https://www.codetab.org/post/java-unicode-basics/&amp;t=Fun%20with%20Unicode%20in%20Java" target="_blank" rel="noopener">
        <i class="icon-facebook-squared text-secondary"></i>
    </a>
</div>




<div title=linkedin>
    <a href="https://www.linkedin.com/shareArticle?url=https://www.codetab.org/post/java-unicode-basics/&amp;title=Fun%20with%20Unicode%20in%20Java" target="_blank" rel="noopener">
        <i class="icon-linkedin-squared text-secondary"></i>
    </a>
</div>




<div title=email>
    <a href="mailto:?subject=Fun%20with%20Unicode%20in%20Java&amp;body=https://www.codetab.org/post/java-unicode-basics/" target="_blank" rel="noopener">
        <i class="icon-mail-squared text-secondary"></i>
    </a>
</div>




<div title=whatsapp>
    <a href="https://web.whatsapp.com/send?text=Fun%20with%20Unicode%20in%20Java%20https://www.codetab.org/post/java-unicode-basics/" target="_blank" rel="noopener">
        <i class="icon-whatsapp text-secondary"></i>
    </a>
</div>




<div title=reddit>
    <a href="https://reddit.com/submit?url=https://www.codetab.org/post/java-unicode-basics/&amp;title=Fun%20with%20Unicode%20in%20Java" target="_blank" rel="noopener">
        <i class="icon-reddit-alien text-secondary"></i>
    </a>
</div>




<div title=weibo>
    <a href="https://service.weibo.com/share/share.php?url=https://www.codetab.org/post/java-unicode-basics/&amp;title=Fun%20with%20Unicode%20in%20Java" target="_blank" rel="noopener">
        <i class="icon-weibo text-secondary"></i>
    </a>
</div>




<i class="icon-blank ctab-transparent"></i></div>
      <hr class="my-3" />
      <main id="content" class="post-basic">
        <h1 id="fun-with-unicode-in-java">Fun with Unicode in Java</h1>
<p>Normally we don&rsquo;t pay much attention to character encoding in Java. However, when we crisscross byte and char streams, things can get confusing unless we know the charset basics. Many tutorials and posts about character encoding are heavy in theory with little real examples. In this post, we try to demystify Unicode with easy to grasp examples.</p>
<h2 id="encode-and-decode">Encode and Decode</h2>
<p>Before diving into Unicode, first let&rsquo;s understand terms - encode and decode. Suppose we capture a video in mpeg format, the encoder in the camera encodes the pixels into bytes and when played back, the decoder coverts back the bytes to pixels. Similar process plays out when we create a text file. For example, when letter H is typed in a text editor, the OS encodes the keystroke as byte 0x48 and pass it to editor. The editor holds the bytes in its buffer and pass it on to windowing system which decodes and displays the byte 0x48 as H. When file is saved, 0x48 gets into the file.</p>
<p>In short, encoder converts items such as pixels, audio stream or characters as binary bytes and decoder reconverts the bytes back original form.</p>
<h2 id="encode-and-decode-java-string">Encode and Decode Java String</h2>
<p>Let&rsquo;s go ahead and encode some strings in Java.</p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java">
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StringEncoder</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">&#34;Hello&#34;</span><span class="o">;</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">StandardCharsets</span><span class="o">.</span><span class="na">US_ASCII</span><span class="o">);</span>
        <span class="n">printBytes</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printBytes</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">byte</span> <span class="n">b</span> <span class="o">:</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;x%02x &#34;</span><span class="o">,</span> <span class="n">b</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sb</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><p>The <code>String.getBytes()</code> method encodes the string as bytes (binary) using US_ASCII charset and <code>printBytes()</code> method outputs bytes in hex format. The hex output <code>0x48 0x65 0x6c 0x6c 0x6f</code> is binary of form string <code>Hello</code> in ASCII.</p>
<p>Next, let&rsquo;s see how to decode the bytes back as string.</p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java">
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StringDecoder</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="o">{</span><span class="n">0x48</span><span class="o">,</span> <span class="n">0x65</span><span class="o">,</span> <span class="n">0x6c</span><span class="o">,</span> <span class="n">0x6c</span><span class="o">,</span> <span class="n">0x6f</span><span class="o">};</span>
        <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">US_ASCII</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
    <span class="o">}</span>    
<span class="o">}</span>    
    
</code></pre></div><p>Here we decode byte array filled with <code>0x48 0x65 0x6c 0x6c 0x6f</code> as a new string. The String class decodes the bytes with US_ASCII charset which is displayed as <code>Hello</code>.</p>
<p>We can omit <code>StandardCharsets.US_ASCII</code> argument in  <code>new String(bytes)</code> and <code>str.getBytes()</code>. The results will be same as default charset of Java is UTF-8 which use same hex value for English alphabets as US_ASCII.</p>
<p>The ASCII encoding scheme is quite simple where each character is mapped to a single byte, for example, H is encoded as 0x48, e as 0x65 and so on. It can handle English character set, numbers and control characters such as backspace, carriage return etc., but not many western or asian language characters etc.</p>
<h2 id="say-hello-in-mandarin">Say Hello in Mandarin</h2>
<p>Hello in Mandarin is nĭ hăo. It is written using two characters 你 (nĭ) and 好 (hăo). Let&rsquo;s encode and decode single character 你 (nĭ).</p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java">
    <span class="c1">// encode
</span><span class="c1"></span>    <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">&#34;你&#34;</span><span class="o">;</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
    <span class="n">printBytes</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>      <span class="c1">// xe4 xbd xa0  (3 bytes)
</span><span class="c1"></span>
    <span class="c1">// decode
</span><span class="c1"></span>    <span class="n">String</span> <span class="n">decodedStr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">decodedStr</span><span class="o">);</span>    <span class="c1">// 你  
</span><span class="c1"></span>
</code></pre></div><p>Encoding the character 你 with UTF-8 character set returns an array of 3 bytes <code>xe4 xbd xa0</code>, which on decode, returns 你.</p>
<p>Let&rsquo;s do the same with another standard character set UTF_16.</p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java">
    <span class="c1">// encode
</span><span class="c1"></span>    <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">&#34;你&#34;</span><span class="o">;</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_16</span><span class="o">);</span>
    <span class="n">printBytes</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>      <span class="c1">// xfe xff x4f x60  (4 bytes)
</span><span class="c1"></span>
    <span class="c1">// decode
</span><span class="c1"></span>    <span class="n">String</span> <span class="n">decodedStr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_16</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">decodedStr</span><span class="o">);</span>    <span class="c1">// 你  
</span><span class="c1"></span>
</code></pre></div><p>Character set UTF_16 encodes 你 into 4 bytes - <code>xfe xff x4f x60</code> while UTF_8 manages it with 3 bytes.</p>
<p>Just for heck of it, try to encode 你 with US_ASCII and it returns single byte <code>x3f</code> which decodes to ? character. This is because ASCII is single byte encoding scheme which can&rsquo;t handle characters other than English alphabets.</p>
<h2 id="introducing-unicode">Introducing Unicode</h2>
<p>Unicode is coded character set (or simply character set) capable of representing most of the writing systems. The recent version of Unicode contains around 138,000 characters covering 150 modern and historic languages and scripts, as well as symbol sets and emoji. The below table shows how some characters from different languages are represent in Unicode.</p>
<table>
<thead>
<tr>
<th>Character</th>
<th>Code Point</th>
<th>UTF_8</th>
<th>UTF_16</th>
<th>Language</th>
</tr>
</thead>
<tbody>
<tr>
<td>a</td>
<td>U+0061</td>
<td>61</td>
<td>00 61</td>
<td>English</td>
</tr>
<tr>
<td>Z</td>
<td>U+005A</td>
<td>5a</td>
<td>00 5a</td>
<td>English</td>
</tr>
<tr>
<td>â</td>
<td>U+00E2</td>
<td>c3 a2</td>
<td>00 e2</td>
<td>Latin</td>
</tr>
<tr>
<td>Δ</td>
<td>U+0394</td>
<td>ce 94</td>
<td>03 94</td>
<td>Latin</td>
</tr>
<tr>
<td>ع</td>
<td>U+0639</td>
<td>d8 b9</td>
<td>06 39</td>
<td>Arabic</td>
</tr>
<tr>
<td>你</td>
<td>U+4F60</td>
<td>e4 bd a0</td>
<td>4f 60</td>
<td>Chinese</td>
</tr>
<tr>
<td>好</td>
<td>U+597D</td>
<td>e5 a5 bd</td>
<td>59 7d</td>
<td>Chinese</td>
</tr>
<tr>
<td>ಡ</td>
<td>U+0CA1</td>
<td>e0 b2 a1</td>
<td>0c a1</td>
<td>Kannada</td>
</tr>
<tr>
<td>ತ</td>
<td>U+0CA4</td>
<td>e0 b2 a4</td>
<td>0c a4</td>
<td>Kannada</td>
</tr>
</tbody>
</table>
<p>Each character or symbol is represented by an unique Code point. Unicode has 1,112,064 code points out of which around 138,000 are presently defined. Unicode code point is represented as U+xxxx where U signifies it as Unicode. The <code>String.codePointAt(int index)</code> method returns code point for character.</p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java">
    <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">&#34;你&#34;</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">codePoint</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">codePointAt</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>    
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;U+%04X&#34;</span><span class="o">,</span> <span class="n">codePoint</span><span class="o">);</span>

    <span class="c1">// outputs the code point - U+4F60 
</span><span class="c1"></span>
</code></pre></div><p>A charset can have one or more encoding schemes and Unicode has multiple encoding schemes such as  UTF_8, UTF_16, UTF_16LE and UTF_16BE that maps code point to bytes.</p>
<h3 id="utf-8">UTF-8</h3>
<p>UTF-8 (8-bit Unicode Transformation Format) is a variable width character encoding capable of encoding all valid Unicode code points using one to four 8-bit bytes. In the above table, we can see that the length of encoded bytes varies from 1 to 3 bytes for UTF-8. Majority of web pages use UTF-8.</p>
<p>The first 128 characters of Unicode, which correspond one-to-one with ASCII, are encoded using a single byte with the same binary value as ASCII. The valid ASCII text is valid UTF-8-encoded Unicode as well.</p>
<h3 id="utf-16">UTF-16</h3>
<p>UTF-16 (16-bit Unicode Transformation Format) is another encoding scheme capable of handling all characters of Unicode character set. The encoding is variable-length, as code points are encoded with one or two 16-bit code units (i.e minimum 2 bytes and maximum 4 bytes).</p>
<p>Many systems such as Windows, Java and JavaScript, internally, uses UTF-16. It is also often used for plain text and for word-processing data files on Windows, but rarely used for files on Unix/Linux or macOS.</p>
<p>Java internally uses UTF-16. From Java 9 onwards, to reduce the memory taken by String objects, it uses either ISO-8859-1/Latin-1 (one byte per character) or UTF-16 (two bytes per character) based upon the contents of the string. <a href=http://openjdk.java.net/jeps/254 target="_blank">JEPS 254</a>.</p>
<p>However don&rsquo;t confuse the internal charset with Java default charset which is UTF-8. For example, the  Strings live in heap memory as UTF-16, however the method <code>String.getBytes()</code> returns bytes encoded as UTF-8, the default charset.</p>
<p>You can use <a href="https://github.com/maithilish/codefs/blob/master/misc/char-info/CharInfo.java" target="_blank">CharInfo.java</a> to display character details of a string.</p>
<p>To summarize:</p>
<ul>
<li>Character set is collection of characters. Numbers, alphabets and Chinese characters are examples of character sets.</li>
<li>Coded character set is a character set in which each character has an assigned int value. Unicode, US-ASCII and ISO-8859-1 are examples of coded character set.</li>
<li>Code Point is an integer assigned to a character in a coded character set.</li>
<li>Character encoding maps between code points of a coded character set and sequences of bytes. One coded character set may have one or more character encodings . For example, ASCII has one encoding scheme while Unicode has multiple encoding schemes - UTF-8, UTF-16, UTF_16BE, UTF_16LE etc.</li>
</ul>
<h2 id="java-io">Java IO</h2>
<p>Use char stream IO classes <code>Reader</code> and <code>Writer</code> while dealing with text and text files. As already explained, the default charset of Java platform is UTF-8 and text written using Writer class is encoded in UTF-8 and Reader class reads the text in UTF-8.</p>
<p>Using java.io package, we can write and read a text file in default charset as below.</p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java">
    <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">&#34;a Z â Δ 你 好 ಡ ತ ع&#34;</span><span class="o">;</span>
    <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;x-utf8.txt&#34;</span><span class="o">);</span>

    <span class="c1">// write file in default charset (UTF-8)
</span><span class="c1"></span>    <span class="k">try</span> <span class="o">(</span><span class="n">BufferedWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="n">file</span><span class="o">)))</span> <span class="o">{</span>
        <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// read file in default charset (UTF-8)
</span><span class="c1"></span>    <span class="k">try</span> <span class="o">(</span><span class="n">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">file</span><span class="o">)))</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">line</span><span class="o">;</span>
        <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
</code></pre></div><p>The above example, uses char stream classes - Writer and Reader - directly   that uses default character set (UTF-8).</p>
<p>To encode/decode in non-default charset use byte oriented classes and use a bridge class to convert it char oriented class. For example, to read file as raw bytes use <code>FileInputStream</code> and wrap it with <code>InputStreamReader</code>, a bridge that can encode the bytes to chars in specified charset. Similarly for output, use <code>OutputStreamWriter</code> (bridge) and <code>FileOutputWriter</code> (byte output)</p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java">
    <span class="c1">// read in UTF_16LE
</span><span class="c1"></span>    <span class="n">InputStream</span> <span class="n">byteInStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
    <span class="n">Reader</span> <span class="n">encodedCharStream</span> <span class="o">=</span> 
        <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">byteInStream</span><span class="o">,</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_16LE</span><span class="o">);</span>

    <span class="c1">// write in UTF_16LE
</span><span class="c1"></span>    <span class="n">OutputStream</span> <span class="n">byteOutStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
    <span class="n">Writer</span> <span class="n">decodedCharStream</span> <span class="o">=</span> 
        <span class="k">new</span> <span class="n">OutputStreamWriter</span><span class="o">(</span><span class="n">byteOutStream</span><span class="o">,</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_16LE</span><span class="o">);</span>

</code></pre></div><p>Following example, writes a file in UTF_16BE charset and reads it back.</p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java">
    <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">&#34;a Z â Δ 你 好 ಡ ತ ع&#34;</span><span class="o">;</span>
    <span class="n">Charset</span> <span class="n">charset</span> <span class="o">=</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_16BE</span><span class="o">;</span>
    <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;x-utf16be.txt&#34;</span><span class="o">);</span>

    <span class="c1">// write file in non default charset
</span><span class="c1"></span>    <span class="k">try</span> <span class="o">(</span><span class="n">BufferedWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedWriter</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">OutputStreamWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="n">file</span><span class="o">),</span> <span class="n">charset</span><span class="o">)))</span> <span class="o">{</span>
      <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// read file in non default charset
</span><span class="c1"></span>    <span class="k">try</span> <span class="o">(</span><span class="n">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span>
            <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">),</span> <span class="n">charset</span><span class="o">)))</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">line</span><span class="o">;</span>
        <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
        <span class="o">}</span>      
    <span class="o">}</span>

</code></pre></div><h2 id="transcoding">Transcoding</h2>
<p>Transcoding is the direct digital-to-digital conversion from an encoding to another, such as UTF-8 to UTF-16. We regularly encounter transcoding in video, audio and image files but rarely with text files.</p>
<p>Imagine, we receive a stream of bytes over the network encoded in CP-1252 (Windows-1252) or ISO 8859-1 and want to save it to text file in UTF 8.</p>
<p>There are couple of options to transcode from one charset to another. The easiest way to transcode it to use String class.</p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java">
    <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">ISO_8859_1</span><span class="o">);</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">toBytes</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>

</code></pre></div><p>While this quite fast, it suffers when we deal with large set of byte as heap memory gets allocated to multiple large strings. Better option is to use java.io classes as shown below:</p>
<figure class="text-center" >
  <img class="lazy img-fluid" data-src="/post/java-unicode-basics/media/transcode-io.png" alt="Java Unicode charset convert " />
</figure>

<p>See <a href="https://github.com/maithilish/codefs/blob/master/misc/transcode/Transcode.java" target="_blank">Transcode.java</a> for transcoding example and <a href="https://github.com/maithilish/codefs/tree/master/misc/char-server" target="_blank">Char Server</a> for a rough take on encoding between server and socket.</p>
<h2 id="play-with-unicode-in-linux-terminal">Play with Unicode in Linux terminal</h2>
<p>We can work with text encoding in Linux terminal with some simple commands. Note that Linux terminal can display ASCII and UTF-8 files but not UTF-16.</p>
<div class="highlight"><pre class="chroma"><code class="language-Bash" data-lang="Bash">
    <span class="c1"># create a text file from encoded bytes</span>
    $ <span class="nb">echo</span> -n -e <span class="s1">&#39;\xce\x94&#39;</span> &gt; delta-8.txt
    $ <span class="nb">echo</span> -n -e <span class="s1">&#39;\xfe\xff\x03\x94&#39;</span> &gt; delta-16.txt
    $ <span class="nb">echo</span> -n -e <span class="s1">&#39;\xe4\xbd\xa0\x20\xe5\xa5\xbd&#39;</span> &gt; nihou-8.txt
    $ <span class="nb">echo</span> -n -e <span class="s1">&#39;\xfe\xff\x4f\x60\xfe\xff\x20\x59\x7d&#39;</span> &gt; nihou-16.txt

    <span class="c1"># debug a text file as hex</span>
    $ hd nihou-16.txt

    <span class="m">00000000</span>  fe ff 4f <span class="m">60</span> fe ff <span class="m">20</span> <span class="m">59</span> 7d  <span class="p">|</span>..O<span class="sb">`</span>.. Y<span class="o">}</span><span class="p">|</span>
    <span class="m">00000009</span>

    <span class="c1"># know file encoding scheme</span>
    $ file -i *.txt

    delta-16.txt: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-16be
    delta-8.txt:  text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
    nihou-16.txt: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-16be
    nihou-8.txt:  text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8

    <span class="c1"># transcode from UTF 8 to UTF 16LE</span>
    $ iconv -f UTF8 -t UTF16LE &lt; nihou-8.txt &gt; nihou-16le.txt

    <span class="c1"># list encoding schemes</span> 
    $ iconv -l

    <span class="c1"># read a file in default charset</span>
    $ gedit nihou-8.txt     
    <span class="c1"># non-default</span>
    $ gedit --encoding UTF-16LE nihou-16le.txt

</code></pre></div><h2 id="further-reading">Further Reading</h2>
<p>Some good posts about Unicode usage in Java.</p>
<p><a href="https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/" target="_blank">The Absolute Minimum Developers should know about Unicode and Character Sets</a></p>
<p><a href="http://illegalargumentexception.blogspot.com/2009/05/java-rough-guide-to-character-encoding.html" target="_blank">Java: a rough guide to character encoding</a></p>
<p><a href="https://wiki.sei.cmu.edu/confluence/display/java/STR00-J.+Don%27t+form+strings+containing+partial+characters+from+variable-width+encodings" target="_blank">Don&rsquo;t form strings containing partial characters from variable-width encodings</a></p>

      </main>
    </div>

    
    <aside id="sidebar" class="col-md-3 order-md-1">
      <div class="row my-5 justify-content-center">
<div>&nbsp;</div>


<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-1281079745125126"
     data-ad-slot="8963022093"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<div>&nbsp;</div>
</div>
    </aside>

    <aside id="sidebar-right" class="col-md-1 order-md-last">
    </aside>

  </div>
</div>

<footer class="container-fluid mt-5">

    <div class="row">
        <div class="col ml-auto">
            <div class="row mb-1 ml-2">
                <a class="text-muted" href="/privacy-policy">Privacy</a>
            </div>
            <div class="row text-muted mb-2 ml-2">
                <span>&copy; 2019 &middot;Powered by <a href="https://gohugo.io" target="_blank"
                        rel="noopener">Hugo</a></span>
            </div>
        </div>
        <div class="col mr-auto">
            <span class="float-right">
                <a href="#" id="back_to_top">
                    <i class="icon-up-open h1 text-secondary"></i>
                </a>
            </span>
        </div>
    </div>

</footer>








<script src="/js/vendor.min.8489448e4e75ceb388a38abde3871de9485502974c5feddcf04a3d413dc6e103.js"></script>
</body>

</html>