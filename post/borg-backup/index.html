<!DOCTYPE html>
<html lang="en-us">

<head><meta charset="utf-8">
<meta name="description" content="For long, I was looking for an ideal backup setup. Finally, settled with Borg Backup solution which is quite easy to learn and maintain.">
<meta name="author" content="Maithilish">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">



<script async src="https://www.googletagmanager.com/gtag/js?id=UA-42139846-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-42139846-3');
</script>

<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://www.codetab.org/"
        },
        "articleSection" : "post",
        "name" : "Borg Backup",
        "headline" : "Borg Backup",
        "description" : "For long, I was looking for an ideal backup setup. Finally, settled with Borg Backup solution which is quite easy to learn and maintain.",
        "inLanguage" : "en",
        "author" : "Maithilish",
        "creator" : "Maithilish",
        "publisher": "Maithilish",
        "copyrightHolder" : "Maithilish",
        "copyrightYear" : "2019",
        "datePublished": "2019-08-27 10:00:00 +0000 UTC",
        "dateModified" : "2019-08-27 10:00:00 +0000 UTC",
        "url" : "/post/borg-backup/",
        "wordCount" : "887",
        "keywords" : [ "borg backup features basics","Blog" ]
    }
</script>
<link rel="icon" href="/favicon.ico">






<link rel="stylesheet" href="/css/vendor.min.06af1451a3c5b3b70a0c0bd7be26092e20e9c31251c08d44dbe1486a9a2a414c.css" integrity="sha256-Bq8UUaPFs7cKDAvXviYJLiDpwxJRwI1E2&#43;FIapoqQUw=">

<title>Borg Backup</title></head>

<body id="top"><header><nav id="navbar-main" class="navbar fixed-top navbar-light navbar-expand-lg bg-white border-bottom shadow-sm">

    <div class="container-fluid">

        
        <a class="navbar-brand" href="/">Codetab</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbar">

            
            
            <ul class="navbar-nav ml-auto">
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#tutorials"  >
                        
                        <span>Home</span>
                        
                    </a>
                </li>

                
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#projects"  >
                        
                        <span>Projects</span>
                        
                    </a>
                </li>

                
                

                

                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/post"  >
                        
                        <span>Posts</span>
                        
                    </a>
                </li>

                
                

                

                
                
                
                
                

                <li class="nav-item">
                    <a class="nav-link" href="/#about"  >
                        
                        <span>About</span>
                        
                    </a>
                </li>

                
                

            </ul>

        </div>
    </div>
</nav></header>

<div class="container-fluid">
  <div class="row">&nbsp;</div>
  <div class="row">
    <aside id="sidebar" class="col-md-3">
      <div class="row my-5 justify-content-center">
<div>&nbsp;</div>


<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-1281079745125126"
     data-ad-slot="8963022093"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<div>&nbsp;</div>
</div>
    </aside>

    <div id="contentspace" class="col-md-7 post-basic">
      <h2>Borg Backup</h2>
      <small class="text-muted">
        Aug 27, 2019 . 5 min read
      </small>
      <div id="share" class="row mx-0 justify-content-end">





<div title=twitter>
    <a href="https://twitter.com/intent/tweet?url=https://www.codetab.org/post/borg-backup/&amp;text=Borg%20Backup" target="_blank" rel="noopener">
        <i class="icon-twitter-squared text-secondary"></i>
    </a>
</div>




<div title=facebook>
    <a href="https://www.facebook.com/sharer.php?u=https://www.codetab.org/post/borg-backup/&amp;t=Borg%20Backup" target="_blank" rel="noopener">
        <i class="icon-facebook-squared text-secondary"></i>
    </a>
</div>




<div title=linkedin>
    <a href="https://www.linkedin.com/shareArticle?url=https://www.codetab.org/post/borg-backup/&amp;title=Borg%20Backup" target="_blank" rel="noopener">
        <i class="icon-linkedin-squared text-secondary"></i>
    </a>
</div>




<div title=email>
    <a href="mailto:?subject=Borg%20Backup&amp;body=https://www.codetab.org/post/borg-backup/" target="_blank" rel="noopener">
        <i class="icon-mail-squared text-secondary"></i>
    </a>
</div>




<div title=whatsapp>
    <a href="https://web.whatsapp.com/send?text=Borg%20Backup%20https://www.codetab.org/post/borg-backup/" target="_blank" rel="noopener">
        <i class="icon-whatsapp text-secondary"></i>
    </a>
</div>




<div title=reddit>
    <a href="https://reddit.com/submit?url=https://www.codetab.org/post/borg-backup/&amp;title=Borg%20Backup" target="_blank" rel="noopener">
        <i class="icon-reddit-alien text-secondary"></i>
    </a>
</div>




<div title=weibo>
    <a href="https://service.weibo.com/share/share.php?url=https://www.codetab.org/post/borg-backup/&amp;title=Borg%20Backup" target="_blank" rel="noopener">
        <i class="icon-weibo text-secondary"></i>
    </a>
</div>




<i class="icon-blank ctab-transparent"></i></div>
      <hr class="my-3" />
      <main id="content" class="post-basic">
        

<p>For long, I was looking for an ideal backup setup. Expectations were minimal;periodically backup set of folders from the main disk to secondary disk, compressing the files to save disk space, retaining the earlier sets and easy to learn, deploy and maintain. I tried and dropped many backup solutions because of cumbersome setup and steep learning curve.</p>

<p>Finally, I chose <a href="https://www.borgbackup.org/" target="_blank">Borg Backup</a> for its sophistication and ease of use; thereupon, using it for more than a year now. This post covers the basics of Borg Backup and the next post, <a href="/post/borg-backup-automate/">Automate Borg Backup<a>, covers steps to automate the whole setup.</p>

<h2 id="borg-backup">Borg Backup</h2>

<p>BorgBackup is a de-duplicating backup program which provides an efficient and secure way to backup data. The data de-duplication makes it suitable for daily backups since only changes (similar to GIT commits) are stored.</p>

<p>Borg gives you:</p>

<ul>
<li>space efficient storage of backups.<br /></li>
<li>compression using LZ4, zlib and LZMA.</li>
<li>secure, authenticated encryption.<br /></li>
<li>easy installation on multiple platforms.
<br /></li>
</ul>

<h2 id="install-borg">Install Borg</h2>

<p>In Ubuntu, it is as simple as this</p>
<div class="highlight"><pre class="chroma"><code class="language-Bash" data-lang="Bash">    
$ sudo apt install borgbackup
    </code></pre></div>
<p>Refer <a href="https://borgbackup.readthedocs.io/en/stable/installation.html#" target="_blank">Borg Documentation</a> for other systems.</p>

<h2 id="borg-basics">Borg Basics</h2>

<p>Let&rsquo;s create a Borg Repository and go through frequently used operations.</p>

<h3 id="create-repository">Create Repository</h3>

<p>Borg repository holds set of Borg backups. To create repository use borg init command.</p>
<div class="highlight"><pre class="chroma"><code class="language-Bash" data-lang="Bash">        
$ borg init --encryption<span class="o">=</span>none <span class="nv">$HOME</span>/borgrepo
    </code></pre></div>
<p>It initializes repository in $HOME/borgrepo directory. For sake of simplicity, we are creating repository in home dir, but for production backup we need to create the repository in a file system on fallback disk or on a remote system.</p>

<h3 id="backup-some-folders">Backup some folders</h3>

<p>In Borg, the backup is called as archive. The following command backup $HOME/Documents folder to a archive named Monday.</p>
<div class="highlight"><pre class="chroma"><code class="language-Bash" data-lang="Bash">    
$ borg create <span class="nv">$HOME</span>/borgrepo::Monday <span class="nv">$HOME</span>/Documents
    </code></pre></div>
<p>The archive referred with <code>path/to/repo::archive-name</code>. We can&rsquo;t create another backup using same name, so to backup Documents folder, say next day, we need to use new archive name.</p>
<div class="highlight"><pre class="chroma"><code class="language-Bash" data-lang="Bash">$ borg create <span class="nv">$HOME</span>/borgrepo::Tuesday <span class="nv">$HOME</span>/Documents</code></pre></div>
<p>The first backup is a full backup, and Borg de-duplicates data during subsequent backup of same folder and stores only the changed chunks to save space and backup time.</p>

<h3 id="list-backups">List Backups</h3>

<p>Use borg list command to list all archives in borg repository.</p>
<div class="highlight"><pre class="chroma"><code class="language-Screen" data-lang="Screen">    
$ borg list $HOME/borgrepo
Monday           Mon, 2019-07-29 10:17:12
Tuesday          Tue, 2019-07-30 10:45:14
    </code></pre></div>
<h3 id="repository-info">Repository Info</h3>

<p>We can obtain info about the repository using borg info command. The info from my borg repository is shown below:</p>
<div class="highlight"><pre class="chroma"><code class="language-Screen" data-lang="Screen">    
$ borg info /cherry/borgrepo/

Repository ID: 0307c0296168c2e75c357334b8ae
Location: /cherry/borgrepo
Encrypted: No
Cache: /home/m/.cache/borg/0307c0296168c2e75c357334b8ae
Security dir: /home/m/.config/borg/security/0307c0296168c2e75c357334b8ae
------------------------------------------------------------------------------
                       Original size      Compressed size    Deduplicated size
All archives:               18.55 GB             17.52 GB              1.93 GB

                       Unique chunks         Total chunks
Chunk index:                   27125               353185</code></pre></div>
<p>It is info of my backup; the backup size is roughly about 1.6 GB. The repository contains about 18 archive and the total size should have been about 17 GB, but because of de-duplicating feature the repository size is still 1.93 GB.</p>

<h3 id="extract-archive">Extract Archive</h3>

<p>Use extract command to retrieve data from the repository.</p>
<div class="highlight"><pre class="chroma"><code class="language-Bash" data-lang="Bash">$ mkdir tem
$ <span class="nb">cd</span> tem         
$ borg extract <span class="nv">$HOME</span>/borgrepo::Monday</code></pre></div>
<p>Extract always writes into the current working directory, so make sure you cd to the right place before calling borg extract!</p>

<p>You can pass &ndash;exclude option to exclude specific path or paths. We can also pass specific path to extract as below:</p>
<div class="highlight"><pre class="chroma"><code class="language-Bash" data-lang="Bash">$ <span class="nb">cd</span> tem         
$ borg extract <span class="nv">$HOME</span>/borgrepo::Monday  **/Documents/somefolder
     </code></pre></div>
<h3 id="prune-repository">Prune Repository</h3>

<p>Suppose, we have automated the borg for daily backup and after an year, repository will have hundreds of archive. They may not take lot of space because of data de-duplication, but we soon realise that many of them may be purged. For example, we may wish to retain only one backup per week or even less, one for each month. The prune command allows to sparse out unwanted archives.</p>
<div class="highlight"><pre class="chroma"><code class="language-Screen" data-lang="Screen">     
$ borg prune -n --list --keep-weekly -1 $HOME/borgrepo
Keeping archive: Tuesday          Fri, 2019-08-02 16:07:28 
Would prune:     Monday           Fri, 2019-08-02 16:07:16 </code></pre></div>
<p>The command uses -n for dry run and &ndash;list shows which archives are pruned or retained. The option &ndash;keep-weekly tells borg to retain the last archive in each week. The limit -1 indicates that there is no limit on number of archives to retain. If limit is greater than zero, then that many archive are retained. Say, keep-weekly prunes 25 archives and retains 10; if limit is set to 3, then the latest three, from the retained set of 10, are retained and rest seven are pruned. For actual pruning, remove dry run option <code>-n</code> from the above command.</p>

<p>The frequently used keep options are:</p>

<ul>
<li>&ndash;keep-daily DAILY,     number of daily archives to keep</li>
<li>&ndash;keep-weekly WEEKLY,   number of weekly archives to keep</li>
<li>&ndash;keep-monthly MONTHLY,  number of monthly archives to keep</li>
<li>&ndash;keep-yearly YEARLY,    number of yearly archives to keep</li>
</ul>

<p>The prune doesn&rsquo;t distinguishes between different data set. For example, let&rsquo;s say we have archives as follows</p>
<div class="highlight"><pre class="chroma"><code class="language-Bash" data-lang="Bash">    
$ borg create <span class="nv">$HOME</span>/borgrepo::Docs-Sunday <span class="nv">$HOME</span>/Documents
$ borg create <span class="nv">$HOME</span>/borgrepo::Picts-Sunday <span class="nv">$HOME</span>/Pictures

$ borg create <span class="nv">$HOME</span>/borgrepo::Docs-Monday <span class="nv">$HOME</span>/Documents    
$ borg create <span class="nv">$HOME</span>/borgrepo::Picts-Monday <span class="nv">$HOME</span>/Pictures
    </code></pre></div>
<p>Then &ndash;keep-weekly prunes the first three and retains only the last archive, and we stands to loose Documents folder backup. We can avoid this by using prefix option <code>-P</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-Bash" data-lang="Bash">    
$ borg prune -n --list -P Docs --keep-weekly -1 <span class="nv">$HOME</span>/borgrepo
Keeping archive: Docs-Monday            Fri, <span class="m">2019</span>-08-02 <span class="m">16</span>:48:47 
Would prune:     Docs-Sunday            Fri, <span class="m">2019</span>-08-02 <span class="m">16</span>:48:32 
    </code></pre></div>
<p>The option <code>-P Docs</code>, tells borg to prune only the archives that start with Docs and ignore others.</p>

<p>The next post, <a href="/post/borg-backup-automate/">Automate Borg Backup<a>, shows how to easily automate multiple backups.</p>

      </main>
    </div>

    <aside id="sidebar-right" class="col-md-2">
    </aside>

  </div>
</div>

<footer class="container-fluid mt-5">

    <div class="row">
        <div class="col ml-auto">
            <div class="row mb-1 ml-2">
                <a class="text-muted" href="/privacy-policy">Privacy</a>
            </div>
            <div class="row text-muted mb-2 ml-2">
                <span>&copy; 2019 &middot;Powered by <a href="https://gohugo.io" target="_blank"
                        rel="noopener">Hugo</a></span>
            </div>
        </div>
        <div class="col mr-auto">
            <span class="float-right">
                <a href="#" id="back_to_top">
                    <i class="icon-up-open h1 text-secondary"></i>
                </a>
            </span>
        </div>
    </div>

</footer>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>








<script src="/js/vendor.min.d5750c855207aebcf4fdb7568961a27500008ef4a4f40b63a7b028f80a9221d3.js"></script>
</body>

</html>